

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analysing Spectral Energy Distribution and Emission/Absorption Visualization &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../_static/tardis_logo.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=e462899a"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration Reference" href="../io/configuration/index.html" />
    <link rel="prev" title="Analysing Montecarlo Packets" href="rpacket_plot_notebook.html" />
    <link href="../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="visualization_reference.html">Visualization Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="analysing_convergence_plot.html">Convergence Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Analysing Spectral Energy Distribution and Emission/Absorption Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Atomic-Data">Atomic Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Example-Configuration-File">Example Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Loading-Simulation-Data">Loading Simulation Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Running-simulation">Running simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#HDF">HDF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-Spectral-Quantities">Calculating Spectral Quantities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Wavelength-and-Frequency-Grid-Setup">Wavelength and Frequency Grid Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Luminosity-Calculations">Luminosity Calculations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Plotting-Species-wise-Emission-and-Absorption-Contributions">Plotting Species-wise Emission and Absorption Contributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Matplotlib">Matplotlib</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Plotly">Plotly</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="visualization_reference.html">Visualization Reference</a></li>
      <li class="breadcrumb-item active">Analysing Spectral Energy Distribution and Emission/Absorption Visualization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/reference/sdec_notebook.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style>
    /* strip stderr */
    div.nboutput.container div.output_area.stderr {
        background: #fdd;
        display: none;
    }

    .launch-btn {
        background-color: #2980B9;
        border: none;
        border-radius: 4px;
        color: #fcfcfc;
        font-family: inherit;
        text-decoration: none;
        padding: 3px 8px;
        letter-spacing: 0.03em;
        display: inline-block;
        line-height: 1.5em;
    }

    .launch-btn:hover {
        background-color: #1b6391;
        color: #fcfcfc;
    }

    .launch-btn:visited {
        color: #fcfcfc;
    }

    .note-p {
        margin-bottom: 0.4em;
        line-height: 2em;
    }
</style>

<div class="admonition note">
<p class="note-p">You can interact with this notebook online: <a href="https://mybinder.org/v2/gh/tardis-sn/tardis/HEAD?filepath=docs/reference/sdec_notebook.ipynb" class="launch-btn" target="_blank" rel="noopener noreferrer">Launch notebook</a></p>
</div><section id="Analysing-Spectral-Energy-Distribution-and-Emission/Absorption-Visualization">
<h1>Analysing Spectral Energy Distribution and Emission/Absorption Visualization<a class="headerlink" href="#Analysing-Spectral-Energy-Distribution-and-Emission/Absorption-Visualization" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>Note:</strong></p>
<p>This notebook is only a sample demonstrating some of the features of the <code class="docutils literal notranslate"><span class="pre">sdecplotter</span></code> class. If you are interested in using additional features, you should directly access the <a class="reference external" href="https://github.com/tardis-sn/tardis/blob/master/tardis/visualization/tools/sdec_plot.py#L419">sdecplotter</a> class. You can see the rest of the features of the sdecplotter class <a class="reference external" href="docs/analysing_tardis_outputs/visualization/how_to_sdec_plot.ipynb">here</a>.</p>
</div>
<p>A notebook for analyzing and visualizing the spectral energy distribution, emission and absorption patterns in supernova simulations using TARDIS.</p>
<p>Every simulation run requires <a class="reference external" href="io/configuration/components/atomic/atomic_data.rst">atomic data</a> and a <a class="reference external" href="io/configuration/index.rst">configuration file</a>.</p>
<section id="Atomic-Data">
<h2>Atomic Data<a class="headerlink" href="#Atomic-Data" title="Link to this heading">¶</a></h2>
<p>We recommend using the <a class="reference external" href="https://github.com/tardis-sn/tardis-regression-data/raw/main/atom_data/kurucz_cd23_chianti_H_He_latest.h5">kurucz_cd23_chianti_H_He_latest.h5</a> dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.io.atom_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_atom_data</span>

<span class="c1"># We download the atomic data needed to run the simulation</span>
<span class="n">download_atom_data</span><span class="p">(</span><span class="s1">&#39;kurucz_cd23_chianti_H_He_latest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-Configuration-File">
<h2>Example Configuration File<a class="headerlink" href="#Example-Configuration-File" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>-q<span class="w"> </span>-nc<span class="w"> </span>https://raw.githubusercontent.com/tardis-sn/tardis/master/docs/tardis_example.yml
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>tardis_example.yml
</pre></div>
</div>
</div>
</section>
<section id="Loading-Simulation-Data">
<h2>Loading Simulation Data<a class="headerlink" href="#Loading-Simulation-Data" title="Link to this heading">¶</a></h2>
<section id="Running-simulation">
<h3>Running simulation<a class="headerlink" href="#Running-simulation" title="Link to this heading">¶</a></h3>
<p>To run the simulation, import the <code class="docutils literal notranslate"><span class="pre">run_tardis</span></code> function and create the <code class="docutils literal notranslate"><span class="pre">sim</span></code> object.</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>Note:</strong></p>
<p>Get more information about the <a class="reference external" href="io/output/progress_bars.rst">progress bars</a>, <a class="reference external" href="io/optional/tutorial_logging_configuration.ipynb">logging configuration</a>, and <a class="reference external" href="io/visualization/tutorial_convergence_plot.ipynb">convergence plots</a>.</p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_tardis</span>

<span class="n">simulation</span> <span class="o">=</span> <span class="n">run_tardis</span><span class="p">(</span>
    <span class="s2">&quot;tardis_example.yml&quot;</span><span class="p">,</span>
    <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="HDF">
<h3>HDF<a class="headerlink" href="#HDF" title="Link to this heading">¶</a></h3>
<p>TARDIS can save simulation data to HDF files for later analysis. The code below shows how to load a simulation from an HDF file. This is useful when you want to analyze simulation results without re-running the simulation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import astropy.units as u</span>
<span class="c1"># import pandas as pd</span>

<span class="c1"># hdf_fpath = &quot;add_file_path_here&quot;</span>
<span class="c1"># with pd.HDFStore(hdf_fpath, &quot;r&quot;) as hdf:</span>
<span class="c1">#     sim = u.Quantity(hdf[&quot;/simulation&quot;])</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Calculating-Spectral-Quantities">
<h2>Calculating Spectral Quantities<a class="headerlink" href="#Calculating-Spectral-Quantities" title="Link to this heading">¶</a></h2>
<p>This section demonstrates how to analyze the spectral decomposition (SDEC) output from TARDIS. SDEC helps understand how different atomic species contribute to the formation of spectral features through their emission and absorption processes.</p>
<section id="Wavelength-and-Frequency-Grid-Setup">
<h3>Wavelength and Frequency Grid Setup<a class="headerlink" href="#Wavelength-and-Frequency-Grid-Setup" title="Link to this heading">¶</a></h3>
<p>First, we set up the wavelength and frequency grids for analysis and plotting</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">packet_wvl_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">9000</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span>
<span class="n">packets_mode</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span>
<span class="n">packet_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">spectrum</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">packet_nu_range</span> <span class="o">=</span> <span class="n">packet_wvl_range</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;Hz&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">())</span>

<span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">extract_and_process_packet_data</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span> <span class="n">packets_mode</span>
<span class="p">)</span>
<span class="n">spectrum</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">get_spectrum_data</span><span class="p">(</span><span class="n">packets_mode</span><span class="p">,</span> <span class="n">simulation</span><span class="p">)</span>

<span class="n">lum_to_flux</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time_of_simulation</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">transport_state</span><span class="o">.</span><span class="n">packet_collection</span><span class="o">.</span><span class="n">time_of_simulation</span>
    <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="p">)</span>

<span class="n">plot_frequency_bins</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">spectrum_solver</span><span class="o">.</span><span class="n">spectrum_real_packets</span><span class="o">.</span><span class="n">_frequency</span>
<span class="p">)</span>
<span class="n">plot_wavelength</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">spectrum_solver</span><span class="o">.</span><span class="n">spectrum_real_packets</span><span class="o">.</span><span class="n">wavelength</span>
<span class="n">luminosity_density_lambda</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">spectrum_solver</span><span class="o">.</span><span class="n">spectrum_real_packets</span><span class="o">.</span><span class="n">luminosity_density_lambda</span>
<span class="p">)</span>

<span class="n">plot_frequency</span> <span class="o">=</span> <span class="n">plot_frequency_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Index of value just before the upper bound of the desired range</span>
<span class="n">start_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">plot_frequency_bins</span> <span class="o">&gt;</span> <span class="n">packet_nu_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Index of value just after the lower bound of the desired range</span>
<span class="n">end_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">plot_frequency_bins</span> <span class="o">&lt;</span> <span class="n">packet_nu_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plot_frequency_bins</span> <span class="o">=</span> <span class="n">plot_frequency_bins</span><span class="p">[</span><span class="n">start_idx</span> <span class="p">:</span> <span class="n">end_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Isolating the desired range</span>
<span class="n">packet_wvl_range_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">plot_wavelength</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">packet_wvl_range_mask</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">plot_wavelength</span> <span class="o">=</span> <span class="n">plot_wavelength</span><span class="p">[</span><span class="n">packet_wvl_range_mask</span><span class="p">]</span>
<span class="n">plot_frequency</span> <span class="o">=</span> <span class="n">plot_frequency</span><span class="p">[</span><span class="n">packet_wvl_range_mask</span><span class="p">]</span>

<span class="n">modeled_spectrum_luminosity</span> <span class="o">=</span> <span class="n">luminosity_density_lambda</span><span class="p">[</span><span class="n">packet_wvl_range_mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Luminosity-Calculations">
<h3>Luminosity Calculations<a class="headerlink" href="#Luminosity-Calculations" title="Link to this heading">¶</a></h3>
<p>Then we calculate emission and absorption luminosities for each atomic species to understand their contributions to the spectrum</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">packet_nu_range_mask</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">create_wavelength_mask</span><span class="p">(</span>
    <span class="n">packet_data</span><span class="p">,</span>
    <span class="n">packets_mode</span><span class="p">,</span>
    <span class="n">packet_wvl_range</span><span class="p">,</span>
    <span class="n">df_key</span><span class="o">=</span><span class="s2">&quot;packets_df&quot;</span><span class="p">,</span>
    <span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;nus&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">packet_nu_line_range_mask</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">create_wavelength_mask</span><span class="p">(</span>
    <span class="n">packet_data</span><span class="p">,</span>
    <span class="n">packets_mode</span><span class="p">,</span>
    <span class="n">packet_wvl_range</span><span class="p">,</span>
    <span class="n">df_key</span><span class="o">=</span><span class="s2">&quot;packets_df_line_interaction&quot;</span><span class="p">,</span>
    <span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;nus&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df&quot;</span><span class="p">][</span><span class="s2">&quot;energies&quot;</span><span class="p">][</span><span class="n">packet_nu_range_mask</span><span class="p">]</span>
    <span class="o">/</span> <span class="n">lum_to_flux</span>
<span class="p">)</span> <span class="o">/</span> <span class="n">time_of_simulation</span>

<span class="n">emission_luminosities_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">plot_wavelength</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The spectral luminosity calculation for different packet types follows these key steps:</p>
<ol class="arabic simple">
<li><p><strong>Packet Selection:</strong> Filter packets based on their interaction properties (e.g., non-interacting packets, electron scattering packets, or specific atomic interactions).</p></li>
<li><p><strong>Frequency Distribution Creation:</strong> Create a histogram of packet frequencies within the specified frequency range, weighted by their energy contribution.</p></li>
<li><p><strong>Spectral Luminosity Calculation:</strong> Convert the weighted histogram to spectral luminosity per frequency unit.</p></li>
<li><p><strong>Wavelength Conversion:</strong> Transform the spectral luminosity from frequency to wavelength.</p></li>
</ol>
<p>Finally we store it in our desired dataframe with an appropiate identifier.</p>
<p>Let’s first isolate packets which made no-interaction</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noint_mask</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df&quot;</span><span class="p">][</span><span class="s2">&quot;last_interaction_type&quot;</span><span class="p">][</span>
        <span class="n">packet_nu_range_mask</span>
    <span class="p">]</span>
    <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">noint_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df&quot;</span><span class="p">][</span><span class="s2">&quot;nus&quot;</span><span class="p">][</span><span class="n">packet_nu_range_mask</span><span class="p">][</span>
        <span class="n">noint_mask</span>
    <span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">plot_frequency_bins</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">noint_mask</span><span class="p">],</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">noint_luminosity_per_frequency</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">noint_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>
    <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
    <span class="o">/</span> <span class="n">spectrum</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;spectrum_delta_frequency&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">luminosity_per_wavelength</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">noint_luminosity_per_frequency</span> <span class="o">*</span> <span class="n">plot_frequency</span> <span class="o">/</span> <span class="n">plot_wavelength</span>
<span class="p">)</span>
<span class="n">emission_luminosities_df</span><span class="p">[</span><span class="s2">&quot;noint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">luminosity_per_wavelength</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
<p>Lets repeat the process for packets which experienced electron scattering</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">escatter_mask</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df&quot;</span><span class="p">][</span><span class="s2">&quot;last_interaction_type&quot;</span><span class="p">][</span>
        <span class="n">packet_nu_range_mask</span>
    <span class="p">]</span>
    <span class="o">==</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df&quot;</span><span class="p">][</span><span class="s2">&quot;last_line_interaction_in_id&quot;</span><span class="p">][</span>
        <span class="n">packet_nu_range_mask</span>
    <span class="p">]</span>
    <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">escatter_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df&quot;</span><span class="p">][</span><span class="s2">&quot;nus&quot;</span><span class="p">][</span><span class="n">packet_nu_range_mask</span><span class="p">][</span>
        <span class="n">escatter_mask</span>
    <span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">plot_frequency_bins</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">escatter_mask</span><span class="p">],</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">escatter_spectral_luminosity</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">escatter_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>
    <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
    <span class="o">/</span> <span class="n">spectrum</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;spectrum_delta_frequency&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">escatter_luminosity_per_wavelength</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">escatter_spectral_luminosity</span> <span class="o">*</span> <span class="n">plot_frequency</span> <span class="o">/</span> <span class="n">plot_wavelength</span>
<span class="p">)</span>
<span class="n">emission_luminosities_df</span><span class="p">[</span><span class="s2">&quot;escatter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">escatter_luminosity_per_wavelength</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
<p>Next, calculate and store the emission luminosities and absorption luminosities for each atomic species.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atomic_interaction_groups</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df_line_interaction&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">packet_nu_line_range_mask</span><span class="p">]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;last_line_interaction_atom&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">atomic_interaction_groups</span><span class="p">:</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">lum_to_flux</span> <span class="o">/</span> <span class="n">time_of_simulation</span>
    <span class="n">atomic_frequency_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
        <span class="n">group</span><span class="p">[</span><span class="s2">&quot;nus&quot;</span><span class="p">],</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">plot_frequency_bins</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">atomic_spectral_luminosity</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">atomic_frequency_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>
        <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
        <span class="o">/</span> <span class="n">spectrum</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;spectrum_delta_frequency&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">emission_luminosities_df</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">atomic_spectral_luminosity</span> <span class="o">*</span> <span class="n">plot_frequency</span> <span class="o">/</span> <span class="n">plot_wavelength</span>
    <span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="n">emission_species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">atomic_interaction_groups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">absorption_packet_nu_line_range_mask</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">create_wavelength_mask</span><span class="p">(</span>
    <span class="n">packet_data</span><span class="p">,</span>
    <span class="n">packets_mode</span><span class="p">,</span>
    <span class="n">packet_wvl_range</span><span class="p">,</span>
    <span class="n">df_key</span><span class="o">=</span><span class="s2">&quot;packets_df_line_interaction&quot;</span><span class="p">,</span>
    <span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;last_line_interaction_in_nu&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">absorption_luminosities_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">plot_wavelength</span><span class="p">)</span>

<span class="n">atomic_interaction_groups_absorption</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">packet_data</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;packets_df_line_interaction&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">absorption_packet_nu_line_range_mask</span><span class="p">]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;last_line_interaction_atom&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">atomic_interaction_groups_absorption</span><span class="p">:</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">lum_to_flux</span> <span class="o">/</span> <span class="n">time_of_simulation</span>
    <span class="n">atomic_frequency_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
        <span class="n">group</span><span class="p">[</span><span class="s2">&quot;last_line_interaction_in_nu&quot;</span><span class="p">],</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">plot_frequency_bins</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">atomic_spectral_luminosity</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">atomic_frequency_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>
        <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
        <span class="o">/</span> <span class="n">spectrum</span><span class="p">[</span><span class="n">packets_mode</span><span class="p">][</span><span class="s2">&quot;spectrum_delta_frequency&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">absorption_luminosities_df</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">atomic_spectral_luminosity</span> <span class="o">*</span> <span class="n">plot_frequency</span> <span class="o">/</span> <span class="n">plot_wavelength</span>
    <span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="n">absorption_species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">atomic_interaction_groups_absorption</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate total luminosities by adding absorption and emission</span>
<span class="c1"># Drop &#39;no interaction&#39; and &#39;electron scattering&#39; columns from emission before adding</span>
<span class="n">total_luminosities_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">absorption_luminosities_df</span>
    <span class="o">+</span> <span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;noint&quot;</span><span class="p">,</span> <span class="s2">&quot;escatter&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">total_luminosities_df</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">species_name</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">atomic_number2element_symbol</span><span class="p">(</span><span class="n">atomic_num</span><span class="p">)</span> <span class="k">for</span> <span class="n">atomic_num</span> <span class="ow">in</span> <span class="n">species</span>
<span class="p">]</span>
<span class="n">species_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Plotting-Species-wise-Emission-and-Absorption-Contributions">
<h2>Plotting Species-wise Emission and Absorption Contributions<a class="headerlink" href="#Plotting-Species-wise-Emission-and-Absorption-Contributions" title="Link to this heading">¶</a></h2>
<p>Now we will plot the species-wise emission and absorption contributions that we calculated in the previous step using calculate_emission_luminosities() and calculate_absorption_luminosities() respectively. We’ll start with packets that had no interaction with the ejecta, followed by electron scattering events, and then contributions from different atomic species. The colorbar will help you to identify the atomic species and their respective contributions to the total luminosity at each
wavelength.</p>
<section id="Matplotlib">
<h3>Matplotlib<a class="headerlink" href="#Matplotlib" title="Link to this heading">¶</a></h3>
<p>Generate Colors list based on species</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">species_length</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">color_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">species_counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">species_length</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">species_counter</span> <span class="o">/</span> <span class="n">species_length</span><span class="p">)</span>
    <span class="n">color_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">color_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Creating colormap</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">custcmap</span> <span class="o">=</span> <span class="n">clr</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">color_values</span><span class="p">)</span> <span class="c1"># Normalize color range</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">clr</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">species_length</span><span class="p">)</span>
<span class="n">mappable</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">custcmap</span><span class="p">)</span>
<span class="n">mappable</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">species_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Add Colorbar</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create figure and axis</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Add colorbar for species representation</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">species_length</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">species_name</span><span class="p">)</span>  <span class="c1"># Label ticks with species names</span>
</pre></div>
</div>
</div>
<p>Plot the emission contribution</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">upper_level</span> <span class="o">=</span> <span class="n">lower_level</span> <span class="o">+</span> <span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">noint</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">plot_wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">lower_level</span><span class="p">,</span>
    <span class="n">upper_level</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#4C4C4C&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;No interaction&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot electron scattering contribution</span>
<span class="c1"># This is stacked on top of the &#39;no interaction&#39; contribution</span>
<span class="n">lower_level</span> <span class="o">=</span> <span class="n">upper_level</span>
<span class="n">upper_level</span> <span class="o">=</span> <span class="n">lower_level</span> <span class="o">+</span> <span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">escatter</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">plot_wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">lower_level</span><span class="p">,</span>
    <span class="n">upper_level</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#8F8F8F&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Electron Scatter Only&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot the emission contributions for each species by stacking them on top of each other.</span>
<span class="c1"># The lower level for each species starts where the previous species ended (upper_level),</span>
<span class="c1"># and the upper level adds that species&#39; emission contribution.</span>
<span class="c1"># Each species gets a unique color from the colormap defined above.</span>
<span class="k">for</span> <span class="n">species_counter</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
    <span class="n">lower_level</span> <span class="o">=</span> <span class="n">upper_level</span>
    <span class="n">upper_level</span> <span class="o">=</span> <span class="n">lower_level</span> <span class="o">+</span> <span class="n">emission_luminosities_df</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">plot_wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">lower_level</span><span class="p">,</span>
        <span class="n">upper_level</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_list</span><span class="p">[</span><span class="n">species_counter</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Plot the absorption contribution</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The absorption contributions are plotted below zero, showing how each species</span>
<span class="c1"># absorbs light and reduces the total luminosity. The contributions are stacked</span>
<span class="c1"># downward from zero, with each species getting the same color as its emission above.</span>
<span class="n">lower_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">absorption_luminosities_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">species_counter</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
    <span class="n">upper_level</span> <span class="o">=</span> <span class="n">lower_level</span>
    <span class="n">lower_level</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">upper_level</span> <span class="o">-</span> <span class="n">absorption_luminosities_df</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">plot_wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">upper_level</span><span class="p">,</span>
        <span class="n">lower_level</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_list</span><span class="p">[</span><span class="n">species_counter</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c1"># Plot the modeled spectrum</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">plot_wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">modeled_spectrum_luminosity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="s2">&quot;--b&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real Spectrum&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">axis_label_in_latex</span><span class="p">(</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">axis_label_in_latex</span><span class="p">(</span>
    <span class="s2">&quot;L_{</span><span class="se">\\</span><span class="s2">lambda}&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;erg/(s AA)&quot;</span><span class="p">),</span> <span class="n">only_text</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="c1"># Add labels, legend, and formatting</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;TARDIS example Spectral Energy Distribution&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Plotly">
<h3>Plotly<a class="headerlink" href="#Plotly" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="c1"># By specifying a common stackgroup, plotly will itself add up luminosities,</span>
<span class="c1"># in order, to created stacked area chart</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">noint</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;No interaction&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="s2">&quot;#4C4C4C&quot;</span><span class="p">,</span>
        <span class="n">stackgroup</span><span class="o">=</span><span class="s2">&quot;emission&quot;</span><span class="p">,</span>
        <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;(%</span><span class="si">{x:.2f}</span><span class="s2">, %</span><span class="si">{y:.3g}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">escatter</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Electron Scatter Only&quot;</span><span class="p">,</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="s2">&quot;#8F8F8F&quot;</span><span class="p">,</span>
        <span class="n">stackgroup</span><span class="o">=</span><span class="s2">&quot;emission&quot;</span><span class="p">,</span>
        <span class="n">hoverlabel</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;namelength&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
        <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;(%</span><span class="si">{x:.2f}</span><span class="s2">, %</span><span class="si">{y:.3g}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The species data comes from the emission_luminosities_df and absorption_luminosities_df DataFrames</span>
<span class="c1"># We plot emissions as positive values stacked above zero</span>
<span class="c1"># And absorptions as negative values stacked below zero</span>
<span class="c1"># This creates a visualization showing how different species contribute to the spectrum</span>
<span class="k">for</span> <span class="p">(</span><span class="n">species_counter</span><span class="p">,</span> <span class="n">identifier</span><span class="p">),</span> <span class="n">name_of_spec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="n">species_name</span>
<span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">emission_luminosities_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">emission_luminosities_df</span><span class="p">[</span><span class="n">identifier</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name_of_spec</span> <span class="o">+</span> <span class="s2">&quot; Emission&quot;</span><span class="p">,</span>
            <span class="n">hovertemplate</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">name_of_spec</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2"> Emission&lt;br&gt;&quot;</span>  <span class="c1"># noqa: ISC003</span>
            <span class="o">+</span> <span class="s2">&quot;(%</span><span class="si">{x:.2f}</span><span class="s2">, %</span><span class="si">{y:.3g}</span><span class="s2">)&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">pu</span><span class="o">.</span><span class="n">to_rgb255_string</span><span class="p">(</span><span class="n">color_list</span><span class="p">[</span><span class="n">species_counter</span><span class="p">]),</span>
            <span class="n">stackgroup</span><span class="o">=</span><span class="s2">&quot;emission&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hoverlabel</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;namelength&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Plot absorption part</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">absorption_luminosities_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="c1"># to plot absorption luminosities along negative y-axis</span>
            <span class="n">y</span><span class="o">=</span><span class="n">absorption_luminosities_df</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name_of_spec</span> <span class="o">+</span> <span class="s2">&quot; Absorption&quot;</span><span class="p">,</span>
            <span class="n">hovertemplate</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">name_of_spec</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2"> Absorption&lt;br&gt;&quot;</span>  <span class="c1"># noqa: ISC003</span>
            <span class="o">+</span> <span class="s2">&quot;(%</span><span class="si">{x:.2f}</span><span class="s2">, %</span><span class="si">{y:.3g}</span><span class="s2">)&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="n">pu</span><span class="o">.</span><span class="n">to_rgb255_string</span><span class="p">(</span><span class="n">color_list</span><span class="p">[</span><span class="n">species_counter</span><span class="p">]),</span>
            <span class="n">stackgroup</span><span class="o">=</span><span class="s2">&quot;absorption&quot;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hoverlabel</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;namelength&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Plot modeled spectrum</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">plot_wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">modeled_spectrum_luminosity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Real Spectrum&quot;</span><span class="p">,</span>
        <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;(%</span><span class="si">{x:.2f}</span><span class="s2">, %</span><span class="si">{y:.3g}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">hoverlabel</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;namelength&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
    <span class="p">)</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate [0, 1] range to create bins equal to number of elements</span>
<span class="n">colorscale_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">species_name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create a categorical colorscale [a list of (reference point, color)]</span>
<span class="c1"># by mapping same reference points (excluding 1st and last bin edge)</span>
<span class="c1"># twice in a row (https://plotly.com/python/colorscales/#constructing-a-discrete-or-discontinuous-color-scale)</span>
<span class="n">categorical_colorscale</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">species_counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species_name</span><span class="p">)):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">to_rgb255_string</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">colorscale_bins</span><span class="p">[</span><span class="n">species_counter</span><span class="p">]))</span>
    <span class="n">categorical_colorscale</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colorscale_bins</span><span class="p">[</span><span class="n">species_counter</span><span class="p">],</span> <span class="n">color</span><span class="p">))</span>
    <span class="n">categorical_colorscale</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colorscale_bins</span><span class="p">[</span><span class="n">species_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="p">))</span>

<span class="c1"># Create a categorical colorscale for the elements by mapping each species to a color</span>
<span class="n">coloraxis_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;colorscale&quot;</span><span class="p">:</span> <span class="n">categorical_colorscale</span><span class="p">,</span>
    <span class="s2">&quot;showscale&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;cmin&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;cmax&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_name</span><span class="p">),</span>
    <span class="s2">&quot;colorbar&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Elements&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tickvals&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_name</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;ticktext&quot;</span><span class="p">:</span> <span class="n">species_name</span><span class="p">,</span>
        <span class="c1"># to change length and position of colorbar</span>
        <span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="s2">&quot;yanchor&quot;</span><span class="p">:</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Add an invisible scatter point to make the colorbar show up in the plot</span>
<span class="c1"># The point is placed at the middle of the wavelength range with y=0</span>
<span class="c1"># The marker color is set to 0 (first color in colorscale) with opacity=0 to hide it</span>
<span class="c1"># coloraxis_options contains the categorical colorscale mapping species to colors</span>
<span class="n">scatter_point_idx</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">get_mid_point_idx</span><span class="p">(</span><span class="n">plot_wavelength</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">plot_wavelength</span><span class="p">[</span><span class="n">scatter_point_idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Colorbar&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">coloraxis_options</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Set label and other layout options</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">axis_label_in_latex</span><span class="p">(</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">axis_label_in_latex</span><span class="p">(</span>
    <span class="s2">&quot;L_{</span><span class="se">\\</span><span class="s2">lambda}&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;erg/(s AA)&quot;</span><span class="p">),</span> <span class="n">only_text</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;TARDIS example Spectral Energy Distribution &quot;</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">xlabel</span><span class="p">,</span>
        <span class="s2">&quot;exponentformat&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ylabel</span><span class="p">,</span> <span class="s2">&quot;exponentformat&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">},</span>
    <span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">9000</span><span class="p">],</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;notebook_connected&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rpacket_plot_notebook.html" class="btn btn-neutral float-left" title="Analysing Montecarlo Packets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../io/configuration/index.html" class="btn btn-neutral float-right" title="Configuration Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 12 Oct 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>