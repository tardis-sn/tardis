

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.transport.montecarlo.packet_source.high_energy module &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../_static/tardis_logo.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=29a32e3f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tardis.transport.montecarlo.packets package" href="tardis.transport.montecarlo.packets.html" />
    <link rel="prev" title="tardis.transport.montecarlo.packet_source.black_body_weighted module" href="tardis.transport.montecarlo.packet_source.black_body_weighted.html" />
    <link href="../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_walkthrough/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="tardis.html">tardis package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="tardis.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="tardis.configuration.html">tardis.configuration package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.energy_input.html">tardis.energy_input package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.grid.html">tardis.grid package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.gui.html">tardis.gui package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.io.html">tardis.io package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.model.html">tardis.model package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.opacities.html">tardis.opacities package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.plasma.html">tardis.plasma package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.scripts.html">tardis.scripts package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.simulation.html">tardis.simulation package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.spectrum.html">tardis.spectrum package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.stats.html">tardis.stats package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="tardis.transport.html">tardis.transport package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.util.html">tardis.util package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.visualization.html">tardis.visualization package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.workflows.html">tardis.workflows package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tardis.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="tardis.html#module-tardis">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/visualization_reference.html">Visualization Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">tardis</a></li>
          <li class="breadcrumb-item"><a href="tardis.html">tardis package</a></li>
          <li class="breadcrumb-item"><a href="tardis.transport.html">tardis.transport package</a></li>
          <li class="breadcrumb-item"><a href="tardis.transport.montecarlo.html">tardis.transport.montecarlo package</a></li>
          <li class="breadcrumb-item"><a href="tardis.transport.montecarlo.packet_source.html">tardis.transport.montecarlo.packet_source package</a></li>
      <li class="breadcrumb-item active">tardis.transport.montecarlo.packet_source.high_energy module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/tardis.transport.montecarlo.packet_source.high_energy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-tardis.transport.montecarlo.packet_source.high_energy">
<span id="tardis-transport-montecarlo-packet-source-high-energy-module"></span><h1>tardis.transport.montecarlo.packet_source.high_energy module<a class="headerlink" href="#module-tardis.transport.montecarlo.packet_source.high_energy" title="Link to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tardis.transport.montecarlo.packet_source.high_energy.</span></span><span class="sig-name descname"><span class="pre">GammaRayPacketSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cumulative_decays_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isotope_decay_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positronium_fraction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_velocities</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_velocities</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">times</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">effective_times</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.base.BasePacketSource" title="tardis.transport.montecarlo.packet_source.base.BasePacketSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasePacketSource</span></code></a></p>
<p>Initialize gamma ray packet source.</p>
<p>Initializes a gamma ray packet source for creating gamma ray packets
from radioactive decay data, including support for positronium formation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cumulative_decays_df</strong><span class="classifier">pd.DataFrame</span></dt><dd><p>DataFrame containing cumulative decay data with columns including
radiation type, decay energies, and multi-level indices for
isotope, shell_number, and time_index.</p>
</dd>
<dt><strong>isotope_decay_df</strong><span class="classifier">pd.DataFrame</span></dt><dd><p>DataFrame containing isotope decay data with decay constants
and other isotope-specific parameters.</p>
</dd>
<dt><strong>positronium_fraction</strong><span class="classifier">float</span></dt><dd><p>Fraction of positrons that form positronium (0.0 to 1.0).
Used for modeling three-photon decay vs two-photon annihilation.</p>
</dd>
<dt><strong>inner_velocities</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array of inner shell velocities [cm/s] for each spatial shell.</p>
</dd>
<dt><strong>outer_velocities</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array of outer shell velocities [cm/s] for each spatial shell.</p>
</dd>
<dt><strong>times</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array of time steps [s] used in the simulation.</p>
</dd>
<dt><strong>effective_times</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array of effective time steps [s] accounting for simulation specifics.</p>
</dd>
<dt><strong>**kwargs</strong></dt><dd><p>Additional keyword arguments passed to the parent BasePacketSource class.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This packet source generates gamma ray packets from radioactive decay
events, with proper handling of:
- Spatial distribution within shells
- Time-dependent decay processes
- Positronium formation and decay modes
- Doppler effects from moving material</p>
<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_directions">
<span class="sig-name descname"><span class="pre">create_packet_directions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_directions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_directions" title="Link to this definition">¶</a></dt>
<dd><p>Create random isotropic directions for packets.</p>
<p>Generates an array of random unit vectors representing isotropic
directions for gamma ray packets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>no_of_packets</strong><span class="classifier">int</span></dt><dd><p>Number of packets to generate directions for.</p>
</dd>
<dt><strong>seed</strong><span class="classifier">int or None</span></dt><dd><p>Random seed for reproducible direction generation.
If None, uses current random state.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of shape (3, no_of_packets) containing unit direction vectors.
Each column represents a 3D unit vector [x, y, z].</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Directions are sampled uniformly on the unit sphere to ensure
isotropic distribution in 3D space.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_energies">
<span class="sig-name descname"><span class="pre">create_packet_energies</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">energy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_energies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_energies" title="Link to this definition">¶</a></dt>
<dd><p>Create uniform packet energies for gamma ray packets.</p>
<p>Generates an array of identical packet energies for a specified
number of packets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>no_of_packets</strong><span class="classifier">int</span></dt><dd><p>Number of packets to create energies for.</p>
</dd>
<dt><strong>energy</strong><span class="classifier">float</span></dt><dd><p>Energy value [erg] to assign to each packet.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of packet energies [erg] with length no_of_packets,
where each element equals the input energy value.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method creates uniform energy packets, where each packet
carries the same energy regardless of the specific gamma ray
line that created it. The total energy is conserved through
the packet weighting system.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_mus">
<span class="sig-name descname"><span class="pre">create_packet_mus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_mus"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_mus" title="Link to this definition">¶</a></dt>
<dd><p>Create packet directional cosines.</p>
<p>Creates packet directional cosines by calling the parent class method.
This method is inherited from BasePacketSource.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>no_of_packets</strong><span class="classifier">int</span></dt><dd><p>Number of packets for which to create directional cosines.</p>
</dd>
<dt><strong>*args</strong></dt><dd><p>Variable length argument list passed to parent method.</p>
</dd>
<dt><strong>**kwargs</strong></dt><dd><p>Arbitrary keyword arguments passed to parent method.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>The return value from the parent class create_packet_mus method.</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_nus">
<span class="sig-name descname"><span class="pre">create_packet_nus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positronium_fraction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">number_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_nus"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_nus" title="Link to this definition">¶</a></dt>
<dd><p>Create packet frequency-energies accounting for positronium formation.</p>
<p>Generates an array of packet frequency-energies (E = h * nu) considering
positronium formation and its decay modes for positron annihilation lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>packets</strong><span class="classifier">pd.DataFrame</span></dt><dd><p>DataFrame containing packet information with ‘radiation_energy_keV’ column.</p>
</dd>
<dt><strong>positronium_fraction</strong><span class="classifier">float</span></dt><dd><p>Fraction of positrons that form positronium (0.0 to 1.0).
Default is 0.0 for no positronium formation.</p>
</dd>
<dt><strong>number_of_packets</strong><span class="classifier">int</span></dt><dd><p>Number of packets to generate frequency-energies for.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of sampled frequency-energies [keV] with length number_of_packets.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>For positron annihilation lines (511 keV), this method:
- Determines if positronium forms based on positronium_fraction
- For ortho-positronium: samples from 3-photon decay spectrum
- For para-positronium: uses the 511 keV line energy
- For direct annihilation: uses the original 511 keV energy</p>
<p>The para/ortho ratio is set by PARA_TO_ORTHO_RATIO constant (0.25).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_times_uniform_energy">
<span class="sig-name descname"><span class="pre">create_packet_times_uniform_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">isotopes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decay_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_times_uniform_energy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_times_uniform_energy" title="Link to this definition">¶</a></dt>
<dd><p>Sample decay times from isotope mean lifetimes using rejection sampling.</p>
<p>Generates decay times by sampling from exponential distributions
based on isotope mean lifetimes, constrained to specific time intervals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>no_of_packets</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array indices for the packets (used for iteration).</p>
</dd>
<dt><strong>isotopes</strong><span class="classifier">pd.Series</span></dt><dd><p>Series containing parent isotope names for each packet.</p>
</dd>
<dt><strong>decay_time</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array of time step indices indicating the time interval
for each packet’s decay.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of decay times [s] sampled from exponential distributions
constrained to the appropriate time intervals.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method uses rejection sampling to ensure decay times fall
within the correct time bins. For each packet:
1. Determines the time interval [t_min, t_max] from decay_time index
2. Samples from exponential distribution: t = -tau * ln(random)
3. Rejects and resamples if t is outside the interval</p>
<p>Requires self.taus attribute containing isotope mean lifetimes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_times_uniform_time">
<span class="sig-name descname"><span class="pre">create_packet_times_uniform_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_times_uniform_time"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_times_uniform_time" title="Link to this definition">¶</a></dt>
<dd><p>Sample packet decay times uniformly within a time interval.</p>
<p>Generates decay times uniformly distributed between start and end times.
This approach requires non-uniform packet energies to maintain
energy conservation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>no_of_packets</strong><span class="classifier">int</span></dt><dd><p>Number of packets to generate decay times for.</p>
</dd>
<dt><strong>start</strong><span class="classifier">float</span></dt><dd><p>Start time [s] of the sampling interval.</p>
</dd>
<dt><strong>end</strong><span class="classifier">float</span></dt><dd><p>End time [s] of the sampling interval.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of decay times [s] with length no_of_packets,
uniformly distributed between start and end.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This method samples decay times uniformly in time, which means
the packet energies must be weighted according to the decay
rate at each time to properly represent the physical decay process.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_velocities">
<span class="sig-name descname"><span class="pre">create_packet_velocities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampled_packets_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packet_velocities"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packet_velocities" title="Link to this definition">¶</a></dt>
<dd><p>Initialize random radial velocities for packets within shells.</p>
<p>Generates random initial velocities for packets distributed within
spherical shells using a uniform distribution in volume.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>sampled_packets_df</strong><span class="classifier">pd.DataFrame</span></dt><dd><p>DataFrame where each row represents a packet, containing
‘inner_velocity’ and ‘outer_velocity’ columns for shell boundaries.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of initial velocities [cm/s] with length equal to the number
of packets in sampled_packets_df.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses the cube root method to ensure uniform distribution in volume:
r^3 = z * r_inner^3 + (1-z) * r_outer^3, where z is uniform random [0,1].</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packets">
<span class="sig-name descname"><span class="pre">create_packets</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cumulative_decays_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">number_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">legacy_energy_per_packet</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="tardis.energy_input.transport.GXPacket.html#tardis.energy_input.transport.GXPacket.GXPacketCollection" title="tardis.energy_input.transport.GXPacket.GXPacketCollection"><span class="pre">GXPacketCollection</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#GammaRayPacketSource.create_packets"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.GammaRayPacketSource.create_packets" title="Link to this definition">¶</a></dt>
<dd><p>Initialize a collection of gamma ray packets for simulation.</p>
<p>Creates a collection of gamma ray packets from radioactive decay data,
including proper spatial distribution, directional sampling, energy
assignment, and Doppler corrections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cumulative_decays_df</strong><span class="classifier">pd.DataFrame</span></dt><dd><p>DataFrame containing cumulative decay data with columns including
‘radiation’, ‘decay_energy_erg’, and multi-level index with
‘isotope’, ‘shell_number’, and ‘time_index’.</p>
</dd>
<dt><strong>number_of_packets</strong><span class="classifier">int</span></dt><dd><p>Total number of gamma ray packets to create for the simulation.</p>
</dd>
<dt><strong>legacy_energy_per_packet</strong><span class="classifier">float, optional</span></dt><dd><p>Legacy energy per packet [erg] for backwards compatibility.
If None, energy per packet is calculated from total gamma ray
energy divided by number of packets. Default is None.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>GXPacketCollection</dt><dd><p>Collection of gamma ray packets with initialized properties:
- locations: 3D positions in the simulation domain
- directions: isotropic unit direction vectors
- energies: rest frame and comoving frame energies
- frequencies: rest frame and comoving frame frequencies
- metadata: shell numbers, decay times, source isotopes</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The packet creation process includes:</p>
<ol class="arabic simple">
<li><p><strong>Energy calculation</strong>: Total gamma ray energy is divided equally
among packets (uniform energy approach)</p></li>
<li><p><strong>Spatial sampling</strong>: Packets are distributed within shells based
on decay energy weighting</p></li>
<li><p><strong>Temporal placement</strong>: Packets are positioned at decay times with
appropriate radial expansion</p></li>
<li><p><strong>Spectral sampling</strong>: Frequencies include positronium formation
effects for 511 keV annihilation lines</p></li>
<li><p><strong>Doppler corrections</strong>: Applied for relativistic motion between
rest and comoving frames</p></li>
</ol>
<p>The method ensures energy conservation while providing proper
statistical sampling of the decay process.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.transport.montecarlo.packet_source.high_energy.legacy_calculate_positron_fraction">
<span class="sig-prename descclassname"><span class="pre">tardis.transport.montecarlo.packet_source.high_energy.</span></span><span class="sig-name descname"><span class="pre">legacy_calculate_positron_fraction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">isotope_decay_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isotopes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">number_of_packets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/tardis/transport/montecarlo/packet_source/high_energy.html#legacy_calculate_positron_fraction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.transport.montecarlo.packet_source.high_energy.legacy_calculate_positron_fraction" title="Link to this definition">¶</a></dt>
<dd><p>Calculate positron kinetic energy fraction relative to gamma ray energy.</p>
<p>Computes the fraction of energy released as positron kinetic energy
compared to gamma ray energy for each isotope associated with packets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>isotope_decay_df</strong><span class="classifier">pd.DataFrame</span></dt><dd><p>DataFrame containing isotope decay data with multi-level index
including ‘isotope’ and ‘shell_number’, and columns including
‘radiation’, ‘energy_per_channel_keV’.</p>
</dd>
<dt><strong>isotopes</strong><span class="classifier">np.ndarray</span></dt><dd><p>Array of isotope names as strings, where each isotope is
associated with a packet.</p>
</dd>
<dt><strong>number_of_packets</strong><span class="classifier">int</span></dt><dd><p>Total number of gamma ray packets in the simulation.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>np.ndarray</dt><dd><p>Array of positron energy fractions with length number_of_packets.
Each element represents the ratio of positron kinetic energy to
gamma ray energy for the corresponding packet’s source isotope.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function:</p>
<ol class="arabic simple">
<li><p>Filters decay data for shell_number == 0 to avoid double counting</p></li>
<li><p>Separates gamma ray (‘g’) and beta plus (‘bp’) radiation channels</p></li>
<li><p>Sums energy per isotope for each radiation type</p></li>
<li><p>Calculates fraction = E_positron / E_gamma for each isotope</p></li>
<li><p>Maps isotope fractions to packet array</p></li>
</ol>
<p>Isotopes not present in the decay DataFrame receive a fraction of 0.0.
This is used for legacy compatibility and may be deprecated in favor
of more sophisticated positron energy modeling.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tardis.transport.montecarlo.packet_source.black_body_weighted.html" class="btn btn-neutral float-left" title="tardis.transport.montecarlo.packet_source.black_body_weighted module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tardis.transport.montecarlo.packets.html" class="btn btn-neutral float-right" title="tardis.transport.montecarlo.packets package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 02 Oct 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>