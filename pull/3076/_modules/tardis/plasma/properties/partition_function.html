

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.plasma.properties.partition_function &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../../_static/tardis_logo.ico"/>
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href="../../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/configuration/index.html">Configuration (Required Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.plasma.properties.partition_function</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.plasma.properties.partition_function</h1><div class="highlight"><pre>
<span></span>import logging

import numpy as np
import pandas as pd
from numpy.linalg.linalg import LinAlgError

from tardis.plasma.exceptions import PlasmaConfigError
from tardis.plasma.properties.base import ProcessingPlasmaProperty

logger = logging.getLogger(__name__)

__all__ = [
    &quot;LevelBoltzmannFactorLTE&quot;,
    &quot;LevelBoltzmannFactorDiluteLTE&quot;,
    &quot;LevelBoltzmannFactorNoNLTE&quot;,
    &quot;LevelBoltzmannFactorNLTE&quot;,
    &quot;PartitionFunction&quot;,
    &quot;ThermalLevelBoltzmannFactorLTE&quot;,
    &quot;ThermalLTEPartitionFunction&quot;,
]


<div class="viewcode-block" id="LevelBoltzmannFactorLTE">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorLTE">[docs]</a>
class LevelBoltzmannFactorLTE(ProcessingPlasmaProperty):
    &quot;&quot;&quot;
    Attributes
    ----------
    general_level_boltzmann_factor : Pandas DataFrame, dtype float
        Level population proportionality values.
        Evaluated at the radiation temperature.
        Indexed by atomic number, ion number, level number.
        Columns corresponding to zones. Does not consider
        NLTE.
    &quot;&quot;&quot;

    outputs = (&quot;general_level_boltzmann_factor&quot;,)
    latex_name = (&quot;bf_{i,j,k}&quot;,)
    latex_formula = (
        r&quot;g_{i,j,k}e^{\dfrac{-\epsilon_{i,j,k}}{k_{\textrm{B}}T_{\textrm{rad}}}}&quot;,
    )

<div class="viewcode-block" id="LevelBoltzmannFactorLTE.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorLTE.calculate">[docs]</a>
    @staticmethod
    def calculate(excitation_energy, g, beta_rad, levels):
        exponential = np.exp(np.outer(excitation_energy.values, -beta_rad))
        level_boltzmann_factor_array = g.values[np.newaxis].T * exponential
        level_boltzmann_factor = pd.DataFrame(
            level_boltzmann_factor_array,
            index=levels,
            columns=np.arange(len(beta_rad)),
            dtype=np.float64,
        )
        return level_boltzmann_factor</div>
</div>



<div class="viewcode-block" id="ThermalLevelBoltzmannFactorLTE">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.ThermalLevelBoltzmannFactorLTE">[docs]</a>
class ThermalLevelBoltzmannFactorLTE(LevelBoltzmannFactorLTE):
    &quot;&quot;&quot;
    Attributes
    ----------
    thermal_lte_level_boltzmann_factor : Pandas DataFrame, dtype float
        Level population proportionality values for LTE.
        Evaluated at the temperature of the
        electron gas (thermal). Indexed
        by atomic number, ion number, level number.
        Columns corresponding to zones.
    &quot;&quot;&quot;

    outputs = (&quot;thermal_lte_level_boltzmann_factor&quot;,)
    latex_name = (r&quot;bf_{i,j,k}^{\textrm{LTE}}(T_e)&quot;,)
    latex_formula = (
        r&quot;g_{i,j,k}e^{\dfrac{-\epsilon_{i,j,k}}{k_{\textrm{B}}T_{\textrm{electron}}}}&quot;,
    )

<div class="viewcode-block" id="ThermalLevelBoltzmannFactorLTE.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.ThermalLevelBoltzmannFactorLTE.calculate">[docs]</a>
    @staticmethod
    def calculate(excitation_energy, g, beta_electron, levels):
        return super(
            ThermalLevelBoltzmannFactorLTE, ThermalLevelBoltzmannFactorLTE
        ).calculate(excitation_energy, g, beta_electron, levels)</div>
</div>



<div class="viewcode-block" id="LevelBoltzmannFactorDiluteLTE">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorDiluteLTE">[docs]</a>
class LevelBoltzmannFactorDiluteLTE(ProcessingPlasmaProperty):
    &quot;&quot;&quot;
    Attributes
    ----------
    general_level_boltzmann_factor : Pandas DataFrame, dtype float
        Level population proportionality values. Indexed
        by atomic number, ion number, level number.
        Columns corresponding to zones. Dilute radiation
        field means non-metastable level values are
        multiplied by an additional factor W. Does not
        consider NLTE.
    &quot;&quot;&quot;

    outputs = (&quot;general_level_boltzmann_factor&quot;,)
    latex_name = (&quot;bf_{i,j,k}&quot;,)
    latex_formula = (
        r&quot;Wg_{i,j,k}e^{\dfrac{-\epsilon_{i,j,k}}{k_{\textrm{B}}T_{\textrm{rad}}}}&quot;,
    )

<div class="viewcode-block" id="LevelBoltzmannFactorDiluteLTE.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorDiluteLTE.calculate">[docs]</a>
    def calculate(
        self, levels, g, excitation_energy, beta_rad, w, metastability
    ):
        level_boltzmann_factor = LevelBoltzmannFactorLTE.calculate(
            excitation_energy, g, beta_rad, levels
        )
        level_boltzmann_factor[~metastability] *= w
        return level_boltzmann_factor</div>
</div>



<div class="viewcode-block" id="LevelBoltzmannFactorNoNLTE">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorNoNLTE">[docs]</a>
class LevelBoltzmannFactorNoNLTE(ProcessingPlasmaProperty):
    &quot;&quot;&quot;
    Attributes
    ----------
    level_boltzmann_factor : Pandas DataFrame, dtype float
        Returns general_level_boltzmann_factor as this
        property is included if NLTE is not used.
    &quot;&quot;&quot;

    outputs = (&quot;level_boltzmann_factor&quot;,)

<div class="viewcode-block" id="LevelBoltzmannFactorNoNLTE.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorNoNLTE.calculate">[docs]</a>
    @staticmethod
    def calculate(general_level_boltzmann_factor):
        return general_level_boltzmann_factor</div>
</div>



<div class="viewcode-block" id="LevelBoltzmannFactorNLTE">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorNLTE">[docs]</a>
class LevelBoltzmannFactorNLTE(ProcessingPlasmaProperty):
    &quot;&quot;&quot;
    Attributes
    ----------
    level_boltzmann_factor : Pandas DataFrame, dtype float
        Returns general_level_boltzmann_factor but
        updated for those species treated in NLTE.
    &quot;&quot;&quot;

    outputs = (&quot;level_boltzmann_factor&quot;,)

<div class="viewcode-block" id="LevelBoltzmannFactorNLTE.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorNLTE.calculate">[docs]</a>
    def calculate(self):
        raise AttributeError(
            &quot;This attribute is not defined on the parent class.&quot;
            &quot;Please use one of the subclasses.&quot;
        )</div>


<div class="viewcode-block" id="LevelBoltzmannFactorNLTE.from_config">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.LevelBoltzmannFactorNLTE.from_config">[docs]</a>
    @staticmethod
    def from_config(nlte_conf):
        if nlte_conf.classical_nebular and not nlte_conf.coronal_approximation:
            return LevelBoltzmannFactorNLTEClassic
        elif (
            nlte_conf.coronal_approximation and not nlte_conf.classical_nebular
        ):
            return LevelBoltzmannFactorNLTECoronal
        elif nlte_conf.coronal_approximation and nlte_conf.classical_nebular:
            raise PlasmaConfigError(
                &quot;Both coronal approximation and classical nebular specified in the config.&quot;
            )
        else:
            return LevelBoltzmannFactorNLTEGeneral</div>


    def __init__(self, plasma_parent):
        &quot;&quot;&quot;
        Selects appropriate &#39;calculate&#39; function based on NLTE config
        options selected.
        &quot;&quot;&quot;
        super().__init__(plasma_parent)

        self._update_inputs()

    def _main_nlte_calculation(
        self,
        atomic_data,
        nlte_data,
        t_electrons,
        j_blues,
        beta_sobolevs,
        general_level_boltzmann_factor,
        previous_electron_densities,
        g,
    ):
        &quot;&quot;&quot;
        The core of the NLTE calculation, used with all possible config.
        options.
        &quot;&quot;&quot;
        for species in nlte_data.nlte_species:
            logger.info(f&quot;Calculating rates for species {species}&quot;)
            number_of_levels = atomic_data.levels.energy.loc[species].count()
            lnl = nlte_data.lines_level_number_lower[species]
            lnu = nlte_data.lines_level_number_upper[species]
            (lines_index,) = nlte_data.lines_idx[species]

            try:
                j_blues_filtered = j_blues.iloc[lines_index]
            except AttributeError:
                j_blues_filtered = j_blues
                logger.debug(
                    f&quot;J Blues Filtered Value could not be calculated. Using j_blues_filtered = {j_blues_filtered}&quot;
                )
            try:
                beta_sobolevs_filtered = beta_sobolevs.iloc[lines_index]
            except AttributeError:
                beta_sobolevs_filtered = beta_sobolevs
                logger.debug(
                    f&quot;Beta Sobolevs Filtered Value could not be calculated. Using beta_sobolevs_filtered = {beta_sobolevs}&quot;
                )
            A_uls = nlte_data.A_uls[species]
            B_uls = nlte_data.B_uls[species]
            B_lus = nlte_data.B_lus[species]
            r_lu_index = lnu * number_of_levels + lnl
            r_ul_index = lnl * number_of_levels + lnu
            r_ul_matrix = np.zeros(
                (number_of_levels, number_of_levels, len(t_electrons)),
                dtype=np.float64,
            )
            r_ul_matrix_reshaped = r_ul_matrix.reshape(
                (number_of_levels**2, len(t_electrons))
            )
            r_ul_matrix_reshaped[r_ul_index] = (
                A_uls[np.newaxis].T + B_uls[np.newaxis].T * j_blues_filtered
            )
            r_ul_matrix_reshaped[r_ul_index] *= beta_sobolevs_filtered
            r_lu_matrix = np.zeros_like(r_ul_matrix)
            r_lu_matrix_reshaped = r_lu_matrix.reshape(
                (number_of_levels**2, len(t_electrons))
            )
            r_lu_matrix_reshaped[r_lu_index] = (
                B_lus[np.newaxis].T * j_blues_filtered * beta_sobolevs_filtered
            )
            if atomic_data.collision_data is None:
                collision_matrix = np.zeros_like(r_ul_matrix)
            else:
                if previous_electron_densities is None:
                    collision_matrix = np.zeros_like(r_ul_matrix)
                else:
                    collision_matrix = (
                        nlte_data.get_collision_matrix(species, t_electrons)
                        * previous_electron_densities.values
                    )
            rates_matrix = r_lu_matrix + r_ul_matrix + collision_matrix
            for i in range(number_of_levels):
                rates_matrix[i, i] = -rates_matrix[:, i].sum(axis=0)
            rates_matrix[0, :, :] = 1.0
            x = np.zeros(rates_matrix.shape[0])
            x[0] = 1.0
            for i in range(len(t_electrons)):
                try:
                    level_boltzmann_factor = np.linalg.solve(
                        rates_matrix[:, :, i], x
                    )
                except LinAlgError as e:
                    if e.message == &quot;Singular matrix&quot;:
                        raise ValueError(
                            &quot;SingularMatrixError during solving of the &quot;
                            &quot;rate matrix. Does the atomic data contain &quot;
                            &quot;collision data?&quot;
                        )
                    else:
                        raise e
                general_level_boltzmann_factor.loc[species, i] = (
                    level_boltzmann_factor
                    * g.loc[species][0]
                    / level_boltzmann_factor[0]
                )
        return general_level_boltzmann_factor

    def _calculate_classical_nebular(
        self,
        t_electrons,
        lines,
        atomic_data,
        nlte_data,
        general_level_boltzmann_factor,
        j_blues,
        previous_electron_densities,
        g,
    ):
        &quot;&quot;&quot;
        Performs NLTE calculations using the classical nebular treatment.
        All beta sobolev values taken as 1.
        &quot;&quot;&quot;
        beta_sobolevs = 1.0

        general_level_boltzmann_factor = self._main_nlte_calculation(
            atomic_data,
            nlte_data,
            t_electrons,
            j_blues,
            beta_sobolevs,
            general_level_boltzmann_factor,
            previous_electron_densities,
            g,
        )
        return general_level_boltzmann_factor

    def _calculate_coronal_approximation(
        self,
        t_electrons,
        lines,
        atomic_data,
        nlte_data,
        general_level_boltzmann_factor,
        previous_electron_densities,
        g,
    ):
        &quot;&quot;&quot;
        Performs NLTE calculations using the coronal approximation.
        All beta sobolev values taken as 1 and j_blues taken as 0.
        &quot;&quot;&quot;
        beta_sobolevs = 1.0
        j_blues = 0.0
        general_level_boltzmann_factor = self._main_nlte_calculation(
            atomic_data,
            nlte_data,
            t_electrons,
            j_blues,
            beta_sobolevs,
            general_level_boltzmann_factor,
            previous_electron_densities,
            g,
        )
        return general_level_boltzmann_factor

    def _calculate_general(
        self,
        t_electrons,
        lines,
        atomic_data,
        nlte_data,
        general_level_boltzmann_factor,
        j_blues,
        previous_beta_sobolev,
        previous_electron_densities,
        g,
    ):
        &quot;&quot;&quot;
        Full NLTE calculation without approximations.
        &quot;&quot;&quot;
        if previous_beta_sobolev is None:
            beta_sobolevs = 1.0
        else:
            beta_sobolevs = previous_beta_sobolev

        general_level_boltzmann_factor = self._main_nlte_calculation(
            atomic_data,
            nlte_data,
            t_electrons,
            j_blues,
            beta_sobolevs,
            general_level_boltzmann_factor,
            previous_electron_densities,
            g,
        )
        return general_level_boltzmann_factor</div>



class LevelBoltzmannFactorNLTECoronal(LevelBoltzmannFactorNLTE):
    calculate = LevelBoltzmannFactorNLTE._calculate_coronal_approximation


class LevelBoltzmannFactorNLTEClassic(LevelBoltzmannFactorNLTE):
    calculate = LevelBoltzmannFactorNLTE._calculate_classical_nebular


class LevelBoltzmannFactorNLTEGeneral(LevelBoltzmannFactorNLTE):
    calculate = LevelBoltzmannFactorNLTE._calculate_general


<div class="viewcode-block" id="PartitionFunction">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.PartitionFunction">[docs]</a>
class PartitionFunction(ProcessingPlasmaProperty):
    &quot;&quot;&quot;
    Attributes
    ----------
    partition_function : Pandas DataFrame, dtype float
        Indexed by atomic number, ion number.
        Columns are zones.
    &quot;&quot;&quot;

    outputs = (&quot;partition_function&quot;,)
    latex_name = (&quot;Z_{i,j}&quot;,)
    latex_formula = (r&quot;\sum_{k}bf_{i,j,k}&quot;,)

<div class="viewcode-block" id="PartitionFunction.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.PartitionFunction.calculate">[docs]</a>
    def calculate(self, level_boltzmann_factor):
        return level_boltzmann_factor.groupby(
            level=[&quot;atomic_number&quot;, &quot;ion_number&quot;]
        ).sum()</div>
</div>



<div class="viewcode-block" id="ThermalLTEPartitionFunction">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.ThermalLTEPartitionFunction">[docs]</a>
class ThermalLTEPartitionFunction(PartitionFunction):
    &quot;&quot;&quot;
    Attributes
    ----------
    thermal_lte_partition_function : Pandas DataFrame, dtype float
        Indexed by atomic number, ion number.
        Columns are zones.
    &quot;&quot;&quot;

    outputs = (&quot;thermal_lte_partition_function&quot;,)
    latex_name = (r&quot;Z_{i,j}(T_\mathrm{e}&quot;,)

<div class="viewcode-block" id="ThermalLTEPartitionFunction.calculate">
<a class="viewcode-back" href="../../../../api/tardis.plasma.properties.partition_function.html#tardis.plasma.properties.partition_function.ThermalLTEPartitionFunction.calculate">[docs]</a>
    def calculate(self, thermal_lte_level_boltzmann_factor):
        return super().calculate(thermal_lte_level_boltzmann_factor)</div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 19 May 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>