

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.opacities.opacities &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../_static/tardis_logo.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=3d5d8261"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href="../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/visualization_reference.html">Visualization Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.opacities.opacities</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.opacities.opacities</h1><div class="highlight"><pre>
<span></span>import numpy as np
import radioactivedecay as rd
from numba import njit

from tardis import constants as const
from tardis.transport.montecarlo import (
    njit_dict_no_parallel,
)
from tardis.transport.montecarlo.configuration.constants import (
    SIGMA_THOMSON,
)

H = const.h.cgs.value
M_E = const.m_e.cgs.value
K_B = const.k_B.cgs.value
E = const.e.esu.value
C = const.c.cgs.value
M_P = const.m_p.cgs.value
MASS_SI = rd.Nuclide(&quot;Si-28&quot;).atomic_mass * M_P
MASS_FE = rd.Nuclide(&quot;Fe-56&quot;).atomic_mass * M_P
SIGMA_T = const.sigma_T.cgs.value
FINE_STRUCTURE = const.alpha.value
ELECTRON_MASS_ENERGY_KEV = (const.m_e * const.c**2.0).to(&quot;keV&quot;).value

FF_OPAC_CONST = (
    (2 * np.pi / (3 * M_E * K_B)) ** 0.5 * 4 * E**6 / (3 * M_E * H * C)
)  # See Eq. 6.1.8 in http://personal.psu.edu/rbc3/A534/lec6.pdf


<div class="viewcode-block" id="kappa_calculation">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.kappa_calculation">[docs]</a>
@njit(**njit_dict_no_parallel)
def kappa_calculation(energy):
    &quot;&quot;&quot;
    Calculates kappa for various other calculations
    i.e. energy normalized to electron rest energy
    511.0 KeV

    Parameters
    ----------
    energy : float

    Returns
    -------
    kappa : float

    &quot;&quot;&quot;
    return energy / ELECTRON_MASS_ENERGY_KEV</div>



<div class="viewcode-block" id="chi_electron_calculator">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.chi_electron_calculator">[docs]</a>
@njit(**njit_dict_no_parallel)
def chi_electron_calculator(opacity_state, nu, shell):
    &quot;&quot;&quot;
    Calculate chi for Thomson scattering

    Parameters
    ----------
    opacity_state : OpacityState
    nu : float
        Comoving frequency of the r-packet.
    shell : int
        Shell of current r_packet

    Returns
    -------
    numpy.ndarray, dtype int
        Continuum ids for which absorption is possible for frequency `nu`.
    &quot;&quot;&quot;
    return opacity_state.electron_density[shell] * SIGMA_THOMSON</div>



<div class="viewcode-block" id="calculate_tau_electron">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.calculate_tau_electron">[docs]</a>
@njit(**njit_dict_no_parallel)
def calculate_tau_electron(electron_density, distance):
    &quot;&quot;&quot;
    Calculate tau for Thomson scattering

    Parameters
    ----------
    electron_density : float
    distance : float

    Returns
    -------
    tau_electron : float
        tau for thomson scattering
    &quot;&quot;&quot;
    return electron_density * SIGMA_THOMSON * distance</div>



<div class="viewcode-block" id="get_current_bound_free_continua">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.get_current_bound_free_continua">[docs]</a>
@njit(**njit_dict_no_parallel)
def get_current_bound_free_continua(opacity_state, nu):
    &quot;&quot;&quot;
    Determine bound-free continua for which absorption is possible.

    Parameters
    ----------
    opacity_state : OpacityState
    nu : float
        Comoving frequency of the r-packet.

    Returns
    -------
    numpy.ndarray, dtype int
        Continuum ids for which absorption is possible for frequency `nu`.
    &quot;&quot;&quot;
    nu_mins = opacity_state.photo_ion_nu_threshold_mins
    nu_maxs = opacity_state.photo_ion_nu_threshold_maxs
    current_continua = np.where(np.logical_and(nu &gt;= nu_mins, nu &lt;= nu_maxs))[0]
    return current_continua</div>



<div class="viewcode-block" id="chi_bf_interpolator">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.chi_bf_interpolator">[docs]</a>
@njit(**njit_dict_no_parallel)
def chi_bf_interpolator(opacity_state, nu, shell):
    &quot;&quot;&quot;
    Interpolate the bound-free opacity.

    This function interpolates the tabulated bound-free opacities
    and cross-sections to new frequency values `nu`.

    Parameters
    ----------
    opacity_state : OpacityState
    nu : float, dtype float
        Comoving frequency of the r-packet.
    shell : int, dtype float
        Current computational shell.

    Returns
    -------
    chi_bf_tot : float
        Total bound-free opacity at frequency `nu`.
    chi_bf_contributions : numpy.ndarray, dtype float
        Cumulative distribution function of the contributions of the
        individual bound free continua to the total bound-free opacity.
    current_continua : numpy.ndarray, dtype int
        Continuum ids for which absorption is possible for frequency `nu`.
    x_sect_bfs : numpy.ndarray, dtype float
        Photoionization cross-sections of all bound-free continua for
        which absorption is possible for frequency `nu`.
    &quot;&quot;&quot;
    current_continua = get_current_bound_free_continua(opacity_state, nu)
    chi_bfs = np.zeros(len(current_continua))
    x_sect_bfs = np.zeros(len(current_continua))
    for i, continuum_id in enumerate(current_continua):
        start = opacity_state.photo_ion_block_references[continuum_id]
        end = opacity_state.photo_ion_block_references[continuum_id + 1]
        phot_nus_continuum = opacity_state.phot_nus[start:end]
        nu_idx = np.searchsorted(phot_nus_continuum, nu)
        interval = phot_nus_continuum[nu_idx] - phot_nus_continuum[nu_idx - 1]
        high_weight = nu - phot_nus_continuum[nu_idx - 1]
        low_weight = phot_nus_continuum[nu_idx] - nu
        chi_bfs_continuum = opacity_state.chi_bf[start:end, shell]
        chi_bfs[i] = (
            chi_bfs_continuum[nu_idx] * high_weight
            + chi_bfs_continuum[nu_idx - 1] * low_weight
        ) / interval
        x_sect_bfs_continuum = opacity_state.x_sect[start:end]
        x_sect_bfs[i] = (
            x_sect_bfs_continuum[nu_idx] * high_weight
            + x_sect_bfs_continuum[nu_idx - 1] * low_weight
        ) / interval

    chi_bf_contributions = chi_bfs.cumsum()

    # If we are outside the range of frequencies
    # for which we have photo-ionization cross sections
    # we will have no local continuua and therefore
    # no bound-free interactions can occur
    # so we set the bound free opacity to zero
    if len(current_continua) == 0:
        chi_bf_tot = 0.0
    else:
        chi_bf_tot = chi_bf_contributions[-1]
        chi_bf_contributions /= chi_bf_tot

    return (
        chi_bf_tot,
        chi_bf_contributions,
        current_continua,
        x_sect_bfs,
    )</div>



<div class="viewcode-block" id="chi_ff_calculator">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.chi_ff_calculator">[docs]</a>
@njit(**njit_dict_no_parallel)
def chi_ff_calculator(opacity_state, nu, shell):
    &quot;&quot;&quot;
    Attributes
    ----------
    opacity_state : OpacityState
    nu : float64
        Comoving frequency of the r_packet
    shell : int64
        Current shell id of the r_packet

    Returns
    -------
        chi_ff : float64
            Free Free opacity
    &quot;&quot;&quot;
    chi_ff = (
        FF_OPAC_CONST
        * opacity_state.ff_opacity_factor[shell]
        / nu**3
        * (1 - np.exp(-H * nu / (K_B * opacity_state.t_electrons[shell])))
    )
    return chi_ff</div>



<div class="viewcode-block" id="chi_continuum_calculator">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.chi_continuum_calculator">[docs]</a>
@njit(**njit_dict_no_parallel)
def chi_continuum_calculator(opacity_state, nu, shell):
    &quot;&quot;&quot;
    Attributes
    ----------
    opacity_state : OpacityState
    nu : float64
        Comoving frequency of the r_packet
    shell : int64
        Current shell id of the r_packet

    Returns
    -------
    chi_bf_tot : float
        Total bound-free opacity at frequency `nu`.
    chi_bf_contributions : numpy.ndarray, dtype float
        Cumulative distribution function of the contributions of the
        individual bound free continua to the total bound-free opacity.
    current_continua : numpy.ndarray, dtype int
        Continuum ids for which absorption is possible for frequency `nu`.
    x_sect_bfs : numpy.ndarray, dtype float
        Photoionization cross-sections of all bound-free continua for
        which absorption is possible for frequency `nu`.
    chi_ff : float64
            Free Free opacity at frequency `nu`
    &quot;&quot;&quot;
    (
        chi_bf_tot,
        chi_bf_contributions,
        current_continua,
        x_sect_bfs,
    ) = chi_bf_interpolator(opacity_state, nu, shell)
    chi_ff = chi_ff_calculator(opacity_state, nu, shell)
    return (
        chi_bf_tot,
        chi_bf_contributions,
        current_continua,
        x_sect_bfs,
        chi_ff,
    )</div>



<div class="viewcode-block" id="compton_opacity_partial">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.compton_opacity_partial">[docs]</a>
@njit(**njit_dict_no_parallel)
def compton_opacity_partial(energy, fraction):
    &quot;&quot;&quot;Partial Compton scattering opacity, from artis file
    gamma.cc

    Parameters
    ----------
    energy : float
        packet energy in terms of electron rest energy
    fraction : float
        1 + 2 * packet energy

    Returns
    -------
    np.float64
        Compton scattering opacity
    &quot;&quot;&quot;
    term_1 = (
        ((energy**2.0) - (2.0 * energy) - 2.0)
        * np.log(fraction)
        / energy
        / energy
    )
    term_2 = (((fraction**2.0) - 1.0) / (fraction**2.0)) / 2.0
    term_3 = ((fraction - 1.0) / energy) * (
        (1 / energy) + (2.0 / fraction) + (1.0 / (energy * fraction))
    )
    return 3.0 * SIGMA_T * (term_1 + term_2 + term_3) / (8 * energy)</div>



<div class="viewcode-block" id="compton_opacity_calculation">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.compton_opacity_calculation">[docs]</a>
@njit(**njit_dict_no_parallel)
def compton_opacity_calculation(energy, electron_density):
    &quot;&quot;&quot;
    Calculate the Compton scattering opacity for a given energy
    (Rybicki &amp; Lightman, 1979)

    $
    \\rho / 2 p_m \\times 3/4 \\sigma_T ((1 + \\kappa) / \\kappa^3
    ((2\\kappa(1 + \\kappa)) / (1 + 2\\kappa) - \\ln(1 + 2\\kappa) + 1/(2\\kappa) \\ln(1 + 2\\kappa)
    - (1 + 3\\kappa) / (1 + 2\\kappa)^2)
    $

    Parameters
    ----------
    energy : float
        The energy of the photon
    ejecta_density : float
        The density of the ejecta

    Returns
    -------
    float
        The Compton scattering opacity
    &quot;&quot;&quot;
    kappa = kappa_calculation(energy)

    a = 1.0 + 2.0 * kappa

    sigma_KN = (
        3.0
        / 4.0
        * SIGMA_T
        * (
            (1.0 + kappa)
            / kappa**3.0
            * ((2.0 * kappa * (1.0 + kappa)) / a - np.log(a))
            + 1.0 / (2.0 * kappa) * np.log(a)
            - (1.0 + 3 * kappa) / a**2.0
        )
    )

    return electron_density * sigma_KN</div>



<div class="viewcode-block" id="photoabsorption_opacity_calculation">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.photoabsorption_opacity_calculation">[docs]</a>
@njit(**njit_dict_no_parallel)
def photoabsorption_opacity_calculation(
    energy, ejecta_density, iron_group_fraction
):
    &quot;&quot;&quot;Calculates photoabsorption opacity for a given energy
    Approximate treatment from Ambwani &amp; Sutherland (1988)
    Magic numbers are from the approximate treatment

    Parameters
    ----------
    energy : float
        Photon energy
    ejecta_density : float
        The density of the ejecta
    iron_group_fraction : float
        Fraction of iron group elements in the shell

    Returns
    -------
    float
        Photoabsorption opacity
    &quot;&quot;&quot;
    si_opacity = (
        1.16e-24
        * (energy / 100.0) ** -3.13
        * ejecta_density
        / MASS_SI
        * (1.0 - iron_group_fraction)
    )

    fe_opacity = (
        25.7e-24
        * (energy / 100.0) ** -3.0
        * ejecta_density
        / MASS_FE
        * iron_group_fraction
    )

    return si_opacity + fe_opacity</div>



<div class="viewcode-block" id="photoabsorption_opacity_calculation_kasen">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.photoabsorption_opacity_calculation_kasen">[docs]</a>
@njit(**njit_dict_no_parallel)
def photoabsorption_opacity_calculation_kasen(
    energy, number_density, proton_count
):
    &quot;&quot;&quot;
    Calculates photoabsorption opacity for a given energy
    Approximate treatment from Kasen et al. (2006)

    Parameters
    ----------
    energy : float
        Photon energy
    number_density : float
        The number density of the ejecta for each atom
    proton_count : float
        Number of protons for each atom in the ejecta

    Returns
    -------
    float
        Photoabsorption opacity
    &quot;&quot;&quot;
    kappa = kappa_calculation(energy)

    opacity = (FINE_STRUCTURE**4.0) * 8.0 * np.sqrt(2) * (kappa**-3.5)
    # Note- this should actually be atom_number_density * (atom_proton_number ** 5)
    return (
        SIGMA_T
        * opacity
        * np.sum((number_density / proton_count) * proton_count**5)
    )</div>



<div class="viewcode-block" id="pair_creation_opacity_calculation">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.pair_creation_opacity_calculation">[docs]</a>
@njit(**njit_dict_no_parallel)
def pair_creation_opacity_calculation(
    energy, ejecta_density, iron_group_fraction
):
    &quot;&quot;&quot;Calculates pair creation opacity for a given energy
    Approximate treatment from Ambwani &amp; Sutherland (1988)

    Parameters
    ----------
    energy : float
        Photon energy
    ejecta_density : float
        The density of the ejecta
    iron_group_fraction : float
        Fraction of iron group elements in the shell

    Returns
    -------
    float
        Pair creation opacity
    &quot;&quot;&quot;
    z_si = 14
    z_fe = 26

    si_proton_ratio = z_si**2.0 / MASS_SI
    fe_proton_ratio = z_fe**2.0 / MASS_FE

    multiplier = ejecta_density * (
        si_proton_ratio * (1.0 - iron_group_fraction)
        + fe_proton_ratio * iron_group_fraction
    )

    # Conditions prevent divide by zero
    # Ambwani &amp; Sutherland (1988)
    if energy &gt; 1022 and energy &lt; 1500:
        opacity = multiplier * 1.0063 * (energy / 1000 - 1.022) * 1.0e-27
    elif energy &gt;= 1500:
        opacity = (
            multiplier * (0.0481 + 0.301 * (energy / 1000 - 1.5)) * 1.0e-27
        )
    else:
        opacity = 0

    return opacity</div>



<div class="viewcode-block" id="pair_creation_opacity_artis">
<a class="viewcode-back" href="../../../api/tardis.opacities.opacities.html#tardis.opacities.opacities.pair_creation_opacity_artis">[docs]</a>
@njit(**njit_dict_no_parallel)
def pair_creation_opacity_artis(energy, ejecta_density, iron_group_fraction):
    &quot;&quot;&quot;Calculates pair creation opacity for a given energy
    Approximate treatment from Ambwani &amp; Sutherland (1988)
    as implemented in ARTIS

    Parameters
    ----------
    energy : float
        Photon energy
    ejecta_density : float
        The density of the ejecta
    iron_group_fraction : float
        Fraction of iron group elements in the shell

    Returns
    -------
    float
        Pair creation opacity
    &quot;&quot;&quot;
    # Conditions prevent divide by zero
    # Ambwani &amp; Sutherland (1988)
    if energy &gt; 1022:
        if energy &gt; 1500:
            opacity_si = (0.0481 + (0.301 * (energy - 1500))) * 196.0e-27
            opacity_fe = (0.0481 + (0.301 * (energy - 1500))) * 784.0e-27
        else:
            opacity_si = 1.0063 * (energy - 1022) * 196.0e-27
            opacity_fe = 1.0063 * (energy - 1022) * 784.0e-27

        opacity_si *= ejecta_density / M_P / 28
        opacity_fe *= ejecta_density / M_P / 56

        opacity = (opacity_fe * iron_group_fraction) + (
            opacity_si * (1.0 - iron_group_fraction)
        )
    else:
        opacity = 0

    return opacity</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 12 Oct 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>