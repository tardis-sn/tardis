

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.io.model.readers.snec.snec_output &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../../../../_static/tardis_logo.ico"/>
      <script src="../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../_static/documentation_options.js?v=f44beca9"></script>
      <script src="../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link href="../../../../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../api/modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../io/hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../io/configuration/index.html">Configuration (Required Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../io/model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../io/output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../physics/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../physics/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../physics/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../physics/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../physics/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../physics/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.io.model.readers.snec.snec_output</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.io.model.readers.snec.snec_output</h1><div class="highlight"><pre>
<span></span>from __future__ import annotations

from dataclasses import dataclass
from pathlib import Path

import numpy as np
import numpy.testing as npt
import pandas as pd
import xarray as xr
import yaml
from tqdm.auto import tqdm

from tardis.io.model.readers.snec.xg_files import XGData, read_xg_file

with open(
    Path(__file__).parent / &quot;parser_config&quot; / &quot;snec_xg_output_quantities.yml&quot;,
) as fh:
    SNEC_XG_OUTPUT_METADATA = yaml.safe_load(fh)

with open(
    Path(__file__).parent / &quot;parser_config&quot; / &quot;snec_initial_composition.yml&quot;
) as fh:
    SNEC_INITIAL_COMPOSITION_METADATA = yaml.safe_load(fh)

with open(
    Path(__file__).parent / &quot;parser_config&quot; / &quot;snec_initial_quantities.yml&quot;
) as fh:
    SNEC_INITIAL_QUANTITIES_METADATA = yaml.safe_load(fh)

with open(
    Path(__file__).parent / &quot;parser_config&quot; / &quot;snec_em_output_metadata.yml&quot;
) as fh:
    SNEC_EM_OUTPUT_METADATA = yaml.safe_load(fh)


<div class="viewcode-block" id="SNECOutput">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.SNECOutput">[docs]</a>
@dataclass
class SNECOutput:
    &quot;&quot;&quot;
    SNECOutput holds the results from a SNEC supernova explosion simulation.

    Attributes
    ----------
    xg_data : XGData
        The X-ray/gamma-ray transport output as a function of time and spatial cell.
    initial_composition : pandas.DataFrame
        Initial elemental composition for each cell, indexed by `cell_id`.
    initial_quantities : pandas.DataFrame
        Initial physical quantities (e.g., density, temperature) for each cell, indexed by `cell_id`.
    em_output : pandas.DataFrame
        Time series of emission properties, indexed by `time`.

    Methods
    -------
    to_xr_dataset()
        Convert all stored outputs into a single xarray.Dataset.
    &quot;&quot;&quot;

    xg_data: XGData
    initial_composition: pd.DataFrame
    initial_quantities: pd.DataFrame
    em_output: pd.DataFrame

<div class="viewcode-block" id="SNECOutput.to_xr_dataset">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.SNECOutput.to_xr_dataset">[docs]</a>
    def to_xr_dataset(self) -&gt; xr.Dataset:
        &quot;&quot;&quot;
        Convert SNECOutput to an xarray.Dataset by merging multiple data sources.

        This method builds a unified Dataset with:
        - xg_data: Base dataset obtained from `self.xg_data.to_xr_dataset()`.
        - em_output: Emission output indexed by time and reindexed to match `xg_data.time`,
            using nearest-neighbor interpolation.
        - initial_composition: Initial composition data merged over `cell_id` as coordinates
            and data variables.
        - initial_quantities: Initial quantities data merged over `cell_id` as coordinates
            and data variables.

        Returns
        -------
        xr.Dataset
                An xarray.Dataset containing the combined data from xg_data, em_output,
                initial_composition, and initial_quantities, all aligned along common
                dimensions (e.g., time, cell_id).
        &quot;&quot;&quot;
        # Base dataset from xg_data
        xg_data_ds = self.xg_data.to_xr_dataset()

        # Merge emission output over time, interpolating to xg_data time using nearest
        em_ds = self.em_output.set_index(&quot;time&quot;).to_xarray()
        em_ds = em_ds.reindex(time=xg_data_ds.time, method=&quot;nearest&quot;)
        xg_data_ds = xg_data_ds.merge(em_ds)

        # Merge initial composition as coordinates/data_vars over cell_id
        comp_ds = self.initial_composition.set_index(&quot;cell_id&quot;).to_xarray()
        xg_data_ds = xg_data_ds.merge(comp_ds)

        # Merge initial quantities as coordinates/data_vars over cell_id
        quant_ds = self.initial_quantities.set_index(&quot;cell_id&quot;).to_xarray()
        xg_data_ds = xg_data_ds.merge(quant_ds)

        return xg_data_ds</div>
</div>



<div class="viewcode-block" id="read_snec_output_xg">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.read_snec_output_xg">[docs]</a>
def read_snec_output_xg(
    snec_output_dir: Path | str, show_progress: bool = True
) -&gt; XGData:
    &quot;&quot;&quot;
    Read SNEC output .xg files and merge them into a unified XGData object.

    Parameters
    ----------
    snec_output_dir : pathlib.Path or str
        Path to the directory containing the SNEC output files. Expects an
        &quot;output&quot; subdirectory with files named &quot;mass.xg&quot; and &quot;{quantity}.xg&quot;.
    show_progress : bool, optional
        If True, display a progress bar when reading each .xg file.
        Default is True.

    Returns
    -------
    XGData
        An object with the following attributes:
        - timestamps : numpy.ndarray
            Array of time stamps common to all quantities.
        - data_blocks : list of pandas.DataFrame
            A list of data frames, one per time stamp, each containing columns
            [&#39;radius&#39;, &#39;enclosed_mass&#39;, *quantities].
        - metadata : dict
            Mapping from each quantity name to its associated metadata
            (taken from SNEC_XG_OUTPUT_METADATA).

    Raises
    ------
    FileNotFoundError
        If the mass.xg or any &quot;{quantity}.xg&quot; file is missing in the expected
        &quot;output&quot; directory.
    AssertionError
        If the time stamps in mass.xg do not match those in another quantity file.
    &quot;&quot;&quot;
    # Ensure snec_output_dir is a Path
    if not isinstance(snec_output_dir, Path):
        snec_output_dir = Path(snec_output_dir)
    all_xg_data: dict[str, XGData] = {}
    mass_xg_data: XGData = read_xg_file(
        str(snec_output_dir / &quot;output&quot; / &quot;mass.xg&quot;),
        column_names=[&quot;radius&quot;, &quot;enclosed_mass&quot;],
    )

    # Prepare items and conditional progress bar
    xg_items = list(SNEC_XG_OUTPUT_METADATA.items())
    if show_progress:
        xg_iterator = tqdm(xg_items, unit=&quot;quantity&quot;, desc=&quot;Reading XG files&quot;)
    else:
        xg_iterator = xg_items

    for output_quantity, metadata in xg_iterator:
        xg_file = snec_output_dir / &quot;output&quot; / f&quot;{output_quantity}.xg&quot;
        if not xg_file.exists():
            raise FileNotFoundError(f&quot;File {xg_file} does not exist.&quot;)

        xg_data = read_xg_file(
            str(xg_file),
            column_names=[&quot;enclosed_mass&quot;, output_quantity],
            show_progress=False,
        )

        # Ensure timestamps match
        assert np.all(
            np.isclose(mass_xg_data.timestamps, xg_data.timestamps)
        ), f&quot;Time stamps do not match for {output_quantity} and mass.&quot;

        # Add metadata to XGData
        xg_data.metadata = metadata
        all_xg_data[output_quantity] = xg_data

    merged_data_blocks: list[pd.DataFrame] = []
    for i, time_stamp in enumerate(mass_xg_data.timestamps):
        merged_df = mass_xg_data.data_blocks[i][[&quot;radius&quot;]].copy()
        merged_df[&quot;enclosed_mass&quot;] = mass_xg_data.data_blocks[i][&quot;enclosed_mass&quot;]

        for quantity_name, xg_data in all_xg_data.items():
            merged_df[quantity_name] = xg_data.data_blocks[i][quantity_name]

        merged_data_blocks.append(merged_df)

    # Create a single XGData object with all merged data
    merged_xg_data = XGData(
        timestamps=mass_xg_data.timestamps,
        data_blocks=merged_data_blocks,
        metadata=SNEC_XG_OUTPUT_METADATA,  # Use the full SNEC_XG_OUTPUT_QUANTITIES as metadata
    )
    return merged_xg_data</div>



<div class="viewcode-block" id="read_snec_dat_output">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.read_snec_dat_output">[docs]</a>
def read_snec_dat_output(
    snec_output_dir: Path, snec_dat_names: list[str], first_column_name: str
) -&gt; pd.DataFrame:
    &quot;&quot;&quot;
    Load the initial composition data from SNEC output.

    Parameters
    ----------
    snec_output_dir : Path
        Path to the directory containing the SNEC output files.

    Returns
    -------
    pd.DataFrame
        DataFrame containing the initial composition for each cell, indexed by cell ID.
    &quot;&quot;&quot;
    first_composition_name = snec_dat_names[0]
    snec_initial_composition_df = pd.read_csv(
        snec_output_dir / &quot;output&quot; / f&quot;{first_composition_name}.dat&quot;,
        names=[first_column_name, first_composition_name],
        sep=r&quot;\s+&quot;,
    )

    for snec_initial_composition_name in snec_dat_names[1:]:
        current_snec_initial_composition_df = pd.read_csv(
            snec_output_dir / &quot;output&quot; / f&quot;{snec_initial_composition_name}.dat&quot;,
            names=[first_column_name, snec_initial_composition_name],
            sep=r&quot;\s+&quot;,
        )
        npt.assert_array_almost_equal(
            snec_initial_composition_df.iloc[:, 0],
            current_snec_initial_composition_df.iloc[:, 0],
        )

        snec_initial_composition_df[snec_initial_composition_name] = (
            current_snec_initial_composition_df[snec_initial_composition_name]
        )

    return snec_initial_composition_df</div>



<div class="viewcode-block" id="read_snec_initial_composition">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.read_snec_initial_composition">[docs]</a>
def read_snec_initial_composition(snec_output_dir: Path) -&gt; pd.DataFrame:
    &quot;&quot;&quot;
    Load the initial composition data from SNEC output.

    Parameters
    ----------
    snec_output_dir : Path
        Path to the directory containing the SNEC output files.

    Returns
    -------
    pd.DataFrame
        DataFrame containing the initial composition for each cell, indexed by cell ID.
    &quot;&quot;&quot;
    return read_snec_dat_output(
        snec_output_dir,
        list(SNEC_INITIAL_COMPOSITION_METADATA.keys()),
        first_column_name=&quot;cell_id&quot;,
    )</div>



<div class="viewcode-block" id="read_snec_initial_quantities">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.read_snec_initial_quantities">[docs]</a>
def read_snec_initial_quantities(snec_output_dir: Path) -&gt; pd.DataFrame:
    &quot;&quot;&quot;
    Load the initial quantities data from SNEC output.

    Parameters
    ----------
    snec_output_dir : Path
        Path to the directory containing the SNEC output files.

    Returns
    -------
    pd.DataFrame
        DataFrame containing the initial quantities for each cell, indexed by cell ID.
    &quot;&quot;&quot;
    return read_snec_dat_output(
        snec_output_dir,
        list(SNEC_INITIAL_QUANTITIES_METADATA.keys()),
        first_column_name=&quot;cell_id&quot;,
    )</div>



<div class="viewcode-block" id="read_snec_em_output">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.read_snec_em_output">[docs]</a>
def read_snec_em_output(snec_output_dir: Path) -&gt; pd.DataFrame:
    &quot;&quot;&quot;
    Load the output quantities data from SNEC output.

    Parameters
    ----------
    snec_output_dir : Path
        Path to the directory containing the SNEC output files.

    Returns
    -------
    pd.DataFrame
        DataFrame containing the output quantities for each cell, indexed by cell ID.
    &quot;&quot;&quot;
    em_output_metadata = [
        item for item in SNEC_EM_OUTPUT_METADATA.keys() if not item.startswith(&quot;index_&quot;)
    ]
    em_index_output_metadata = [
        item for item in SNEC_EM_OUTPUT_METADATA.keys() if item.startswith(&quot;index_&quot;)
    ]

    em_output_df = read_snec_dat_output(
        snec_output_dir,
        em_output_metadata,
        first_column_name=&quot;time&quot;,
    )

    em_index_output_df = read_snec_dat_output(
        snec_output_dir,
        em_index_output_metadata,
        first_column_name=&quot;time&quot;,
    )

    npt.assert_allclose(em_output_df[&quot;time&quot;], em_index_output_df[&quot;time&quot;], rtol=1e-9)

    return em_output_df.join(em_index_output_df.iloc[:, 1:])</div>



<div class="viewcode-block" id="read_snec_output">
<a class="viewcode-back" href="../../../../../../api/tardis.io.model.readers.snec.snec_output.html#tardis.io.model.readers.snec.snec_output.read_snec_output">[docs]</a>
def read_snec_output(snec_output_dir: Path) -&gt; SNECOutput:
    &quot;&quot;&quot;
    Read SNEC output files and return a SNECOutput dataclass instance.

    Parameters
    ----------
    snec_output_dir : Path
        Path to the directory containing the SNEC output files.
    show_progress : bool, optional
        If True, show progress for reading xg files. Default is False.

    Returns
    -------
    SNECOutput
        Dataclass instance containing the SNEC output data.
    &quot;&quot;&quot;
    return SNECOutput(
        xg_data=read_snec_output_xg(snec_output_dir),
        initial_composition=read_snec_initial_composition(snec_output_dir),
        initial_quantities=read_snec_initial_quantities(snec_output_dir),
        em_output=read_snec_em_output(snec_output_dir),
    )</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 30 Jul 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>