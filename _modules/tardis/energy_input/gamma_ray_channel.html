

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.energy_input.gamma_ray_channel &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../_static/tardis_logo.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href="../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../io/hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/configuration/index.html">Configuration (Required Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../physics/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.energy_input.gamma_ray_channel</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.energy_input.gamma_ray_channel</h1><div class="highlight"><pre>
<span></span>import logging

import astropy.units as u
import numpy as np
import pandas as pd
import radioactivedecay as rd

from tardis.energy_input.util import KEV2ERG
from tardis.model.matter.decay import IsotopicMassFraction

logger = logging.getLogger(__name__)
logging.basicConfig(level=logging.INFO)


<div class="viewcode-block" id="create_isotope_dicts">
<a class="viewcode-back" href="../../../api/tardis.energy_input.gamma_ray_channel.html#tardis.energy_input.gamma_ray_channel.create_isotope_dicts">[docs]</a>
def create_isotope_dicts(raw_isotope_abundance, cell_masses):
    &quot;&quot;&quot;
    Function to create a dictionary of isotopes for each shell with their masses.

    Parameters
    ----------
    raw_isotope_abundance : pd.DataFrame
        isotope abundance in mass fractions.
    cell_masses : numpy.ndarray
        shell masses in units of g

    Returns
    -------
        isotope_dicts : Dict
            dictionary of isotopes for each shell with their ``masses``.
            Each value is abundance * cell masses.
            For eg: {0: {&#39;Ni56&#39;: 0.1, &#39;Fe52&#39;: 0.2, &#39;Cr48&#39;: 0.3},
                    {1: {&#39;Ni56&#39;: 0.1, &#39;Fe52&#39;: 0.2, &#39;Cr48&#39;: 0.3}} etc
    &quot;&quot;&quot;
    isotope_dicts = {}
    for i in range(len(raw_isotope_abundance.columns)):
        isotope_dicts[i] = {}
        for (
            atomic_number,
            mass_number,
        ), abundances in raw_isotope_abundance.iterrows():
            nuclear_symbol = f&quot;{rd.utils.Z_to_elem(atomic_number)}{mass_number}&quot;
            isotope_dicts[i][nuclear_symbol] = (
                abundances[i] * cell_masses[i].to(u.g).value
            )

    return isotope_dicts</div>



<div class="viewcode-block" id="create_inventories_dict">
<a class="viewcode-back" href="../../../api/tardis.energy_input.gamma_ray_channel.html#tardis.energy_input.gamma_ray_channel.create_inventories_dict">[docs]</a>
def create_inventories_dict(isotope_dict):
    &quot;&quot;&quot;Function to create dictionary of inventories for each shell

    Parameters
    ----------
    isotope_dict : Dict
        dictionary of isotopes for each shell with their ``masses``.

    Returns
    -------
        inv : Dict
            dictionary of inventories for each shell
            {0: &lt;radioactivedecay.inventory.Inventory object at 0x7f8b1c1b3d90&gt;,
            1: &lt;radioactivedecay.inventory.Inventory object at 0x7f8b1c1b3d90&gt;}

    &quot;&quot;&quot;
    inventories = {}
    for shell, isotopes in isotope_dict.items():
        inventories[shell] = rd.Inventory(isotopes, &quot;g&quot;)

    return inventories</div>



<div class="viewcode-block" id="calculate_total_decays">
<a class="viewcode-back" href="../../../api/tardis.energy_input.gamma_ray_channel.html#tardis.energy_input.gamma_ray_channel.calculate_total_decays">[docs]</a>
def calculate_total_decays(inventories, time_delta):
    &quot;&quot;&quot;Function to create inventories of isotope for the entire simulation time.

    Parameters
    ----------
    inventories : Dict
        dictionary of inventories for each shell

    time_end : float
        End time of simulation in days.


    Returns
    -------
    cumulative_decay_df : pd.DataFrame
        total decays for x g of isotope for time &#39;t&#39;
    &quot;&quot;&quot;
    time_delta = u.Quantity(time_delta, u.d)
    total_decays = {}
    for shell, inventory in inventories.items():
        total_decays[shell] = inventory.cumulative_decays(time_delta.value, &quot;d&quot;)

    flattened_dict = {}

    for shell, isotope_dict in total_decays.items():
        for isotope, num_of_decays in isotope_dict.items():
            new_key = isotope.replace(&quot;-&quot;, &quot;&quot;)
            flattened_dict[(shell, new_key)] = num_of_decays

    indices = pd.MultiIndex.from_tuples(
        flattened_dict.keys(), names=[&quot;shell_number&quot;, &quot;isotope&quot;]
    )
    cumulative_decay_df = pd.DataFrame(
        list(flattened_dict.values()),
        index=indices,
        columns=[&quot;number_of_decays&quot;],
    )

    return cumulative_decay_df</div>



<div class="viewcode-block" id="create_isotope_decay_df">
<a class="viewcode-back" href="../../../api/tardis.energy_input.gamma_ray_channel.html#tardis.energy_input.gamma_ray_channel.create_isotope_decay_df">[docs]</a>
def create_isotope_decay_df(cumulative_decay_df, gamma_ray_lines):
    &quot;&quot;&quot;
    Function to create a dataframe of isotopes for each shell with their decay mode, number of decays, radiation type,
    radiation energy and radiation intensity.

    Parameters
    ----------
    cumulative_decay_df : pd.DataFrame
        total decays for x g of isotope for time &#39;t&#39;
    gamma_ray_lines : pd.DataFrame
        gamma ray lines from nndc stored as a pandas dataframe.

    Returns
    -------
    isotope_decay_df : pd.DataFrame
        dataframe of isotopes for each shell with their decay mode, number of decays, radiation type,
        radiation energy and radiation intensity.
    &quot;&quot;&quot;
    gamma_ray_lines = gamma_ray_lines.rename_axis(
        &quot;isotope&quot;
    )  # renaming &quot;Isotope&quot; in nndc to &quot;isotope&quot;
    gamma_ray_lines.drop(columns=[&quot;A&quot;, &quot;Z&quot;])
    gamma_ray_lines_df = gamma_ray_lines[
        [&quot;Decay Mode&quot;, &quot;Radiation&quot;, &quot;Rad Energy&quot;, &quot;Rad Intensity&quot;]
    ]  # selecting from existing dataframe

    columns = [
        &quot;decay_mode&quot;,
        &quot;radiation&quot;,
        &quot;radiation_energy_keV&quot;,
        &quot;radiation_intensity&quot;,
    ]
    gamma_ray_lines_df.columns = columns
    isotope_decay_df = pd.merge(
        cumulative_decay_df.reset_index(),
        gamma_ray_lines_df.reset_index(),
        on=[&quot;isotope&quot;],
    )
    isotope_decay_df = isotope_decay_df.set_index([&quot;shell_number&quot;, &quot;isotope&quot;])
    isotope_decay_df[&quot;decay_mode&quot;] = isotope_decay_df[&quot;decay_mode&quot;].astype(
        &quot;category&quot;
    )
    isotope_decay_df[&quot;radiation&quot;] = isotope_decay_df[&quot;radiation&quot;].astype(
        &quot;category&quot;
    )
    isotope_decay_df[&quot;energy_per_channel_keV&quot;] = (
        isotope_decay_df[&quot;radiation_intensity&quot;]
        / 100.0
        * isotope_decay_df[&quot;radiation_energy_keV&quot;]
    )
    isotope_decay_df[&quot;decay_energy_keV&quot;] = (
        isotope_decay_df[&quot;energy_per_channel_keV&quot;]
        * isotope_decay_df[&quot;number_of_decays&quot;]
    )
    isotope_decay_df[&quot;decay_energy_erg&quot;] = (
        isotope_decay_df[&quot;decay_energy_keV&quot;] * KEV2ERG
    )

    return isotope_decay_df</div>



<div class="viewcode-block" id="time_evolve_mass_fraction">
<a class="viewcode-back" href="../../../api/tardis.energy_input.gamma_ray_channel.html#tardis.energy_input.gamma_ray_channel.time_evolve_mass_fraction">[docs]</a>
def time_evolve_mass_fraction(raw_isotope_mass_fraction, time_array):
    &quot;&quot;&quot;
    Function to evolve the mass fraction of isotopes with time.

    Parameters
    ----------
    raw_isotope_mass_fraction : pd.DataFrame
        isotope mass fraction in mass fractions.
    time_array : np.array
        array of time in days.

    Returns
    -------
    time_evolved_isotope_mass_fraction : pd.DataFrame
        time evolved mass fraction of isotopes.
    &quot;&quot;&quot;
    initial_isotope_mass_fraction = raw_isotope_mass_fraction
    isotope_mass_fraction_list = []
    dt = np.diff(time_array)
    t_start = time_array[:-1]
    t_end = time_array[1:]
    t_start_index = np.indices(t_start.shape)[0]

    for time in dt:
        decayed_isotope_mass_fraction = IsotopicMassFraction(
            initial_isotope_mass_fraction
        ).decay(time)
        isotope_mass_fraction_list.append(decayed_isotope_mass_fraction)
        initial_isotope_mass_fraction = decayed_isotope_mass_fraction

    time_keys = list(zip(t_start, t_end, t_start_index))

    time_evolved_isotope_mass_fraction = pd.concat(
        isotope_mass_fraction_list, keys=time_keys, names=[&quot;time_start&quot;, &quot;time_end&quot;, &quot;time_index&quot;],
    )

    return time_evolved_isotope_mass_fraction</div>



<div class="viewcode-block" id="time_evolve_cumulative_decay">
<a class="viewcode-back" href="../../../api/tardis.energy_input.gamma_ray_channel.html#tardis.energy_input.gamma_ray_channel.time_evolve_cumulative_decay">[docs]</a>
def time_evolve_cumulative_decay(
    raw_isotope_mass_fraction, shell_masses, gamma_ray_lines, time_array
):
    &quot;&quot;&quot;
    Function to calculate the total decays for each isotope for each shell at each time step.

    Parameters
    ----------
    raw_isotope_mass_fraction : pd.DataFrame
        isotope abundance in mass fractions.
    shell_masses : numpy.ndarray
        shell masses in units of g
    gamma_ray_lines : pd.DataFrame
        gamma ray lines from nndc stored as a pandas dataframe.
    time_array : numpy.ndarray
        array of time steps in days.

    Returns
    -------
    time_evolve_decay_df : pd.DataFrame
        dataframe of isotopes for each shell with their decay mode, number of decays, radiation type,
        radiation energy and radiation intensity at each time step.

    &quot;&quot;&quot;
    isotope_decay_df_list = []
    initial_isotope_mass_fraction = raw_isotope_mass_fraction

    dt = np.diff(time_array)
    t_start = time_array[:-1]
    t_end = time_array[1:]
    t_start_index = np.indices(time_array.shape)[0]
    # Do not append dataframes to empty lists. This will be modified in future.
    for time in dt:
        isotope_dict = create_isotope_dicts(
            initial_isotope_mass_fraction, shell_masses
        )
        inventories = create_inventories_dict(isotope_dict)
        total_decays = calculate_total_decays(inventories, time)
        isotope_df_time = create_isotope_decay_df(total_decays, gamma_ray_lines)
        isotope_decay_df_list.append(isotope_df_time)

        decayed_isotope_mass_fraction = IsotopicMassFraction(
            initial_isotope_mass_fraction
        ).decay(time)

        initial_isotope_mass_fraction = decayed_isotope_mass_fraction

    time_keys = list(zip(t_start, t_end, t_start_index))

    time_evolved_decay_df = pd.concat(
        isotope_decay_df_list, keys=time_keys, names=[&quot;time_start&quot;, &quot;time_end&quot;, &quot;time_index&quot;],
    )

    return time_evolved_decay_df</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 19 May 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>