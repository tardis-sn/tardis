

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.transport.montecarlo.packet_source.base &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../../../_static/tardis_logo.ico"/>
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=ea1dc457"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link href="../../../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../api/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/visualization_reference.html">Visualization Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.transport.montecarlo.packet_source.base</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.transport.montecarlo.packet_source.base</h1><div class="highlight"><pre>
<span></span>import abc
from typing import Any

import numpy as np
from astropy import units as u

from tardis import constants as const
from tardis.transport.montecarlo.packets.packet_collections import (
    PacketCollection,
)


<div class="viewcode-block" id="BasePacketSource">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource">[docs]</a>
class BasePacketSource(abc.ABC):
    &quot;&quot;&quot;
    Abstract base packet source.

    This abstract base class defines the interface for packet sources used in
    TARDIS Monte Carlo radiative transfer. Packet sources are responsible
    for creating radiation packets with specific properties.

    Parameters
    ----------
    base_seed : int, optional
        Base seed for random number generator. Default is None.
    legacy_mode_enabled : bool, optional
        Whether to enable legacy mode for compatibility. Default is False.
    legacy_second_seed : int, optional
        Secondary seed for global numpy rng (Deprecated: Legacy reasons only).
        Default is None.

    Attributes
    ----------
    MAX_SEED_VAL : int
        Maximum seed value allowed by numpy (2**32 - 1).
    base_seed : int or None
        Base seed for random number generator.
    legacy_mode_enabled : bool
        Whether legacy mode is enabled.
    rng : numpy.random.Generator
        Random number generator instance.
    &quot;&quot;&quot;

    # MAX_SEED_VAL must be multiple orders of magnitude larger than no_of_packets;
    # otherwise, each packet would not have its own seed. Here, we set the max
    # seed val to the maximum allowed by numpy.
    MAX_SEED_VAL: int = 2**32 - 1

    def __init__(
        self,
        base_seed: &quot;int | None&quot; = None,
        legacy_mode_enabled: bool = False,
        legacy_second_seed: &quot;int | None&quot; = None,
    ) -&gt; None:
        self.base_seed = base_seed
        self.legacy_mode_enabled = legacy_mode_enabled
        if self.legacy_mode_enabled and legacy_second_seed is not None:
            np.random.seed(legacy_second_seed)
        else:
            np.random.seed(self.base_seed)

    def _reseed(self, seed: int) -&gt; None:
        &quot;&quot;&quot;
        Reseed the random number generator.

        Parameters
        ----------
        seed : int
            Seed value for the random number generator.
        &quot;&quot;&quot;
        self.rng = np.random.default_rng(seed=seed)

    # One should either implement create_packet_velocities or create_packet_radii
<div class="viewcode-block" id="BasePacketSource.create_packet_radii">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.create_packet_radii">[docs]</a>
    def create_packet_radii(self, no_of_packets: int, *args: Any, **kwargs: Any):
        &quot;&quot;&quot;
        Create packet radii.

        This method should be implemented by subclasses that create packets
        with specific radii. Either this method or create_packet_velocities
        should be implemented.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        *args
            Additional positional arguments.
        **kwargs
            Additional keyword arguments.

        Returns
        -------
        array-like
            Packet radii values.

        Raises
        ------
        NotImplementedError
            If the method is not implemented by the subclass.
        &quot;&quot;&quot;
        raise NotImplementedError(
            &quot;Subclasses must implement either create_packet_radii or create_packet_velocities&quot;
        )</div>


<div class="viewcode-block" id="BasePacketSource.create_packet_velocities">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.create_packet_velocities">[docs]</a>
    def create_packet_velocities(self, no_of_packets: int, *args: Any, **kwargs: Any):
        &quot;&quot;&quot;
        Create packet velocities.

        This method should be implemented by subclasses that create packets
        with specific velocities. Either this method or create_packet_radii
        should be implemented.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        *args
            Additional positional arguments.
        **kwargs
            Additional keyword arguments.

        Returns
        -------
        array-like
            Packet velocity values.

        Raises
        ------
        NotImplementedError
            If the method is not implemented by the subclass.
        &quot;&quot;&quot;
        raise NotImplementedError(
            &quot;Subclasses must implement either create_packet_radii or create_packet_velocities&quot;
        )</div>


<div class="viewcode-block" id="BasePacketSource.create_packet_nus">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.create_packet_nus">[docs]</a>
    @abc.abstractmethod
    def create_packet_nus(self, no_of_packets: int, *args: Any, **kwargs: Any):
        &quot;&quot;&quot;
        Create packet frequencies.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        *args
            Additional positional arguments.
        **kwargs
            Additional keyword arguments.

        Returns
        -------
        array-like
            Packet frequency values.
        &quot;&quot;&quot;</div>


<div class="viewcode-block" id="BasePacketSource.create_packet_mus">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.create_packet_mus">[docs]</a>
    @abc.abstractmethod
    def create_packet_mus(self, no_of_packets: int, *args: Any, **kwargs: Any):
        &quot;&quot;&quot;
        Create packet direction cosines.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        *args
            Additional positional arguments.
        **kwargs
            Additional keyword arguments.

        Returns
        -------
        array-like
            Packet direction cosine values.
        &quot;&quot;&quot;</div>


<div class="viewcode-block" id="BasePacketSource.create_packet_energies">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.create_packet_energies">[docs]</a>
    @abc.abstractmethod
    def create_packet_energies(self, no_of_packets: int, *args: Any, **kwargs: Any):
        &quot;&quot;&quot;
        Create packet energies.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        *args
            Additional positional arguments.
        **kwargs
            Additional keyword arguments.

        Returns
        -------
        array-like
            Packet energy values.
        &quot;&quot;&quot;</div>


<div class="viewcode-block" id="BasePacketSource.create_packets">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.create_packets">[docs]</a>
    def create_packets(
        self,
        no_of_packets: int,
        seed_offset: int = 0,
        *args: Any,
        **kwargs: Any,
    ) -&gt; PacketCollection:
        &quot;&quot;&quot;
        Generate packet properties as arrays.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        seed_offset : int, optional
            Offset added to the base seed for randomness across iterations.
            Default is 0.
        *args
            Additional positional arguments passed to packet creation methods.
        **kwargs
            Additional keyword arguments passed to packet creation methods.

        Returns
        -------
        PacketCollection
            Collection containing packet radii, frequencies, directions,
            energies, seeds, and radiation field luminosity.
        &quot;&quot;&quot;
        # the iteration (passed as seed_offset) is added each time to preserve randomness
        # across different simulations with the same temperature,
        # for example. We seed the random module instead of the numpy module
        # because we call random.sample, which references a different internal
        # state than in the numpy.random module.
        if self.base_seed is None:
            raise ValueError(&quot;base_seed must be set before creating packets&quot;)
        self._reseed(self.base_seed + seed_offset)
        packet_seeds = self.rng.choice(
            self.MAX_SEED_VAL, no_of_packets, replace=True
        )

        radii = self.create_packet_radii(no_of_packets, *args, **kwargs).value
        nus = self.create_packet_nus(no_of_packets, *args, **kwargs).value
        mus = self.create_packet_mus(no_of_packets, *args, **kwargs)
        energies = self.create_packet_energies(
            no_of_packets, *args, **kwargs
        ).value
        # Check if all arrays have the same length
        assert (
            len(radii) == len(nus) == len(mus) == len(energies) == no_of_packets
        )
        radiation_field_luminosity = self.calculate_radfield_luminosity().value
        return PacketCollection(
            radii,
            nus,
            mus,
            energies,
            packet_seeds,
            radiation_field_luminosity,
        )</div>


<div class="viewcode-block" id="BasePacketSource.calculate_radfield_luminosity">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.base.html#tardis.transport.montecarlo.packet_source.BasePacketSource.calculate_radfield_luminosity">[docs]</a>
    def calculate_radfield_luminosity(self) -&gt; u.Quantity:
        &quot;&quot;&quot;
        Calculate inner luminosity from blackbody radiation.

        Uses the Stefan-Boltzmann law to calculate the luminosity from
        the inner boundary radius and temperature.

        Returns
        -------
        astropy.units.Quantity
            Inner luminosity in erg/s.
        &quot;&quot;&quot;
        return (
            4
            * np.pi
            * const.sigma_sb
            * self.radius**2
            * self.temperature**4
        ).to(&quot;erg/s&quot;)</div>
</div>





</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 04 Sep 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>