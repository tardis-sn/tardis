

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.transport.montecarlo.packet_source.black_body_relativistic &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../../../_static/tardis_logo.ico"/>
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=d1690252"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link href="../../../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics_walkthrough/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../api/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/visualization_reference.html">Visualization Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.transport.montecarlo.packet_source.black_body_relativistic</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.transport.montecarlo.packet_source.black_body_relativistic</h1><div class="highlight"><pre>
<span></span>from typing import Any

import numpy as np
from astropy import units as u

from tardis import constants as const
from tardis.io.hdf_writer_mixin import HDFWriterMixin
from tardis.transport.montecarlo.packet_source.black_body import (
    BlackBodySimpleSource,
)
from tardis.transport.montecarlo.packets.packet_collections import (
    PacketCollection,
)


<div class="viewcode-block" id="BlackBodySimpleSourceRelativistic">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.black_body_relativistic.html#tardis.transport.montecarlo.packet_source.BlackBodySimpleSourceRelativistic">[docs]</a>
class BlackBodySimpleSourceRelativistic(BlackBodySimpleSource, HDFWriterMixin):
    &quot;&quot;&quot;
    Relativistic blackbody packet source for Monte Carlo simulations.

    This class generates blackbody packets with relativistic corrections
    for sources that are moving with respect to the lab frame. It accounts
    for the motion of the inner boundary where packets are created.

    Parameters
    ----------
    time_explosion : astropy.units.Quantity
        Time elapsed since explosion.
    radius : astropy.units.Quantity
        Initial packet radius.
    temperature : astropy.units.Quantity
        Absolute temperature.
    base_seed : int, optional
        Base seed for random number generator.
    legacy_secondary_seed : int, optional
        Secondary seed for global numpy rng (Deprecated: Legacy reasons only).

    Attributes
    ----------
    time_explosion : astropy.units.Quantity
        Time elapsed since explosion.
    beta : float
        Velocity of the inner boundary as a fraction of speed of light.
    &quot;&quot;&quot;

    hdf_properties = [&quot;time_explosion&quot;, &quot;radius&quot;, &quot;temperature&quot;, &quot;base_seed&quot;]

<div class="viewcode-block" id="BlackBodySimpleSourceRelativistic.from_simulation_state">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.black_body_relativistic.html#tardis.transport.montecarlo.packet_source.BlackBodySimpleSourceRelativistic.from_simulation_state">[docs]</a>
    @classmethod
    def from_simulation_state(
        cls, simulation_state, *args: Any, **kwargs: Any
    ) -&gt; &quot;BlackBodySimpleSourceRelativistic&quot;:
        &quot;&quot;&quot;
        Create BlackBodySimpleSourceRelativistic from simulation state.

        Parameters
        ----------
        simulation_state : SimulationState
            The simulation state object containing explosion time, inner radius, and temperature.
        *args : Any
            Additional positional arguments.
        **kwargs : Any
            Additional keyword arguments.

        Returns
        -------
        BlackBodySimpleSourceRelativistic
            New instance initialized with simulation state parameters.
        &quot;&quot;&quot;
        return cls(
            simulation_state.time_explosion,
            simulation_state.r_inner[0],
            simulation_state.t_inner,
            *args,
            **kwargs,
        )</div>


    def __init__(
        self, time_explosion: &quot;u.Quantity | None&quot; = None, **kwargs: Any
    ) -&gt; None:
        &quot;&quot;&quot;
        Initialize BlackBodySimpleSourceRelativistic.

        Parameters
        ----------
        time_explosion : astropy.units.Quantity, optional
            Time elapsed since explosion. Default is None.
        **kwargs : Any
            Additional keyword arguments passed to parent class.
        &quot;&quot;&quot;
        self.time_explosion = time_explosion
        super().__init__(**kwargs)

<div class="viewcode-block" id="BlackBodySimpleSourceRelativistic.create_packets">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.black_body_relativistic.html#tardis.transport.montecarlo.packet_source.BlackBodySimpleSourceRelativistic.create_packets">[docs]</a>
    def create_packets(
        self, no_of_packets: int, *args: Any, **kwargs: Any
    ) -&gt; PacketCollection:
        &quot;&quot;&quot;
        Generate relativistic black-body packet properties as arrays.

        Calculates the velocity (beta) of the inner boundary and applies
        relativistic corrections to packet creation.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.
        *args : Any
            Additional positional arguments.
        **kwargs : Any
            Additional keyword arguments.

        Returns
        -------
        PacketCollection
            Collection of packets with relativistic corrections applied.

        Raises
        ------
        ValueError
            If radius or time_explosion is not set.
        &quot;&quot;&quot;
        if self.radius is None or self.time_explosion is None:
            raise ValueError(&quot;Black body Radius or Time of Explosion isn&#39;t set&quot;)
        self.beta = ((self.radius / self.time_explosion) / const.c).to(u.dimensionless_unscaled).value
        return super().create_packets(no_of_packets, *args, **kwargs)</div>


<div class="viewcode-block" id="BlackBodySimpleSourceRelativistic.create_packet_mus">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.black_body_relativistic.html#tardis.transport.montecarlo.packet_source.BlackBodySimpleSourceRelativistic.create_packet_mus">[docs]</a>
    def create_packet_mus(self, no_of_packets: int) -&gt; np.ndarray:
        &quot;&quot;&quot;
        Create relativistic packet direction cosines.

        Direction cosines are distributed according to the relativistic transformation
        :math:`\\mu^\\prime=2 \\frac{\\mu^\\prime + \\beta}{2 \\beta + 1}`.
        The distribution accounts for the fact that the inner boundary
        on which the packets are initialized is not comoving with the material.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.

        Returns
        -------
        numpy.ndarray
            Array of relativistically corrected direction cosines for packets.
        &quot;&quot;&quot;
        z = self.rng.random(no_of_packets)
        beta = self.beta
        return -beta + np.sqrt(beta**2 + 2 * beta * z + z)</div>


<div class="viewcode-block" id="BlackBodySimpleSourceRelativistic.create_packet_energies">
<a class="viewcode-back" href="../../../../../api/tardis.transport.montecarlo.packet_source.black_body_relativistic.html#tardis.transport.montecarlo.packet_source.BlackBodySimpleSourceRelativistic.create_packet_energies">[docs]</a>
    def create_packet_energies(self, no_of_packets: int) -&gt; u.Quantity:
        &quot;&quot;&quot;
        Create relativistic packet energies with uniform distribution.

        Uniformly distribute energy in arbitrary units where the ensemble of
        packets has total energy corrected for relativistic effects. Applies
        corrections for the static inner boundary to comoving frame transformation
        and time dilation.

        Parameters
        ----------
        no_of_packets : int
            Number of packets to create.

        Returns
        -------
        astropy.units.Quantity
            Array of packet energies in erg with relativistic corrections.
        &quot;&quot;&quot;
        beta = self.beta
        gamma = 1.0 / np.sqrt(1 - beta**2)
        static_inner_boundary2cmf_factor = (2 * beta + 1) / (1 - beta**2)
        energies = np.ones(no_of_packets) / no_of_packets
        # In principle, the factor gamma should be applied to the time of
        # simulation to account for time dilation between the lab and comoving
        # frame. However, all relevant quantities (luminosities, estimators, ...)
        # are calculated as ratios of packet energies and the time of simulation.
        # Thus, we can absorb the factor gamma in the packet energies, which is
        # more convenient.
        return energies * static_inner_boundary2cmf_factor / gamma * u.erg</div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 10 Nov 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>