

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.visualization.widgets.shell_info &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../../../_static/tardis_logo.ico"/>
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href="../../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/configuration/index.html">Configuration (Required Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../io/output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../physics/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tardis.visualization.widgets.shell_info</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tardis.visualization.widgets.shell_info</h1><div class="highlight"><pre>
<span></span>import ipywidgets as ipw
import pandas as pd

from tardis.util.base import (
    atomic_number2element_symbol,
    is_notebook,
    species_tuple_to_string,
)
from tardis.visualization.widgets.util import create_table_widget


<div class="viewcode-block" id="BaseShellInfo">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.BaseShellInfo">[docs]</a>
class BaseShellInfo:
    &quot;&quot;&quot;The simulation information that is used by shell info widget&quot;&quot;&quot;

    def __init__(
        self,
        t_radiative,
        dilution_factor,
        abundance,
        number_density,
        ion_number_density,
        level_number_density,
    ):
        &quot;&quot;&quot;Initialize the object with all simulation properties in use

        Parameters
        ----------
        t_radiative : array_like
            Radiative Temperature of each shell of simulation
        dilution_factor : array_like
            Dilution Factor (W) of each shell of simulation model
        abundance : pandas.DataFrame
            Fractional abundance of elements where row labels are atomic number
            and column labels are shell number
        number_density : pandas.DataFrame
            Number densities of elements where row labels are atomic number and
            column labels are shell numbers
        ion_number_density : pandas.DataFrame
            Number densities of ions where rows are multi-indexed with (atomic
            number, ion number) and column labels are shell number
        level_number_density : pandas.DataFrame
            Number densities of levels where rows are multi-indexed with (atomic
            number, ion number, level number) and column labels are shell number
        &quot;&quot;&quot;
        self.t_radiative = t_radiative
        self.dilution_factor = dilution_factor
        self.abundance = abundance
        self.number_density = number_density
        self.ion_number_density = ion_number_density
        self.level_number_density = level_number_density

<div class="viewcode-block" id="BaseShellInfo.shells_data">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.BaseShellInfo.shells_data">[docs]</a>
    def shells_data(self):
        &quot;&quot;&quot;Generates shells data in a form that can be used by a table widget

        Returns
        -------
        pandas.DataFrame
            Dataframe containing Rad. Temp. and W against each shell of
            simulation model
        &quot;&quot;&quot;
        shells_temp_w = pd.DataFrame(
            {
                &quot;Rad. Temp.&quot;: self.t_radiative,
                &quot;Dilution Factor&quot;: self.dilution_factor,
            }
        )
        shells_temp_w.index = range(
            1, len(self.t_radiative) + 1
        )  # Overwrite index
        shells_temp_w.index.name = &quot;Shell No.&quot;
        # Format to string to make qgrid show values in scientific notations
        return shells_temp_w.map(lambda x: f&quot;{x:.6e}&quot;)</div>


<div class="viewcode-block" id="BaseShellInfo.element_count">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.BaseShellInfo.element_count">[docs]</a>
    def element_count(self, shell_num):
        &quot;&quot;&quot;Generates fractional abundance of elements present in a specific
        shell in a form that can be used by a table widget

        Parameters
        ----------
        shell_num : int
            Shell number (note: starts from 1, not 0 which is what simulation
            model use)

        Returns
        -------
        pandas.DataFrame
            Dataframe containing element symbol and fractional abundance in a
            specific shell, against each atomic number
        &quot;&quot;&quot;
        element_count_data = self.abundance[shell_num - 1].copy()
        element_count_data.index.name = &quot;Z&quot;
        element_count_data = element_count_data.fillna(0)
        return pd.DataFrame(
            {
                &quot;Element&quot;: element_count_data.index.map(
                    atomic_number2element_symbol
                ),
                # Format to string to show in scientific notation
                f&quot;Frac. Ab. (Shell {shell_num})&quot;: element_count_data.map(
                    &quot;{:.6e}&quot;.format
                ),
            }
        )</div>


<div class="viewcode-block" id="BaseShellInfo.ion_count">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.BaseShellInfo.ion_count">[docs]</a>
    def ion_count(self, atomic_num, shell_num):
        &quot;&quot;&quot;Generates fractional abundance of ions of a specific element and
        shell, in a form that can be used by a table widget

        Parameters
        ----------
        atomic_num : int
            Atomic number of element
        shell_num : int
            Shell number (note: starts from 1, not 0 which is what simulation
            model use)

        Returns
        -------
        pandas.DataFrame
            Dataframe containing ion specie and fractional abundance for a
            specific element, against each ion number
        &quot;&quot;&quot;
        ion_num_density = self.ion_number_density[shell_num - 1].loc[atomic_num]
        element_num_density = self.number_density.loc[atomic_num, shell_num - 1]
        ion_count_data = ion_num_density / element_num_density  # Normalization
        ion_count_data.index.name = &quot;Ion&quot;
        ion_count_data = ion_count_data.fillna(0)
        return pd.DataFrame(
            {
                &quot;Species&quot;: ion_count_data.index.map(
                    lambda x: species_tuple_to_string((atomic_num, x))
                ),
                f&quot;Frac. Ab. (Z={atomic_num})&quot;: ion_count_data.map(
                    &quot;{:.6e}&quot;.format
                ),
            }
        )</div>


<div class="viewcode-block" id="BaseShellInfo.level_count">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.BaseShellInfo.level_count">[docs]</a>
    def level_count(self, ion, atomic_num, shell_num):
        &quot;&quot;&quot;Generates fractional abundance of levels of a specific ion, element
        and shell, in a form that can be used by a table widget

        Parameters
        ----------
        ion : int
            Ion number (note: starts from 0, same what is used by simulation
            model)
        atomic_num : int
            Atomic number of element
        shell_num : int
            Shell number (note: starts from 1, not 0 which is what simulation
            model use)

        Returns
        -------
        pandas.DataFrame
            Dataframe containing fractional abundance for a specific ion,
            against each level number
        &quot;&quot;&quot;
        level_num_density = self.level_number_density[shell_num - 1].loc[
            atomic_num, ion
        ]
        ion_num_density = self.ion_number_density[shell_num - 1].loc[
            atomic_num, ion
        ]
        level_count_data = level_num_density / ion_num_density  # Normalization
        level_count_data.index.name = &quot;Level&quot;
        level_count_data.name = f&quot;Frac. Ab. (Ion={ion})&quot;
        level_count_data = level_count_data.fillna(0)
        return level_count_data.map(&quot;{:.6e}&quot;.format).to_frame()</div>
</div>



<div class="viewcode-block" id="SimulationShellInfo">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.SimulationShellInfo">[docs]</a>
class SimulationShellInfo(BaseShellInfo):
    &quot;&quot;&quot;The simulation information that is used by shell info widget, obtained
    from a TARDIS Simulation object
    &quot;&quot;&quot;

    def __init__(self, sim_model):
        &quot;&quot;&quot;Initialize the object with TARDIS Simulation object

        Parameters
        ----------
        sim_model : tardis.simulation.Simulation
            TARDIS Simulation object produced by running a simulation
        &quot;&quot;&quot;
        super().__init__(
            sim_model.simulation_state.t_radiative,
            sim_model.simulation_state.dilution_factor,
            sim_model.simulation_state.abundance,
            sim_model.plasma.number_density,
            sim_model.plasma.ion_number_density,
            sim_model.plasma.level_number_density,
        )</div>



<div class="viewcode-block" id="HDFShellInfo">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.HDFShellInfo">[docs]</a>
class HDFShellInfo(BaseShellInfo):
    &quot;&quot;&quot;The simulation information that is used by shell info widget, obtained
    from a simulation HDF file
    &quot;&quot;&quot;

    def __init__(self, hdf_fpath):
        &quot;&quot;&quot;Initialize the object with a simulation HDF file

        Parameters
        ----------
        hdf_fpath : str
            A valid path to a simulation HDF file (HDF file must be created
            from a TARDIS Simulation object using :code:`to_hdf` method with
            default arguments)
        &quot;&quot;&quot;
        with pd.HDFStore(hdf_fpath, &quot;r&quot;) as sim_data:
            super().__init__(
                sim_data[&quot;/simulation/simulation_state/t_radiative&quot;],
                sim_data[&quot;/simulation/simulation_state/dilution_factor&quot;],
                sim_data[&quot;/simulation/simulation_state/abundance&quot;],
                sim_data[&quot;/simulation/plasma/number_density&quot;],
                sim_data[&quot;/simulation/plasma/ion_number_density&quot;],
                sim_data[&quot;/simulation/plasma/level_number_density&quot;],
            )</div>



<div class="viewcode-block" id="ShellInfoWidget">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.ShellInfoWidget">[docs]</a>
class ShellInfoWidget:
    &quot;&quot;&quot;The Shell Info Widget to explore abundances in different shells.

    It consists of four interlinked table widgets - shells table; element count,
    ion count and level count tables - allowing to explore fractional abundances
    all the way from elements, to ions, to levels by clicking on the rows of
    tables.
    &quot;&quot;&quot;

    def __init__(self, shell_info_data):
        &quot;&quot;&quot;Initialize the object with the shell information of a simulation
        model

        Parameters
        ----------
        shell_info_data : subclass of BaseShellInfo
            Shell information object constructed from Simulation object or HDF
            file
        &quot;&quot;&quot;
        self.data = shell_info_data

        # Creating the shells data table widget
        self.shells_table = create_table_widget(
            self.data.shells_data(), [30, 35, 35]
        )

        # Creating the element count table widget
        self.element_count_table = create_table_widget(
            self.data.element_count(self.shells_table.df.index[0]),
            [15, 30, 55],
            changeable_col={
                &quot;index&quot;: -1,  # since last column will change names
                # Shells table index will give all possible shell numbers
                &quot;other_names&quot;: [
                    f&quot;Frac. Ab. (Shell {shell_num})&quot;
                    for shell_num in self.shells_table.df.index
                ],
            },
        )

        # Creating the ion count table widget
        self.ion_count_table = create_table_widget(
            self.data.ion_count(
                self.element_count_table.df.index[0],
                self.shells_table.df.index[0],
            ),
            [20, 30, 50],
            changeable_col={
                &quot;index&quot;: -1,
                # Since element are same for each shell thus previous table
                # (element counts for shell 1) will give all possible elements
                &quot;other_names&quot;: [
                    f&quot;Frac. Ab. (Z={atomic_num})&quot;
                    for atomic_num in self.element_count_table.df.index
                ],
            },
        )

        # Creating the level count table widget
        self.level_count_table = create_table_widget(
            self.data.level_count(
                self.ion_count_table.df.index[0],
                self.element_count_table.df.index[0],
                self.shells_table.df.index[0],
            ),
            [30, 70],
            changeable_col={
                &quot;index&quot;: -1,
                # Ion values range from 0 to max atomic_num present in
                # element count table
                &quot;other_names&quot;: [
                    f&quot;Frac. Ab. (Ion={ion})&quot;
                    for ion in range(
                        self.element_count_table.df.index.max() + 1
                    )
                ],
            },
        )

<div class="viewcode-block" id="ShellInfoWidget.update_element_count_table">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.ShellInfoWidget.update_element_count_table">[docs]</a>
    def update_element_count_table(self, event, qgrid_widget):
        &quot;&quot;&quot;Event listener to update the data in element count table widget based
        on interaction (row selected event) in shells table widget.

        Parameters
        ----------
        event : dict
            Dictionary that holds information about event (see Notes section)
        qgrid_widget : qgrid.QgridWidget
            QgridWidget instance that fired the event (see Notes section)

        Notes
        -----
        You will never need to pass any of these arguments explicitly. This is
        the expected signature of the function passed to :code:`handler` argument
        of :code:`on` method of a table widget (qgrid.QgridWidget object) as
        explained in `qrid documentation &lt;https://qgrid.readthedocs.io/en/latest/#qgrid.QgridWidget.on&gt;`_.
        &quot;&quot;&quot;
        # Get shell number from row selected in shells_table
        shell_num = event[&quot;new&quot;][0] + 1

        # Update data in element_count_table
        self.element_count_table.df = self.data.element_count(shell_num)

        # Get atomic_num of 0th row of element_count_table
        atomic_num0 = self.element_count_table.df.index[0]

        # Also update next table (ion counts) by triggering its event listener
        # Listener won&#39;t trigger if last row selected in element_count_table was also 0th
        if self.element_count_table.get_selected_rows() == [0]:
            self.element_count_table.change_selection([])  # Unselect rows
        # Select 0th row in count table which will trigger update_ion_count_table
        self.element_count_table.change_selection([atomic_num0])</div>


<div class="viewcode-block" id="ShellInfoWidget.update_ion_count_table">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.ShellInfoWidget.update_ion_count_table">[docs]</a>
    def update_ion_count_table(self, event, qgrid_widget):
        &quot;&quot;&quot;Event listener to update the data in ion count table widget based
        on interaction (row selected event) in element count table widget.

        Parameters
        ----------
        event : dict
            Dictionary that holds information about event (see Notes section)
        qgrid_widget : qgrid.QgridWidget
            QgridWidget instance that fired the event (see Notes section)

        Notes
        -----
        You will never need to pass any of these arguments explicitly. This is
        the expected signature of the function passed to :code:`handler` argument
        of :code:`on` method of a table widget (qgrid.QgridWidget object) as
        explained in `qrid documentation &lt;https://qgrid.readthedocs.io/en/latest/#qgrid.QgridWidget.on&gt;`_.
        &quot;&quot;&quot;
        # Don&#39;t execute function if no row was selected, implicitly i.e. by api
        if event[&quot;new&quot;] == [] and event[&quot;source&quot;] == &quot;api&quot;:
            return

        # Get shell no. &amp; atomic_num from rows selected in previous tables
        shell_num = self.shells_table.get_selected_rows()[0] + 1
        atomic_num = self.element_count_table.df.index[event[&quot;new&quot;][0]]

        # Update data in ion_count_table
        self.ion_count_table.df = self.data.ion_count(atomic_num, shell_num)

        # Also update next table (level counts) by triggering its event listener
        ion0 = self.ion_count_table.df.index[0]
        if self.ion_count_table.get_selected_rows() == [0]:
            self.ion_count_table.change_selection([])
        self.ion_count_table.change_selection([ion0])</div>


<div class="viewcode-block" id="ShellInfoWidget.update_level_count_table">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.ShellInfoWidget.update_level_count_table">[docs]</a>
    def update_level_count_table(self, event, qgrid_widget):
        &quot;&quot;&quot;Event listener to update the data in level count table widget based
        on interaction (row selected event) in ion count table widget.

        Parameters
        ----------
        event : dict
            Dictionary that holds information about event (see Notes section)
        qgrid_widget : qgrid.QgridWidget
            QgridWidget instance that fired the event (see Notes section)

        Notes
        -----
        You will never need to pass any of these arguments explicitly. This is
        the expected signature of the function passed to :code:`handler` argument
        of :code:`on` method of a table widget (qgrid.QgridWidget object) as
        explained in `qrid documentation &lt;https://qgrid.readthedocs.io/en/latest/#qgrid.QgridWidget.on&gt;`_.
        &quot;&quot;&quot;
        # Don&#39;t execute function if no row was selected implicitly (by api)
        if event[&quot;new&quot;] == [] and event[&quot;source&quot;] == &quot;api&quot;:
            return

        # Get shell no., atomic_num, ion from selected rows in previous tables
        shell_num = self.shells_table.get_selected_rows()[0] + 1
        atomic_num = self.element_count_table.df.index[
            self.element_count_table.get_selected_rows()[0]
        ]
        ion = self.ion_count_table.df.index[event[&quot;new&quot;][0]]

        # Update data in level_count_table
        self.level_count_table.df = self.data.level_count(
            ion, atomic_num, shell_num
        )</div>


<div class="viewcode-block" id="ShellInfoWidget.display">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.ShellInfoWidget.display">[docs]</a>
    def display(
        self,
        shells_table_width=&quot;30%&quot;,
        element_count_table_width=&quot;24%&quot;,
        ion_count_table_width=&quot;24%&quot;,
        level_count_table_width=&quot;18%&quot;,
        **layout_kwargs,
    ):
        &quot;&quot;&quot;Display the shell info widget by putting all component widgets nicely
        together and allowing interaction between the table widgets

        Parameters
        ----------
        shells_table_width : str, optional
            CSS :code:`width` property value for shells table, by default &#39;30%&#39;
        element_count_table_width : str, optional
            CSS :code:`width` property value for element count table, by default &#39;24%&#39;
        ion_count_table_width : str, optional
            CSS :code:`width` property value for ion count table, by default &#39;24%&#39;
        level_count_table_width : str, optional
            CSS :code:`width` property value for level count table, by default &#39;18%&#39;

        Other Parameters
        ----------------
        **layout_kwargs
            Any valid CSS properties to be passed to the :code:`layout` attribute
            of table widgets container (HTML :code:`div`) as explained in
            `ipywidgets documentation &lt;https://ipywidgets.readthedocs.io/en/stable/examples/Widget%20Styling.html#The-layout-attribute&gt;`_

        Returns
        -------
        ipywidgets.Box
            Shell info widget containing all component widgets
        &quot;&quot;&quot;
        if not is_notebook():
            print(&quot;Please use a notebook to display the widget&quot;)
        else:
            # CSS properties of the layout of shell info tables container
            tables_container_layout = dict(
                display=&quot;flex&quot;,
                align_items=&quot;flex-start&quot;,
                justify_content=&quot;space-between&quot;,
            )
            tables_container_layout.update(layout_kwargs)

            # Setting tables&#39; widths
            self.shells_table.layout.width = shells_table_width
            self.element_count_table.layout.width = element_count_table_width
            self.ion_count_table.layout.width = ion_count_table_width
            self.level_count_table.layout.width = level_count_table_width

            # Attach event listeners to table widgets
            self.shells_table.on(
                &quot;selection_changed&quot;, self.update_element_count_table
            )
            self.element_count_table.on(
                &quot;selection_changed&quot;, self.update_ion_count_table
            )
            self.ion_count_table.on(
                &quot;selection_changed&quot;, self.update_level_count_table
            )

            # Putting all table widgets in a container styled with tables_container_layout
            shell_info_tables_container = ipw.Box(
                [
                    self.shells_table,
                    self.element_count_table,
                    self.ion_count_table,
                    self.level_count_table,
                ],
                layout=ipw.Layout(**tables_container_layout),
            )
            self.shells_table.change_selection([1])

            # Notes text explaining how to interpret tables widgets&#39; data
            text = ipw.HTML(
                &quot;&lt;b&gt;Frac. Ab.&lt;/b&gt; denotes &lt;i&gt;Fractional Abundances&lt;/i&gt; (i.e all &quot;
                &quot;values sum to 1)&lt;br&gt;&lt;b&gt;W&lt;/b&gt; denotes &lt;i&gt;Dilution Factor&lt;/i&gt; and &quot;
                &quot;&lt;b&gt;Rad. Temp.&lt;/b&gt; is &lt;i&gt;Radiative Temperature (in K)&lt;/i&gt;&quot;
            )

            # Put text horizontally before shell info container
            shell_info_widget = ipw.VBox([text, shell_info_tables_container])
            return shell_info_widget</div>
</div>



<div class="viewcode-block" id="shell_info_from_simulation">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.shell_info_from_simulation">[docs]</a>
def shell_info_from_simulation(sim_model):
    &quot;&quot;&quot;Create shell info widget from a TARDIS simulation object

    Parameters
    ----------
    sim_model : tardis.simulation.Simulation
        TARDIS Simulation object produced by running a simulation

    Returns
    -------
    ShellInfoWidget
    &quot;&quot;&quot;
    shell_info_data = SimulationShellInfo(sim_model)
    return ShellInfoWidget(shell_info_data)</div>



<div class="viewcode-block" id="shell_info_from_hdf">
<a class="viewcode-back" href="../../../../api/tardis.visualization.widgets.shell_info.html#tardis.visualization.widgets.shell_info.shell_info_from_hdf">[docs]</a>
def shell_info_from_hdf(hdf_fpath):
    &quot;&quot;&quot;Create shell info widget from a simulation HDF file

    Parameters
    ----------
    hdf_fpath : str
        A valid path to a simulation HDF file (HDF file must be created
        from a TARDIS Simulation object using :code:`to_hdf` method with
        default arguments)

    Returns
    -------
    ShellInfoWidget
    &quot;&quot;&quot;
    shell_info_data = HDFShellInfo(hdf_fpath)
    return ShellInfoWidget(shell_info_data)</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 19 May 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>