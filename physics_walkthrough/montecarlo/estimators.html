

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Volume-Based Estimators &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../_static/tardis_logo.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=3d5d8261"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Updating Plasma and Convergence" href="../update_and_conv/update_and_conv.html" />
    <link rel="prev" title="Line Interaction Treatments" href="lineinteraction.html" />
    <link href="../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Monte Carlo Iteration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basicprinciples.html">Monte Carlo Radiative Transfer - Basic Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="initialization.html">Energy Packet Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="propagation.html">Packet Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lineinteraction.html">Line Interaction Treatments</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Volume-Based Estimators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#theory">Theory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#j-and-bar-nu-estimators"><span class="math notranslate nohighlight">\(J\)</span> and <span class="math notranslate nohighlight">\(\bar \nu\)</span> Estimators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#j-b-lu-estimator"><span class="math notranslate nohighlight">\(J^b_{lu}\)</span> Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dot-e-lu-estimator"><span class="math notranslate nohighlight">\(\dot{E}_{lu}\)</span> Estimator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/visualization_reference.html">Visualization Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Monte Carlo Iteration</a></li>
      <li class="breadcrumb-item active">Volume-Based Estimators</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/physics_walkthrough/montecarlo/estimators.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="volume-based-estimators">
<span id="estimators"></span><h1>Volume-Based Estimators<a class="headerlink" href="#volume-based-estimators" title="Link to this heading">¶</a></h1>
<p>Besides from just tracking the propagation of our packets, TARDIS also uses the Monte Carlo iteration is to determine useful information about the light traveling through the supernova (also called the radiation field). This information will eventually be used to help <a class="reference internal" href="../update_and_conv/update_and_conv.html"><span class="doc">update the plasma state</span></a> as well as <a class="reference internal" href="../spectrum/index.html"><span class="doc">generate different types of spectra</span></a>. We determine this information through volume-based estimators. The concept was originally developed by <span id="id1">[<a class="reference internal" href="../../resources/zreferences.html#id11" title="L. B. Lucy. Computing radiative equilibria with Monte Carlo techniques. Astronomy and Astrophysics, 344:282-288, April 1999.">Lucy99a</a>]</span> and successively refined by <span id="id2">[<a class="reference internal" href="../../resources/zreferences.html#id12" title="L. B. Lucy. Improved Monte Carlo techniques for the spectral synthesis of supernovae. Astronomy and Astrophysics, 345:211-220, May 1999.">Lucy99b</a>]</span>, <span id="id3">[<a class="reference internal" href="../../resources/zreferences.html#id10" title="L. B. Lucy. Monte Carlo transition probabilities. Astronomy and Astrophysics, 384:725-735, March 2002. arXiv:arXiv:astro-ph/0107377, doi:10.1051/0004-6361:20011756.">Lucy02</a>]</span> and <span id="id4">[<a class="reference internal" href="../../resources/zreferences.html#id9" title="L. B. Lucy. Monte Carlo transition probabilities. II. Astronomy and Astrophysics, 403:261-275, May 2003. arXiv:arXiv:astro-ph/0303202, doi:10.1051/0004-6361:20030357.">Lucy03</a>]</span>.</p>
<section id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Link to this heading">¶</a></h2>
<section id="j-and-bar-nu-estimators">
<h3><span class="math notranslate nohighlight">\(J\)</span> and <span class="math notranslate nohighlight">\(\bar \nu\)</span> Estimators<a class="headerlink" href="#j-and-bar-nu-estimators" title="Link to this heading">¶</a></h3>
<p>Ordinarily, TARDIS is not concerned about the physical amount of time a packet spends traveling through the ejecta. Instead, we consider the “time of simulation” <span class="math notranslate nohighlight">\(\Delta t\)</span> which is chosen to be the amount of time in which the photosphere emits the ensemble of packets (see <a class="reference internal" href="initialization.html"><span class="doc">Energy Packet Initialization</span></a>). When looking at the estimators, a slightly different interpretation of the packets is necessary. Here, we view the packets as not carrying a discrete amount of energy <span class="math notranslate nohighlight">\(\varepsilon\)</span> that is emitted in a time interval <span class="math notranslate nohighlight">\(\Delta t\)</span>, but as being a flow of energy that carries an energy <span class="math notranslate nohighlight">\(\varepsilon\)</span> over a time <span class="math notranslate nohighlight">\(\Delta t\)</span> – that is, each packet is carrying a luminosity (energy per unit time) of <span class="math notranslate nohighlight">\(L = \frac{\varepsilon}{\Delta t}\)</span>. Now, we can say that if a packet spends a time <span class="math notranslate nohighlight">\(\delta t\)</span> in the supernova’s ejecta, it contributes an energy of <span class="math notranslate nohighlight">\(L\delta t= \frac{\varepsilon}{\Delta t}\delta t\)</span> into the radiation energy of the ejecta.</p>
<p>To account for the effects of the Monte Carlo packets on the ejecta, TARDIS uses the packets to first determine the average radiation energy density <span class="math notranslate nohighlight">\(E\)</span> throughout each shell, where the energy density is the total radiation energy in the shell divided by the volume of the shell <span class="math notranslate nohighlight">\(V=\frac{4}{3}\pi (r_\mathrm{outer}^3-r_\mathrm{inner}^3)\)</span>. Therefore, we add up the amount of energy each packet contributes to the radiation energy in that shell, and divide by the total volume of the shell:</p>
<div class="math notranslate nohighlight">
\[E=\frac{1}{V}\sum_i L_i\delta t_i=\frac{1}{V}\sum_i \frac{\varepsilon_i}{\Delta t}\delta t_i = \frac{1}{V\Delta t}\sum_i \varepsilon_i\delta t_i\]</div>
<p>where we sum over every Monte Carlo packet in the shell. Note that we are interested in the energy density in the co-moving frame (i.e. the energy density “according to the plasma,” see <a class="reference internal" href="propagation.html#referenceframes"><span class="std std-ref">Reference Frames</span></a>). Now, we note that the amount of time the Monte Carlo packet spends in a shell is <span class="math notranslate nohighlight">\(\delta t = \frac{l_i}{c}\)</span> where <span class="math notranslate nohighlight">\(l\)</span> is the distance that the packet travels through the shell. Thus, our estimator is</p>
<div class="math notranslate nohighlight">
\[E=\frac{1}{V\Delta t}\sum_i \varepsilon_i\frac{l_i}{c} = \frac{1}{cV\Delta t}\sum_i \varepsilon_i l_i.\]</div>
<p>Using this energy density, we can then calculate the mean radiation intensity <span class="math notranslate nohighlight">\(J\)</span> in that shell using the relation <span class="math notranslate nohighlight">\(J=\frac{c}{4\pi} E\)</span>, which gives us</p>
<div class="math notranslate nohighlight">
\[J=\frac{1}{4\pi V\Delta t}\sum_i \varepsilon_i l_i.\]</div>
<p>Since along any path the co-moving energy of the packet is continuously doppler shifted, we approximate this estimator using the co-moving energy at the beginning of the packet’s path (theoretically, the midpoint of the path would be a better option. However, we use the beginning of the path for computational ease at a very small cost to the estimator’s accuracy).</p>
<p>Next, we calculate the mean radiation frequency in each shell. For this, in each shell we add up the frequency of each packet weighted by the intensity they contribute to the shell (and then divide by the total intensity, as will be discussed below). Remembering that intensity is <span class="math notranslate nohighlight">\(\frac{c}{4\pi}\)</span> times the energy density, and as before each packet contributes an energy of <span class="math notranslate nohighlight">\(\frac{\varepsilon_i l_i}{c\Delta t}\)</span> and thus energy density of <span class="math notranslate nohighlight">\(\frac{\varepsilon_i l_i}{cV\Delta t}\)</span> to its shell, we have that each packet contributes an intensity of <span class="math notranslate nohighlight">\(\frac{\varepsilon_i l_i}{4\pi V\Delta t}\)</span> to its shell. So,</p>
<div class="math notranslate nohighlight">
\[\bar \nu = \sum_i \frac{\varepsilon_i l_i}{4\pi V \Delta t}  \nu_i = \frac{1}{4\pi V \Delta t}\sum_i \varepsilon_i \nu_i l_i\]</div>
<p>where once again the co-moving energy and frequency of each packet are taken at the beginning of the packet’s path.</p>
<p>It is important to note that, confusingly, <span class="math notranslate nohighlight">\(\bar \nu\)</span> is not truly the mean frequency (as can be seen by its units – it has dimensions of intensity times frequency). Indeed, the true mean frequency is actually <span class="math notranslate nohighlight">\(\frac{\bar \nu}{J}\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Both estimators take on a different value in each shell.</p>
</div>
<p>These estimators will be used in the <a class="reference internal" href="../update_and_conv/update_and_conv.html"><span class="doc">Updating Plasma and Convergence</span></a> step to help update the plasma state between iterations.</p>
</section>
<section id="j-b-lu-estimator">
<span id="j-blue-estimator"></span><h3><span class="math notranslate nohighlight">\(J^b_{lu}\)</span> Estimator<a class="headerlink" href="#j-b-lu-estimator" title="Link to this heading">¶</a></h3>
<p>Another estimator, called the <code class="docutils literal notranslate"><span class="pre">j_blue</span></code> or <span class="math notranslate nohighlight">\(J^b_{lu}\)</span> estimator, is unlike the two previous estimators discussed. Instead of storing the mean intensity over the entire spectrum, it stores the intensity at a specific frequency. More precisely, since frequency is a continuum, it stores the intensity per unit frequency. In each shell, we record the intensity per unit frequency at the blue end (higher frequency end; this is where the “<span class="math notranslate nohighlight">\(b\)</span>” superscript in <span class="math notranslate nohighlight">\(J^b_{lu}\)</span> comes from) of each line transition – that is, if a line transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span> (from the lower energy level <span class="math notranslate nohighlight">\(l\)</span> to the upper energy level <span class="math notranslate nohighlight">\(u\)</span>, hence the <span class="math notranslate nohighlight">\(lu\)</span> in <span class="math notranslate nohighlight">\(J^b_{lu}\)</span>) has a frequency <span class="math notranslate nohighlight">\(\nu_{lu}\)</span>, the mean intensity between <span class="math notranslate nohighlight">\(\nu_{lu}\)</span> and <span class="math notranslate nohighlight">\(\nu_{lu}+d\nu\)</span> is <span class="math notranslate nohighlight">\(J^b_{lu}d\nu\)</span>. <strong>This means that the</strong> <span class="math notranslate nohighlight">\(J^b_{lu}\)</span> <strong>estimator contains values for each atomic line in each shell</strong>, and is hence called a <em>line estimator</em>. Now, using our previous <span class="math notranslate nohighlight">\(J\)</span> estimator, we have</p>
<div class="math notranslate nohighlight">
\[J^b_{lu}d\nu = \frac{1}{4\pi V\Delta t}\sum_i \varepsilon_i dl_i\]</div>
<p>where <span class="math notranslate nohighlight">\(dl_i\)</span> is the infinitesimal distance that the packet travels while it has a co-moving frequency between <span class="math notranslate nohighlight">\(\nu_{lu}\)</span> and <span class="math notranslate nohighlight">\(\nu_{lu}+d\nu\)</span> (here, therefore, we are summing over all packets in a shell that achieve a co-moving frequency of <span class="math notranslate nohighlight">\(\nu_{lu}\)</span> and thus come into resonance with the line transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span> within that shell).</p>
<p>Now, say the packet with lab frequency <span class="math notranslate nohighlight">\(\nu_\mathrm{lab}\)</span> has a co-moving frequency of <span class="math notranslate nohighlight">\(\nu_{lu}\)</span> at a radius <span class="math notranslate nohighlight">\(r_1\)</span> and propagation direction <span class="math notranslate nohighlight">\(\mu_1\)</span>, and it has a co-moving frequency of <span class="math notranslate nohighlight">\(\nu_{lu}+d\nu\)</span> at a radius <span class="math notranslate nohighlight">\(r_2\)</span> and propagation direction <span class="math notranslate nohighlight">\(\mu_2\)</span>. Then (see <a class="reference internal" href="propagation.html#referenceframes"><span class="std std-ref">Reference Frames</span></a>):</p>
<div class="math notranslate nohighlight">
\[\nu_{lu}=\left(1-\frac{r_1\mu_1}{ct_\mathrm{explosion}}\right)\nu_\mathrm{lab}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\nu_{lu}+d\nu=\left(1-\frac{r_2\mu_2}{ct_\mathrm{explosion}}\right)\nu_\mathrm{lab}.\]</div>
<p>But then subtracting, we get</p>
<div class="math notranslate nohighlight">
\[d\nu = (r_2\mu_2-r_1\mu_1)\frac{\nu_\mathrm{lab}}{ct_\mathrm{explosion}}=dl*\frac{\nu_\mathrm{lab}}{ct_\mathrm{explosion}}\]</div>
<p>(for the last equality, see <a class="reference internal" href="propagation.html#spherical-domain"><span class="std std-ref">Propagation in a Spherical Domain</span></a>).</p>
<p>But now inputting this into the equation for <span class="math notranslate nohighlight">\(J^b_{lu}\)</span> (using <span class="math notranslate nohighlight">\(\frac{dl_i}{d\nu}=\frac{ct_\mathrm{explosion}}{\nu_\mathrm{lab,i}}\)</span>), we get</p>
<div class="math notranslate nohighlight">
\[J^b_{lu} = \frac{ct_\mathrm{explosion}}{4\pi V\Delta t}\sum_i \frac{\varepsilon_i}{\nu_\mathrm{lab,i}}.\]</div>
</section>
<section id="dot-e-lu-estimator">
<span id="edotlu"></span><h3><span class="math notranslate nohighlight">\(\dot{E}_{lu}\)</span> Estimator<a class="headerlink" href="#dot-e-lu-estimator" title="Link to this heading">¶</a></h3>
<p>The final estimator we consider, like the <code class="docutils literal notranslate"><span class="pre">j_blue</span></code> estimator, is a line estimator, meaning it has contains values for each atomic line in each shell. It calculates the rate at which energy density interacts with a line transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span>. The first step is to calculate the rate at which energy density resonates with some line in some shell. Each packet that comes into resonance with the transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span> in a shell of volume <span class="math notranslate nohighlight">\(V\)</span> contributes an energy density to that shell of <span class="math notranslate nohighlight">\(\frac{\varepsilon}{V}\)</span> over a time <span class="math notranslate nohighlight">\(\Delta t\)</span>, meaning the rate at which energy density resonates with the line is <span class="math notranslate nohighlight">\(\sum_i \frac{\varepsilon_i}{\Delta t V} = \frac{1}{\Delta t V} \sum \varepsilon\)</span> where we are summing over all packets which come into resonance with the atomic line in some shell (as usual, this sum is done using the energies in the co-moving frame). Finally, this light then has a <span class="math notranslate nohighlight">\(\left( 1- e^{-\tau_{lu}}\right)\)</span> probability of interacting with the line (where <span class="math notranslate nohighlight">\(\tau_{lu}\)</span> is the Sobolev optical depth for the transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span>, see <a class="reference internal" href="propagation.html#physical-interactions"><span class="std std-ref">Physical Interactions</span></a>), so the rate at which energy density is absorbed into the transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span>, called the <code class="docutils literal notranslate"><span class="pre">Edotlu</span></code> estimator, is</p>
<div class="math notranslate nohighlight">
\[\dot{E}_{lu} = \frac{1}{\Delta t V} \left( 1- e^{-\tau_{lu}}\right) \sum_i \varepsilon_i.\]</div>
<p>Note that while one may expect us to merely add up the contributions of each packet that <em>interacts</em> with the line, eliminating the need for the <span class="math notranslate nohighlight">\(\left( 1- e^{-\tau_{lu}}\right)\)</span> term, the former determines the desired quantity with more accuracy and less noise than the latter, (this is because it does not depend on the limited number of packets TARDIS uses, rather a theoretical equation, to determine how much of the light that comes into resonance with a line actually interacts with that line).</p>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">¶</a></h2>
<p>As previously discussed, a major component of each Monte Carlo iteration is the packet propagation process. During the packet propagation process this step, the <span class="math notranslate nohighlight">\(J\)</span> and <span class="math notranslate nohighlight">\(\bar \nu\)</span> estimators are updates every time a packet is moved to the next event location. Specifically, every time a packet is moved, <span class="math notranslate nohighlight">\(\varepsilon l\)</span> is added to the “running total” <span class="math notranslate nohighlight">\(J\)</span> estimator in the shell where the packet is, and <span class="math notranslate nohighlight">\(\varepsilon \nu l\)</span> is added to the “running total” <span class="math notranslate nohighlight">\(\bar\nu\)</span> estimator in the shell where the packet is (where <span class="math notranslate nohighlight">\(l\)</span> is the distance the packet is moved, and <span class="math notranslate nohighlight">\(\varepsilon\)</span> and <span class="math notranslate nohighlight">\(\nu\)</span> are respectively the packet’s co-moving energy and frequency at the beginning of the packet’s path). The factor of <span class="math notranslate nohighlight">\(\frac{1}{4\pi V\Delta t}\)</span>, for computational ease, is not attached to the estimators but is included during any calculations using these estimators, see <a class="reference internal" href="../update_and_conv/update_and_conv.html"><span class="doc">Updating Plasma and Convergence</span></a>.</p>
<p>Additionally, during the propagation process, every time a packet passes through a Sobolev point, meaning it reaches a co-moving frequency of <span class="math notranslate nohighlight">\(\nu_{lu}\)</span> for some transition <span class="math notranslate nohighlight">\(l\rightarrow u\)</span> and thus comes in resonance with an atomic line, the <span class="math notranslate nohighlight">\(J^b_{lu}\)</span> for that atomic transition in the shell it is in is incremented by <span class="math notranslate nohighlight">\(\frac{\varepsilon}{\nu_\mathrm{lab}}\)</span>, where <span class="math notranslate nohighlight">\(\varepsilon\)</span> is the packet’s energy and <span class="math notranslate nohighlight">\(\nu_\mathrm{lab}\)</span> is the packet’s lab-frame frequency. As before, for computational ease, the factor <span class="math notranslate nohighlight">\(\frac{ct_\mathrm{explosion}}{4\pi V \Delta t}\)</span> is included in calculations involving the estimator (such as when <a class="reference internal" href="../update_and_conv/update_and_conv.html#Updating-Other-Quantities"><span class="std std-ref">updating</span></a> <span class="math notranslate nohighlight">\(J^b_{lu}\)</span> in the plasma or in the <a class="reference internal" href="../spectrum/formal_integral.html#formal-integral"><span class="std std-ref">formal integral</span></a>). Similarly, when a packet passes through a Sobolev point, the <span class="math notranslate nohighlight">\(\dot{E}_{lu}\)</span> for that atomic transition in the shell it is in is incremented by <span class="math notranslate nohighlight">\(\varepsilon\)</span>, and once again, for computational ease, the term <span class="math notranslate nohighlight">\(\frac{1}{\Delta t V} \left( 1- e^{-\tau_{lu}}\right)\)</span> is not included until calculations involving the estimator are performed (specifically in the <a class="reference internal" href="../spectrum/formal_integral.html#formal-integral"><span class="std std-ref">formal integral</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">j_blue</span></code> and <code class="docutils literal notranslate"><span class="pre">Edotlu</span></code> estimators are updated every time a packet comes into resonance with an atomic line (not necessarily going through a line interaction), these estimators are equal to zero in some shell for a specific line if (and only if) no packet comes into resonance with that line within the shell.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lineinteraction.html" class="btn btn-neutral float-left" title="Line Interaction Treatments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../update_and_conv/update_and_conv.html" class="btn btn-neutral float-right" title="Updating Plasma and Convergence" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 12 Oct 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>