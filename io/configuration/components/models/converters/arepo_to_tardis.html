

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Converting Arepo snapshots to be usable by TARDIS &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../../../../../_static/tardis_logo.ico"/>
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Monte Carlo Configuration" href="../../montecarlo.html" />
    <link rel="prev" title="Convert CMFGEN files to TARDIS file format" href="cmfgen.html" />
    <link href="../../../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../api/modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Configuration (Required Input)</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Configuration Components</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../supernova.html">Supernova Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../atomic/atomic_data.html">Atomic Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../plasma.html">Plasma Configuration</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Models</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../index.html#model-configuration">Model Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#built-in-structure-density-and-abundance">Built-in Structure, Density, and Abundance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#csvy-model">CSVY Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../montecarlo.html">Monte Carlo Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spectrum.html">Spectrum Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../debug.html">Debug Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../example.html">TARDIS Example Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_validator.html">Configuration Validator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial_read_configuration.html">Reading a Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../physics/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Configuration (Required Input)</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Configuration Components</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Models</a></li>
      <li class="breadcrumb-item active">Converting Arepo snapshots to be usable by TARDIS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/io/configuration/components/models/converters/arepo_to_tardis.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style>
    /* strip stderr */
    div.nboutput.container div.output_area.stderr {
        background: #fdd;
        display: none;
    }

    .launch-btn {
        background-color: #2980B9;
        border: none;
        border-radius: 4px;
        color: #fcfcfc;
        font-family: inherit;
        text-decoration: none;
        padding: 3px 8px;
        letter-spacing: 0.03em;
        display: inline-block;
        line-height: 1.5em;
    }

    .launch-btn:hover {
        background-color: #1b6391;
        color: #fcfcfc;
    }

    .launch-btn:visited {
        color: #fcfcfc;
    }

    .note-p {
        margin-bottom: 0.4em;
        line-height: 2em;
    }
</style>

<div class="admonition note">
<p class="note-p">You can interact with this notebook online: <a href="https://mybinder.org/v2/gh/tardis-sn/tardis/HEAD?filepath=docs/io/configuration/components/models/converters/arepo_to_tardis.ipynb" class="launch-btn" target="_blank" rel="noopener noreferrer">Launch notebook</a></p>
</div><section id="Converting-Arepo-snapshots-to-be-usable-by-TARDIS">
<h1>Converting Arepo snapshots to be usable by TARDIS<a class="headerlink" href="#Converting-Arepo-snapshots-to-be-usable-by-TARDIS" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>This notebook cannot be run interactively!</p>
</div>
<section id="What-is-Arepo?">
<h2>What is <a class="reference external" href="https://arepo-code.org/">Arepo</a>?<a class="headerlink" href="#What-is-Arepo?" title="Link to this heading">¶</a></h2>
<blockquote>
<div><p><em>Arepo is a massively parallel gravity and magnetohydrodynamics code for astrophysics, designed for problems of large dynamic range. It employs a finite-volume approach to discretize the equations of hydrodynamics on a moving Voronoi mesh, and a tree-particle-mesh method for gravitational interactions. Arepo is originally optimized for cosmological simulations of structure formation, but has also been used in many other applications in astrophysics.</em></p>
</div></blockquote>
<p><span id="id1">[<a class="reference internal" href="../../../../../resources/zreferences.html#id23" title="Rainer Weinberger, Volker Springel, and Rüdiger Pakmor. The arepo public code release. The Astrophysical Journal Supplement Series, 248(2):32, Jun 2020. URL: http://dx.doi.org/10.3847/1538-4365/ab908c, doi:10.3847/1538-4365/ab908c.">WSP20</a>]</span></p>
<p>This parser is intended for loading Arepo output files (‘snapshots’), extracting the relevant (line-of-sight dependent) data and exporting it to <code class="docutils literal notranslate"><span class="pre">csvy</span></code> files, which can in turn be used in TARDIS models (<a class="reference internal" href="../index.html#csvy-model"><span class="std std-ref">see CSVY model</span></a>).</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>This parser has been developed for the (not publicly available) development version of Arepo, not the public version. Although it should also work with snapshots from the public version, this has not been tested. If you run into trouble loading the snapshot using the built-in functions, try providing the data manually.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.io.parsers</span><span class="w"> </span><span class="kn">import</span> <span class="n">arepo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="Loading-the-simulation-data">
<h2>Loading the simulation data<a class="headerlink" href="#Loading-the-simulation-data" title="Link to this heading">¶</a></h2>
<p>As a first step, the relevant data has to be loaded from an Arepo snapshot, i.e. an output file of Arepo. In case you have the arepo-snap-util package installed, you can use the built in wrapper (as described below) to load the relevant data. In case you do not have this package installed or want to load the snapshot in a different way, you can manually provide the relevant data and continue with the next step.</p>
<p>If you’re using the built-in tool, you will need to provide the path to the snapshot file, a list with the elements you want to include in your TARDIS model, as well as the species file with which the Arepo simulation was run. <em>(The species file should contain one header line, followed by two columns, where the first contains the names of all the species and is used to find the indices of the individual species within the snapshot. The second column is not used by the loader.)</em></p>
<p>In case you have the arepo-snap-util package installed, you can load the data directly from a snapshot:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot</span> <span class="o">=</span> <span class="n">arepo</span><span class="o">.</span><span class="n">ArepoSnapshot</span><span class="p">(</span>
    <span class="s2">&quot;arepo_snapshot.hdf5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ni56&quot;</span><span class="p">,</span> <span class="s2">&quot;si28&quot;</span><span class="p">],</span> <span class="s2">&quot;species55.txt&quot;</span>
<span class="p">)</span>
<span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">xnuc</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">get_grids</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>This will load the necessary from the snapshot. See the <a class="reference external" href="../../../../../api/tardis.io.parsers.arepo.rst">API</a> documentation for more options on how to load snapshots.</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>The built in functionality only loads Arepo particle species <code class="docutils literal notranslate"><span class="pre">0</span></code>, i.e. gas particles. For most (if not all) purposes connected to TARDIS, gas particles should be the only species of interest. In case you need to load a different particle species, please manually load the data.</p>
</div>
<p>This will fail with an error if you do not have the arepo-snap-util package installed. Since this is not a default dependency of TARDIS, the data can also be loaded manually. <em>(This manual load can effectively be used to load all kinds of models unrelated to Arepo, as long as the data comes in the correct format.)</em></p>
<p>The data could be loaded from a previously generated <code class="docutils literal notranslate"><span class="pre">json</span></code> file, where all necessary input from the snapshot has been dumped in. <em>(The ``json`` file is only an example and more for illustrative purposes. As long as the data is provided in the correct format (see below) it is up to the user how it is saved/loaded.)</em></p>
<details><summary><p>Code: (click to expand)</p>
</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Dumping the data:</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pos&quot;</span> <span class="p">:</span> <span class="n">pos</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s2">&quot;vel&quot;</span> <span class="p">:</span> <span class="n">vel</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s2">&quot;rho&quot;</span> <span class="p">:</span> <span class="n">rho</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s2">&quot;mass&quot;</span> <span class="p">:</span> <span class="n">mass</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s2">&quot;xnuc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">xnuc</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">xnuc</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">json_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;arepo_snapshot.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_string</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

<span class="c1">### Loading the data:</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;arepo_snapshot.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">))</span>

<span class="c1"># The following lines only parse the .json file. You might not need this depending on how you saved</span>
<span class="c1"># the snapshot data</span>
<span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">nucs</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;xnuc&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>

<span class="c1"># The nuclear data should be in a dict where each element has its own entry (with the key being the element name)</span>
<span class="n">xnuc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ni56&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nucs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="s2">&quot;si28&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nucs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<span class="p">}</span>
</pre></div>
</div>
</details><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position data shape: &quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity data shape: &quot;</span><span class="p">,</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Density data shape: &quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mass data shape: &quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nuclear data shape (per element): &quot;</span><span class="p">,</span> <span class="n">xnuc</span><span class="p">[</span><span class="s2">&quot;ni56&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Position data shape:  (3, 1218054)
Velocity data shape:  (3, 1218054)
Density data shape:  (1218054,)
Mass data shape:  (1218054,)
Nuclear data shape (per element):  (1218054,)
</pre></div></div>
</div>
<p>In case you want to load the snapshot data itself with your own tools, you will need to provide the following data:</p>
<ul class="simple">
<li><p>Position in the center of mass frame (“pos”) -&gt; <code class="docutils literal notranslate"><span class="pre">np.array</span></code></p></li>
<li><p>Velocity (“vel”) -&gt; <code class="docutils literal notranslate"><span class="pre">np.array</span></code></p></li>
<li><p>Density (“rho”) -&gt; <code class="docutils literal notranslate"><span class="pre">np.array</span></code></p></li>
<li><p>Mass (“mass”) -&gt; <code class="docutils literal notranslate"><span class="pre">np.array</span></code></p></li>
<li><p>Nuclear fraction (“xnuc”) of each element you want to include -&gt; <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">np.array</span></code></p></li>
<li><p>Time of the snapshot (“time”) -&gt; <code class="docutils literal notranslate"><span class="pre">float</span></code></p></li>
</ul>
<p>The data should have the same shape as the one provided by the built-in tool (see the given shapes above for an example).</p>
</section>
<section id="Extracting-a-profile-and-converting-it-to-a-csvy-file">
<h2>Extracting a profile and converting it to a csvy file<a class="headerlink" href="#Extracting-a-profile-and-converting-it-to-a-csvy-file" title="Link to this heading">¶</a></h2>
<p>Now You can create a TARDIS model. There are two possibilities on how to extract the profiles from the snapshot:</p>
<ul class="simple">
<li><p><strong>Cone profile</strong>: This extracts the data within a specified cone</p></li>
<li><p><strong>Full profile</strong>: This averages over the whole simulation</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profile</span> <span class="o">=</span> <span class="n">arepo</span><span class="o">.</span><span class="n">ConeProfile</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">xnuc</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This loads the data (in this example for a cone profile), which can then be cut to the ranges which you want to include in your TARDIS model. The syntax for the other profiles is similar:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arepo.FullProfile(&lt;args&gt;)</span></code></p></li>
</ul>
<p>Next you can create the profiles according to the model option you selected. A diagnostic plot will be shown per default, but this behaviour can be turned off with the option <code class="docutils literal notranslate"><span class="pre">show_plot=False</span></code>. The plot will always show both the positive and negative axis.</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">opening_angle=40</span></code> is only needed for the cone profile. The other modes do not accept this keyword! The angle itself is the opening angle of the full cone and NOT the angle between the central x-axis and the cone!</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profile</span><span class="o">.</span><span class="n">create_profile</span><span class="p">(</span><span class="n">opening_angle</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">plot_profile</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../_images/io_configuration_components_models_converters_arepo_to_tardis_20_0.png" src="../../../../../_images/io_configuration_components_models_converters_arepo_to_tardis_20_0.png" />
</div>
</div>
</section>
<section id="Plotting-the-data">
<h2>Plotting the data<a class="headerlink" href="#Plotting-the-data" title="Link to this heading">¶</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">profile.plot_profile(save=&lt;filename&gt;,</span> <span class="pre">dpi=&lt;dpi&gt;)</span></code> you can create a plot of the exported profile. Due to the large number of cells usually used in Arepo simulations, it is recommended to plot the data only <strong>after</strong> rebinning the profiles or exporting them to a <code class="docutils literal notranslate"><span class="pre">csvy</span></code> file (which automatically rebins the data).</p>
</section>
<section id="Manually-rebinning-the-data">
<h2>Manually rebinning the data<a class="headerlink" href="#Manually-rebinning-the-data" title="Link to this heading">¶</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">profile.rebin(&lt;nshells&gt;)</span></code>, you can manually rebin the data , using the mean value of the data in each bin. Rebinning only works when decreasing the number of bins. In case you need to increase resolution, you will need to create a new profile.</p>
</section>
<section id="Selecting-a-specific-region">
<h2>Selecting a specific region<a class="headerlink" href="#Selecting-a-specific-region" title="Link to this heading">¶</a></h2>
<p>In many cases you only want a very specific region from the snapshot, e.g. cutting out the dense, optically thick regions. This can be achieved using the keywords <code class="docutils literal notranslate"><span class="pre">inner_radius</span></code> and <code class="docutils literal notranslate"><span class="pre">outer_radius</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profile</span><span class="o">.</span><span class="n">create_profile</span><span class="p">(</span><span class="n">opening_angle</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">inner_radius</span><span class="o">=</span><span class="mf">1e11</span><span class="p">,</span> <span class="n">outer_radius</span><span class="o">=</span><span class="mf">2e11</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">plot_profile</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../_images/io_configuration_components_models_converters_arepo_to_tardis_23_0.png" src="../../../../../_images/io_configuration_components_models_converters_arepo_to_tardis_23_0.png" />
</div>
</div>
<p>Once you have created a profile of the desired region, you can export the profile to a <code class="docutils literal notranslate"><span class="pre">csvy</span></code> file, which in turn can be used in a TARDIS model. Here you have to specify how many shells you want to export. The profiles are rebinned automatically using <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.binned_statistic.html">Scipys binned_statistic function</a>, using the mean value of the data in each bin.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profile</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;snapshot_converted_to_tardis.csvy&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;snapshot_converted_to_tardis.csvy&#39;
</pre></div></div>
</div>
<p>During the export, the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> header is automatically written and includes the time of the screenshot as the time for both the nuclear data as well as the density profile. Per default, the positive axis will be exported. the negative axis can be exported with <code class="docutils literal notranslate"><span class="pre">direction=&quot;neg&quot;</span></code>.</p>
<p>All abundences will normalised such that roughly sum to 1, but slight deviations are expected to occur.</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>The export function will not overwrite existing files, but rather add an incrementing number to the filename.</p>
</div>
<section id="Using-the-parser-as-a-command-line-tool">
<h3>Using the parser as a command line tool<a class="headerlink" href="#Using-the-parser-as-a-command-line-tool" title="Link to this heading">¶</a></h3>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">tardis.io.arepo</span></code> package as a command line utility, e.g. if you are running batch jobs and want to automatically convert your snapshots from within you job-script.</p>
<p>To export the same profile as in the example above you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./&lt;location_of_arepo_parser&gt;/arepo.py<span class="w"> </span>snapshot.hdf5<span class="w"> </span>snapshot_converted.csvy<span class="w"> </span>-o<span class="w"> </span><span class="m">40</span><span class="w"> </span>-n<span class="w"> </span><span class="m">20</span><span class="w"> </span>--inner_radius<span class="w"> </span>1e11<span class="w"> </span>--outer_radius<span class="w"> </span>2e11<span class="w"> </span>-e<span class="w"> </span>ni56<span class="w"> </span>si28<span class="w"> </span>--plot<span class="w"> </span>plot.png
</pre></div>
</div>
<p>This will also save diagnostic plots of both the raw and rebinned profiles. For more information on how to use the command line tool run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./&lt;location_of_arepo_parser&gt;/arepo.py<span class="w"> </span>--help
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>The command line tool does only work with snapshot files, not with e.g. json files. It is in any case not advised to use json files as an intermediate step, as the become huge for higher resolutions.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cmfgen.html" class="btn btn-neutral float-left" title="Convert CMFGEN files to TARDIS file format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../montecarlo.html" class="btn btn-neutral float-right" title="Monte Carlo Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 19 May 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>