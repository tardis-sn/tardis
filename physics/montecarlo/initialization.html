

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energy Packet Initialization &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../../_static/tardis_logo.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=53221d5e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Packet Propagation" href="propagation.html" />
    <link rel="prev" title="Monte Carlo Radiative Transfer - Basic Principles" href="basicprinciples.html" />
    <link href="../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../io/hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/configuration/index.html">Configuration (Required Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io/output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Monte Carlo Iteration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basicprinciples.html">Monte Carlo Radiative Transfer - Basic Principles</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Energy Packet Initialization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Theory">Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Code-Example">Code Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Custom-Packet-Source">Custom Packet Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="propagation.html">Packet Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lineinteraction.html">Line Interaction Treatments</a></li>
<li class="toctree-l2"><a class="reference internal" href="estimators.html">Volume-Based Estimators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Monte Carlo Iteration</a></li>
      <li class="breadcrumb-item active">Energy Packet Initialization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/physics/montecarlo/initialization.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style>
    /* strip stderr */
    div.nboutput.container div.output_area.stderr {
        background: #fdd;
        display: none;
    }

    .launch-btn {
        background-color: #2980B9;
        border: none;
        border-radius: 4px;
        color: #fcfcfc;
        font-family: inherit;
        text-decoration: none;
        padding: 3px 8px;
        letter-spacing: 0.03em;
        display: inline-block;
        line-height: 1.5em;
    }

    .launch-btn:hover {
        background-color: #1b6391;
        color: #fcfcfc;
    }

    .launch-btn:visited {
        color: #fcfcfc;
    }

    .note-p {
        margin-bottom: 0.4em;
        line-height: 2em;
    }
</style>

<div class="admonition note">
<p class="note-p">You can interact with this notebook online: <a href="https://mybinder.org/v2/gh/tardis-sn/tardis/HEAD?filepath=docs/physics/montecarlo/initialization.ipynb" class="launch-btn" target="_blank" rel="noopener noreferrer">Launch notebook</a></p>
</div><section id="Energy-Packet-Initialization">
<h1>Energy Packet Initialization<a class="headerlink" href="#Energy-Packet-Initialization" title="Link to this heading">¶</a></h1>
<section id="Theory">
<h2>Theory<a class="headerlink" href="#Theory" title="Link to this heading">¶</a></h2>
<p>While it is instructive to think about tracking the propagation history of individual photons when illustrating the basic idea behind Monte Carlo radiative transfer techniques, there are important numerical reasons for using a different discretization scheme. Instead of thinking in the photon picture, it brings significant advantages to follow the idea of <span id="id1">[<a class="reference internal" href="../../resources/zreferences.html#id2" title="D. C. Abbott and L. B. Lucy. Multiline transfer and the dynamics of stellar winds. Astrophysical Journal, 288:679-693, January 1985. doi:10.1086/162834.">AbbottLucy85</a>]</span> and <span id="id2">[<a class="reference internal" href="../../resources/zreferences.html#id11" title="L. B. Lucy. Computing radiative equilibria with Monte Carlo techniques. Astronomy and Astrophysics, 344:282-288, April 1999.">Lucy99a</a>]</span> and consider parcels of radiant energy as the fundamental building blocks of the Monte Carlo
calculation. These basic Monte Carlo quanta are commonly referred to as “energy packets” or simply “packets”, and are composed of many photons with the same frequency.</p>
<p>During a Monte Carlo calculation, <span class="math notranslate nohighlight">\(N\)</span> (a large number) packets, all with a certain energy <span class="math notranslate nohighlight">\(\varepsilon\)</span>, are created at the inner boundary of the computational domain (which is discussed in the <a class="reference internal" href="../setup/model.html"><span class="doc">model section</span></a>) known as the photosphere. Currently, the photosphere is modeled as a spherical <a class="reference external" href="https://en.wikipedia.org/wiki/Black-body_radiation">blackbody</a> with a radius <span class="math notranslate nohighlight">\(r_\mathrm{boundary\_inner}\)</span> and temperature <span class="math notranslate nohighlight">\(T_\mathrm{inner}\)</span>. Both of these
quantities are calculated as a part of the <a class="reference internal" href="../setup/model.html"><span class="doc">model</span></a>, and <span class="math notranslate nohighlight">\(T_\mathrm{inner}\)</span> is additionally updated throughout the simulation as a part of the <a class="reference internal" href="../update_and_conv/update_and_conv.html"><span class="doc">Updating Plasma and Convergence</span></a> process.</p>
<p>In TARDIS, all packets are assigned identical energies <strong>in the lab frame</strong> (see <a class="reference internal" href="propagation.html#reference-frames"><span class="std std-ref">Reference Frames</span></a>), and the total (lab-frame) energy of the packets is 1 erg (and thus each packet has an energy of <span class="math notranslate nohighlight">\(\frac{1}{N}\)</span> ergs).</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>The indivisible energy packet scheme does not require that all packets have the same energy. This is just a convenient and simple choice adopted in TARDIS.</p>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>Since all packets have the same total, and photon energy is proportional to frequency, higher-frequency packets will represent less real photons than lower-frequency packets.</p>
</div>
<p>Since the photosphere is modeled as a blackbody, its total luminosity <span class="math notranslate nohighlight">\(L_\mathrm{inner}\)</span> (recall that luminosity is energy emitted divided by the time in which it is emitted) is</p>
<div class="math notranslate nohighlight">
\[L_\mathrm{inner}=\frac{N\varepsilon}{\Delta t}=4 \pi r_\mathrm{boundary\_inner}^2 \sigma_{\mathrm{R}} T_{\mathrm{inner}}^4\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_\mathrm{R}\)</span> is the Stefan-Boltzmann constant and <span class="math notranslate nohighlight">\(\Delta t\)</span> is the physical duration of the simulation. In order to make this relationship hold (remembering that <span class="math notranslate nohighlight">\(N\varepsilon = 1\)</span> erg), we use</p>
<div class="math notranslate nohighlight">
\[\Delta t = \frac{1}{L_\mathrm{inner}}=\frac{1}{4 \pi r_\mathrm{boundary\_inner}^2 \sigma_{\mathrm{R}} T_{\mathrm{inner}}^4}.\]</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>As will be shown in the code example, this will lead to unphysically small values for <span class="math notranslate nohighlight">\(\Delta t\)</span>. It may be easier to think of the Monte Carlo packets not as packets of energy <span class="math notranslate nohighlight">\(\epsilon\)</span> going through a simulation of duration <span class="math notranslate nohighlight">\(\Delta t\)</span>, but as packets of luminosity that carry an energy <span class="math notranslate nohighlight">\(\epsilon\)</span> over a time <span class="math notranslate nohighlight">\(\Delta t\)</span> (and thus truly being luminosity packets of luminosity <span class="math notranslate nohighlight">\(\frac{\epsilon}{\Delta t}\)</span>). Indeed, this view of the packets will be useful when
deriving the <a class="reference internal" href="estimators.html"><span class="doc">Monte Carlo Estimators</span></a>.</p>
</div>
<p>During packet initialization, each packet is assigned an initial propagation direction <span class="math notranslate nohighlight">\(\mu\)</span> which is the cosine of the angle <span class="math notranslate nohighlight">\(\theta\)</span> which the packet’s path makes with the radial direction (see the image below). Using a pseudo-random number generator which generates numbers <span class="math notranslate nohighlight">\(z\)</span> uniformly distributed on the interval <span class="math notranslate nohighlight">\([0,1]\)</span>, the propagation direction is determined (due to physical considerations beyond the scope of this documentation) according to</p>
<div class="math notranslate nohighlight">
\[\mu = \sqrt{z}.\]</div>
<p>This sampling is shown in the “Code Example” section.</p>
<p><img alt="1ab9912e375b46baaa1cdef12185279d" class="no-scaled-link" src="../../_images/propagation_direction.png" style="width: 500px;" /></p>
<p>Finally, each packet is assigned an initial frequency (or more precisely, the initial frequency of its constituent photons). Note that since each packet has the same energy, each packet will represent a different number of real photons. The sampling on packet frequencies is more involved than that of the propagation direction, as it involves sampling the Planck distribution (see below). TARDIS uses the technique described in <span id="id3">[<a class="reference internal" href="../../resources/zreferences.html#id4" title="L. L. Carter and E. Cashwell. Particle-transport simulation with the Monte Carlo method. Technical Report, Los Alamos Scientific Laboratory, 1975. URL: http://www.iaea.org/inis/collection/NCLCollectionStore/_Public/07/227/7227109.pdf.">CarterCashwell75</a>]</span> and summarized in <span id="id4">[<a class="reference internal" href="../../resources/zreferences.html#id3" title="J. E. Bjorkman and K. Wood. Radiative Equilibrium and Temperature Correction in Monte Carlo Radiation Transfer. Astrophysical Journal, 554:615-623, June 2001. arXiv:astro-ph/0103249, doi:10.1086/321336.">BjorkmanWood01</a>]</span> for this
purpose.</p>
<p>During the simulation, the energy of the packet remains constant in the local co-moving frame (see <a class="reference internal" href="propagation.html#reference-frames"><span class="std std-ref">Reference Frames</span></a>). This naturally ensures energy conservation and constitutes the main advantage of this discretization scheme. <strong>However, while the energy of the packets is conserved in the co-moving frame, the co-moving frequency of the packet (and thus the photons represented by the packet) may vary over the course of the simulation. Thus, a packet may
represent several different numbers of real photons throughout their lifetimes.</strong></p>
</section>
<section id="Code-Example">
<h2>Code Example<a class="headerlink" href="#Code-Example" title="Link to this heading">¶</a></h2>
<p>We now demonstrate the TARDIS packet initialization framework:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.transport.montecarlo.packet_source</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlackBodySimpleSource</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.transport.montecarlo.packet_collections</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PacketCollection</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis</span><span class="w"> </span><span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
<p>The following cell contains values that you can change to see how it affects the spectrum (in an actual simulation, the seed and number of packets are set in the <a class="reference internal" href="../../io/configuration/components/montecarlo.html"><span class="doc">Monte Carlo configuration</span></a>, and the photospheric radius is calculated as a part of the <a class="reference internal" href="../setup/model.html"><span class="doc">model</span></a>):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Base seed for the packet source</span>
<span class="n">base_seed</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Seed offset resets the Pseudo Random Number Generator with a new seed at each iteration</span>
<span class="n">seed_offset</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Number of packets generated</span>
<span class="n">n_packets</span> <span class="o">=</span> <span class="mi">40000</span>

<span class="c1"># Radius of the supernova&#39;s photosphere in cm</span>
<span class="n">r_boundary_inner</span> <span class="o">=</span> <span class="mf">1e15</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span>
</pre></div>
</div>
</div>
<p>We set the temperature of the photosphere <span class="math notranslate nohighlight">\(T_\mathrm{inner}\)</span>, which will determine the photospheric luminosity (in an actual simulation, <span class="math notranslate nohighlight">\(T_\mathrm{inner}\)</span> is initially calculated as a part of the <a class="reference internal" href="../setup/model.html"><span class="doc">model</span></a> and updated as a part of the <a class="reference internal" href="../update_and_conv/update_and_conv.html"><span class="doc">Updating Plasma and Convergence</span></a> process):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Temperature in K</span>
<span class="n">temperature_inner</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>

<span class="n">luminosity_inner</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">4</span>
    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="o">*</span> <span class="p">(</span><span class="n">r_boundary_inner</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">sigma_sb</span>
    <span class="o">*</span> <span class="p">(</span><span class="n">temperature_inner</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Makes sure the luminosity is given in erg/s</span>
<span class="n">luminosity_inner</span> <span class="o">=</span> <span class="n">luminosity_inner</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;erg/s&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Luminosity of photosphere:&quot;</span><span class="p">,</span> <span class="n">luminosity_inner</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Luminosity of photosphere: 7.125600863965567e+42 erg / s
</pre></div></div>
</div>
<p>We now generate the ensemble of packets. The array of packet energies and radii are also shown.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We define our packet source</span>
<span class="n">packet_source</span> <span class="o">=</span> <span class="n">BlackBodySimpleSource</span><span class="p">(</span><span class="n">base_seed</span><span class="o">=</span><span class="n">base_seed</span><span class="p">)</span>

<span class="c1"># Set radii and temperature from model</span>
<span class="n">packet_source</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">r_boundary_inner</span>
<span class="n">packet_source</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature_inner</span>

<span class="c1"># Create packets</span>
<span class="n">packet_collection</span> <span class="o">=</span> <span class="n">packet_source</span><span class="o">.</span><span class="n">create_packets</span><span class="p">(</span><span class="n">n_packets</span><span class="p">)</span>

<span class="c1"># Sets the energies in units of ergs</span>
<span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_energies</span> <span class="o">*=</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>

<span class="c1"># Sets the frequencies in units of Hz</span>
<span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_nus</span> <span class="o">*=</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Energies:&quot;</span><span class="p">,</span> <span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_energies</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Radii:&quot;</span><span class="p">,</span> <span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_radii</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Energies: [2.5e-05 2.5e-05 2.5e-05 ... 2.5e-05 2.5e-05 2.5e-05] erg
Radii: [1.e+15 1.e+15 1.e+15 ... 1.e+15 1.e+15 1.e+15]
</pre></div></div>
</div>
<p>We set the timespan of the simulation so that each packet contributes the appropriate luminosity to the spectrum.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time of simulation</span>
<span class="n">t_simulation</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="n">luminosity_inner</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time of simulation:&quot;</span><span class="p">,</span> <span class="n">t_simulation</span><span class="p">)</span>

<span class="c1"># Array of luminosity contribution by each packet</span>
<span class="n">lumin_per_packet</span> <span class="o">=</span> <span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_energies</span> <span class="o">/</span> <span class="n">t_simulation</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Luminosity per packet:&quot;</span><span class="p">,</span> <span class="n">lumin_per_packet</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Time of simulation: 1.4033904215110305e-43 s
Luminosity per packet: [1.78140022e+38 1.78140022e+38 1.78140022e+38 ... 1.78140022e+38
 1.78140022e+38 1.78140022e+38] erg / s
</pre></div></div>
</div>
<p>We define important constants, and for comparison’s sake, we code the Planck distribution function</p>
<div class="math notranslate nohighlight">
\[L_\nu (\nu)=\frac{8\pi^2 r_\mathrm{boundary\_inner}^2 h\nu^3}{c^2}\frac{1}{\exp\left(\frac{h\nu}{k_BT_\mathrm{inner}}\right)-1}\]</div>
<p>where <span class="math notranslate nohighlight">\(L_\nu\)</span> is the luminosity density (see <a class="reference internal" href="../spectrum/basic.html"><span class="doc">Basic Spectrum Generation</span></a>) with respect to frequency, <span class="math notranslate nohighlight">\(\nu\)</span> is frequency, <span class="math notranslate nohighlight">\(h\)</span> is Planck’s constant, <span class="math notranslate nohighlight">\(c\)</span> is the speed of light, and <span class="math notranslate nohighlight">\(k_B\)</span> is Boltzmann’s constant:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">cgs</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cgs</span><span class="o">**</span><span class="mi">2</span>
<span class="n">kB</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">k_B</span><span class="o">.</span><span class="n">cgs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">planck_function</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="mi">8</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>
        <span class="o">*</span> <span class="n">r_boundary_inner</span><span class="o">**</span><span class="mi">2</span>
        <span class="o">*</span> <span class="n">h</span>
        <span class="o">*</span> <span class="n">nu</span><span class="o">**</span><span class="mi">3</span>
        <span class="o">/</span> <span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">/</span> <span class="p">(</span><span class="n">kB</span> <span class="o">*</span> <span class="n">temperature_inner</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>We plot the Planck distribution and a histogram of the generated packet distribution:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We set important quantities for making our histogram</span>
<span class="n">bins</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">nus_planck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_nus</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_nus</span><span class="p">),</span> <span class="n">bins</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="n">bin_width</span> <span class="o">=</span> <span class="n">nus_planck</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nus_planck</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># In the histogram plot below, the weights argument is used</span>
<span class="c1"># to make sure our plotted spectrum has the correct y-axis scale</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_nus</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">lumin_per_packet</span> <span class="o">/</span> <span class="n">bin_width</span><span class="p">)</span>

<span class="c1"># We plot the planck function for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nus_planck</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">,</span> <span class="n">planck_function</span><span class="p">(</span><span class="n">nus_planck</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Luminosity density w.r.t. frequency (erg/s/Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/physics_montecarlo_initialization_13_0.svg" src="../../_images/physics_montecarlo_initialization_13_0.svg" />
</div>
</div>
<p>We finally plot the generated <span class="math notranslate nohighlight">\(\mu\)</span> density distribution, followed by the generated <span class="math notranslate nohighlight">\(\theta=\arccos (\mu)\)</span> density distribution, compared with the respective curves <span class="math notranslate nohighlight">\(\rho = 2\mu\)</span> and <span class="math notranslate nohighlight">\(\rho = \sin(2\theta)\)</span>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_mus</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Propagation direction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/physics_montecarlo_initialization_15_0.svg" src="../../_images/physics_montecarlo_initialization_15_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">packet_collection</span><span class="o">.</span><span class="n">initial_mus</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">thetas</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Angle with normal (rad)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/physics_montecarlo_initialization_16_0.svg" src="../../_images/physics_montecarlo_initialization_16_0.svg" />
</div>
</div>
</section>
<section id="Custom-Packet-Source">
<h2>Custom Packet Source<a class="headerlink" href="#Custom-Packet-Source" title="Link to this heading">¶</a></h2>
<p>TARDIS allows for the user to input a custom function that generates energy packets instead of the basic blackbody source described here. See <a class="reference internal" href="../../io/optional/how_to_custom_source.html"><span class="doc">How to Run TARDIS with a Custom Packet Source</span></a> for more information.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="basicprinciples.html" class="btn btn-neutral float-left" title="Monte Carlo Radiative Transfer - Basic Principles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="propagation.html" class="btn btn-neutral float-right" title="Packet Propagation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 07 Aug 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>