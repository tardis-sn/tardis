

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comparison of ionization soluations &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../../../_static/tardis_logo.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=50c4a0dc"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href="../../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/high_energy/run_high_energy_workflow.html">TARDIS High Energy Workflow Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/visualization/tutorial_montecarlo_packet_visualization.html">Montecarlo Packet Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analyzing_tardis/index.html">Analyszing TARDIS Simulation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/configuration/tutorial_read_configuration.html">Reading a Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/output/index.html">Additional Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/code_comparison/index.html">How to do Code Comparison using TARDIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics_walkthrough/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/visualization_reference.html">Visualization Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/configuration/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/hdf/index.html">Hierarchical Data Format (HDF5) Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/zreferences.html">Bibliography and Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Comparison of ionization soluations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/physics/plasma/equilibrium/ionization_solution_comparison.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style>
    /* strip stderr */
    div.nboutput.container div.output_area.stderr {
        background: #fdd;
        display: none;
    }

    .launch-btn {
        background-color: #2980B9;
        border: none;
        border-radius: 4px;
        color: #fcfcfc;
        font-family: inherit;
        text-decoration: none;
        padding: 3px 8px;
        letter-spacing: 0.03em;
        display: inline-block;
        line-height: 1.5em;
    }

    .launch-btn:hover {
        background-color: #1b6391;
        color: #fcfcfc;
    }

    .launch-btn:visited {
        color: #fcfcfc;
    }

    .note-p {
        margin-bottom: 0.4em;
        line-height: 2em;
    }
</style>

<div class="admonition note">
<p class="note-p">You can interact with this notebook online: <a href="https://mybinder.org/v2/gh/tardis-sn/tardis/HEAD?filepath=docs/physics/plasma/equilibrium/ionization_solution_comparison.ipynb" class="launch-btn" target="_blank" rel="noopener noreferrer">Launch notebook</a></p>
</div><section id="Comparison-of-ionization-soluations">
<h1>Comparison of ionization soluations<a class="headerlink" href="#Comparison-of-ionization-soluations" title="Link to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.io.atom_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">AtomData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.io.configuration.config_reader</span><span class="w"> </span><span class="kn">import</span> <span class="n">Configuration</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.model.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.assembly.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlasmaSolverFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.equilibrium.rates</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnalyticCorrectedPhotoionizationCoeffSolver</span><span class="p">,</span>
    <span class="n">AnalyticPhotoionizationCoeffSolver</span><span class="p">,</span>
    <span class="n">SpontaneousRecombinationCoeffSolver</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.radiation_field</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DilutePlanckianRadiationField</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">home</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="n">home</span> <span class="o">/</span> <span class="s2">&quot;tardis/tardis/plasma/tests/data/plasma_base_test_config.yml&quot;</span><span class="p">)</span>

<span class="n">config</span><span class="o">.</span><span class="n">supernova</span><span class="o">.</span><span class="n">time_explosion</span> <span class="o">=</span> <span class="mf">16.084</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span>
<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">home</span> <span class="o">/</span> <span class="s2">&quot;tardis/docs/physics/plasma/equilibrium/cmfgen_stephane_density_rebin.dat&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">filetype</span> <span class="o">=</span> <span class="s2">&quot;simple_ascii&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">v_inner_boundary</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">v_outer_boundary</span> <span class="o">=</span> <span class="mi">15000</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>

<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">abundances</span><span class="o">.</span><span class="n">He</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">abundances</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">config</span><span class="o">.</span><span class="n">plasma</span><span class="o">.</span><span class="n">excitation</span> <span class="o">=</span> <span class="s2">&quot;dilute-lte&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">plasma</span><span class="o">.</span><span class="n">ionization</span> <span class="o">=</span> <span class="s2">&quot;nebular&quot;</span>

<span class="n">ion_slice</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>

<span class="n">atom_data</span> <span class="o">=</span> <span class="n">AtomData</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">home</span> <span class="o">/</span> <span class="s2">&quot;tardis-regression-data/atom_data/nlte_atom_data/TestNLTE_He_Ti_ctardis.h5&quot;</span><span class="p">)</span>

<span class="n">cmfgen_atom_data2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">atom_data</span><span class="p">)</span>

<span class="n">cmfgen_radiative_transitions</span> <span class="o">=</span> <span class="n">atom_data</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ion_slice</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">cmfgen_sim_state</span> <span class="o">=</span> <span class="n">SimulationState</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">atom_data</span><span class="o">=</span><span class="n">atom_data</span><span class="p">)</span>

<span class="n">atom_data</span><span class="o">.</span><span class="n">prepare_atom_data</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;macroatom&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/afullard/tardis/tardis/__init__.py:17: UserWarning: Astropy is already imported externally. Astropy should be imported after TARDIS.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ee411a0f8cba46deaeb131dbe7444409", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e7a0a6e7032e43e9a37459dd2509a4b3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Number of density points larger than number of shells. Assuming inner point irrelevant
model_isotope_time_0 is not set in the configuration. Isotopic mass fractions will not be decayed and is assumed to be correct for the time_explosion. THIS IS NOT RECOMMENDED!
</pre></div></div>
</div>
</section>
<section id="Model-setup">
<h1>Model setup<a class="headerlink" href="#Model-setup" title="Link to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.electron_energy_distribution</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ThermalElectronEnergyDistribution</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">rad_field</span> <span class="o">=</span> <span class="n">DilutePlanckianRadiationField</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="c1">#9984.96131287 * u.K,</span>
                                          <span class="n">dilution_factor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span> <span class="mf">0.18635244</span><span class="p">,</span>  <span class="mf">0.15938095</span><span class="p">,</span>  <span class="mf">0.11736085</span><span class="p">,</span>  <span class="mf">0.34665656</span><span class="p">,</span>  <span class="mf">0.32265696</span><span class="p">,</span>
       <span class="mf">0.30224056</span><span class="p">,</span>  <span class="mf">0.28436446</span><span class="p">,</span>  <span class="mf">0.26841929</span><span class="p">,</span>  <span class="mf">0.2540108</span> <span class="p">,</span>  <span class="mf">0.24086562</span><span class="p">,</span>
        <span class="mf">0.22878441</span><span class="p">,</span>  <span class="mf">0.21761613</span><span class="p">,</span>  <span class="mf">0.20724285</span><span class="p">,</span>  <span class="mf">0.1975702</span> <span class="p">,</span>  <span class="mf">0.18852112</span><span class="p">,</span>
        <span class="mf">0.18003167</span><span class="p">,</span>  <span class="mf">0.17204798</span><span class="p">,</span>  <span class="mf">0.16452412</span><span class="p">,</span>  <span class="mf">0.15742053</span><span class="p">,</span>  <span class="mf">0.15070279</span><span class="p">,</span>
        <span class="mf">0.14434073</span><span class="p">,</span>  <span class="mf">0.13830767</span><span class="p">,</span>  <span class="mf">0.13257993</span><span class="p">,</span>  <span class="mf">0.12856901</span><span class="p">]))</span>

<span class="n">electron_dist</span> <span class="o">=</span> <span class="n">ThermalElectronEnergyDistribution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="c1">#9984.96131287 * u.K,</span>
                                                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>  <span class="mf">2.20677509e+09</span><span class="p">,</span>   <span class="mf">1.62501734e+09</span><span class="p">,</span>   <span class="mf">1.22615668e+09</span><span class="p">,</span>
         <span class="mf">9.43891936e+08</span><span class="p">,</span>   <span class="mf">7.38550008e+08</span><span class="p">,</span>   <span class="mf">5.87500741e+08</span><span class="p">,</span>
         <span class="mf">4.72954413e+08</span><span class="p">,</span>   <span class="mf">3.82162389e+08</span><span class="p">,</span>   <span class="mf">3.08702916e+08</span><span class="p">,</span>
         <span class="mf">2.49243299e+08</span><span class="p">,</span>   <span class="mf">2.01203976e+08</span><span class="p">,</span>   <span class="mf">1.62424770e+08</span><span class="p">,</span>
         <span class="mf">1.31111090e+08</span><span class="p">,</span>   <span class="mf">1.05846840e+08</span><span class="p">,</span>   <span class="mf">8.54394007e+07</span><span class="p">,</span>
         <span class="mf">6.89750790e+07</span><span class="p">,</span>   <span class="mf">5.56796014e+07</span><span class="p">,</span>   <span class="mf">4.49524605e+07</span><span class="p">,</span>
         <span class="mf">3.62858202e+07</span><span class="p">,</span>   <span class="mf">2.92940480e+07</span><span class="p">,</span>   <span class="mf">2.36477502e+07</span><span class="p">,</span>
         <span class="mf">1.90900977e+07</span><span class="p">,</span>   <span class="mf">1.54111736e+07</span><span class="p">,</span>   <span class="mf">1.24410890e+07</span><span class="p">]</span> <span class="p">)</span><span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">3</span><span class="p">)</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">temperature</span>
</pre></div>
</div>
</div>
</section>
<section id="Comparison-to-cTARDIS-rate-calculations">
<h1>Comparison to cTARDIS rate calculations<a class="headerlink" href="#Comparison-to-cTARDIS-rate-calculations" title="Link to this heading">¶</a></h1>
<p>Previous rates were calculated using</p>
<p>cTARDIS</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spontaneous_recombination_coeff_solver</span> <span class="o">=</span> <span class="n">SpontaneousRecombinationCoeffSolver</span><span class="p">(</span><span class="n">atom_data</span><span class="o">.</span><span class="n">photoionization_data</span><span class="p">,)</span>
<span class="n">photoionization_coeff_solver</span> <span class="o">=</span> <span class="n">AnalyticPhotoionizationCoeffSolver</span><span class="p">(</span><span class="n">atom_data</span><span class="o">.</span><span class="n">photoionization_data</span><span class="p">,)</span>

<span class="n">spontaneous_recombination_rate</span> <span class="o">=</span> <span class="n">spontaneous_recombination_coeff_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
<span class="n">photoionization_rate_coeff</span><span class="p">,</span> <span class="n">stimulated_recombination_rate_coeff</span> <span class="o">=</span> <span class="n">photoionization_coeff_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">rad_field</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ctardis_path</span> <span class="o">=</span> <span class="s2">&quot;/home/afullard/tardis-chvogl-configs/&quot;</span>

<span class="n">ion_number_density_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;ion_density.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">lte_ion_number_density_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;lte_ion_number_density.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">level_number_density_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;level_pop.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">lte_level_number_density_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;lte_level_pop.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">correction_factor_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;correction_factor_ctardis.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="Build-custom-property-collection">
<h1>Build custom property collection<a class="headerlink" href="#Build-custom-property-collection" title="Link to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plasma_solver_factory</span> <span class="o">=</span> <span class="n">PlasmaSolverFactory</span><span class="p">(</span><span class="n">cmfgen_atom_data2</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">plasma_solver_factory</span><span class="o">.</span><span class="n">prepare_factory</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;tardis.plasma.properties.property_collections&quot;</span> <span class="p">)</span>
<span class="n">cmfgen_plasma</span> <span class="o">=</span> <span class="n">plasma_solver_factory</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="n">cmfgen_sim_state</span><span class="o">.</span><span class="n">calculate_elemental_number_density</span><span class="p">(</span><span class="n">cmfgen_atom_data2</span><span class="o">.</span><span class="n">atom_data</span><span class="o">.</span><span class="n">mass</span><span class="p">),</span> <span class="n">rad_field</span><span class="p">,</span> <span class="n">cmfgen_sim_state</span><span class="o">.</span><span class="n">time_explosion</span><span class="p">,</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">number_density</span><span class="p">,</span> <span class="n">link_t_rad_t_electron</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Zeta_data missing - replaced with 1s. Missing ions: []
Zeta_data missing - replaced with 1s. Missing ions: []
</pre></div></div>
</div>
</section>
<section id="Custom-Ion-LTE">
<h1>Custom Ion LTE<a class="headerlink" href="#Custom-Ion-LTE" title="Link to this heading">¶</a></h1>
<p>Differences: Phi at electron temp is VERY CLOSE, LTE partition function is SAME, basic elemental number density is VERY CLOSE, electron densities are VERY CLOSE</p>
<p>LTE and “non-LTE” ion pops in TARDIS plasma are identical right now!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.properties.ion_population</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonNumberDensity</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LTEIonNumberDensity</span><span class="p">(</span><span class="n">IonNumberDensity</span><span class="p">):</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lte_ion_number_density&#39;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">latex_name</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;N_{i,j}^*&#39;</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi_Te</span><span class="p">,</span> <span class="n">lte_partition_function_Te</span><span class="p">,</span> <span class="n">number_density</span><span class="p">,</span> <span class="n">electron_densities</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">,</span> <span class="n">ion_threshold</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_with_n_electron</span><span class="p">(</span>
            <span class="n">phi_Te</span><span class="p">,</span> <span class="n">lte_partition_function_Te</span><span class="p">,</span> <span class="n">number_density</span><span class="p">,</span> <span class="n">electron_densities</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">,</span> <span class="n">ion_threshold</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Custom-level-LTE">
<h1>Custom level LTE<a class="headerlink" href="#Custom-level-LTE" title="Link to this heading">¶</a></h1>
<p>Check input values for calculations use LTE or “NLTE” quantities as appropriate</p>
<p>Check precisely what step values are sourced from- are these first iteration or not?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.properties.level_population</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">LevelNumberDensity</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LTELevelNumberDensity</span><span class="p">(</span><span class="n">LevelNumberDensity</span><span class="p">):</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lte_level_number_density&#39;</span><span class="p">,)</span>
    <span class="n">latex_name</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;N_{i,j,k}^*&#39;</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_dilute_lte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lte_level_boltzmann_factor_Te</span><span class="p">,</span> <span class="n">lte_ion_number_density</span><span class="p">,</span>
                              <span class="n">levels</span><span class="p">,</span> <span class="n">lte_partition_function_Te</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">LTELevelNumberDensity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_calculate_dilute_lte</span><span class="p">(</span>
            <span class="n">lte_level_boltzmann_factor_Te</span><span class="p">,</span> <span class="n">lte_ion_number_density</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">lte_partition_function_Te</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lte_ion_number_density</span> <span class="o">=</span> <span class="n">LTEIonNumberDensity</span><span class="p">(</span><span class="n">cmfgen_plasma</span><span class="p">,</span>
                                             <span class="n">electron_densities</span><span class="o">=</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">electron_densities</span>
                                             <span class="p">)</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span>
                                                 <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">thermal_phi_lte</span><span class="p">,</span>
                                                 <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">thermal_lte_partition_function</span><span class="p">,</span>
                                                 <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">number_density</span><span class="p">,</span>
                                                 <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">electron_densities</span><span class="p">,</span>
                                                 <span class="kc">None</span><span class="p">,</span> <span class="mf">1e-20</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lte_level_number_density</span> <span class="o">=</span> <span class="n">LTELevelNumberDensity</span><span class="p">(</span><span class="n">cmfgen_plasma</span>
                                                 <span class="p">)</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span>
                                                     <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">thermal_lte_level_boltzmann_factor</span><span class="p">,</span>
                                                     <span class="n">lte_ion_number_density</span><span class="p">,</span>
                                                     <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span>
                                                     <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">thermal_lte_partition_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="NB--this-is-\Phi_{i,\kappa}-as-defined-in-Lucy-03-Eq-14">
<h2>NB- this is <span class="math notranslate nohighlight">\(\Phi_{i,\kappa}\)</span> as defined in Lucy 03 Eq 14<a class="headerlink" href="#NB--this-is-\Phi_{i,\kappa}-as-defined-in-Lucy-03-Eq-14" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level_to_ion_population_factor</span> <span class="o">=</span> <span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="o">*</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">number_density</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level_to_ion_population_factor_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;phi_lucy.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level_to_ion_population_factor_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">level_to_ion_population_factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_19_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_19_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level_to_ion_population_factor</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0     2.954267e-15
1     2.954267e-15
2     2.954267e-15
3     2.954267e-15
4     2.954267e-15
5     2.954267e-15
6     2.954267e-15
7     2.954267e-15
8     2.954267e-15
9     2.954267e-15
10    2.954267e-15
11    2.954267e-15
12    2.954267e-15
13    2.954267e-15
14    2.954267e-15
15    2.954267e-15
16    2.954267e-15
17    2.954267e-15
18    2.954267e-15
19    2.954267e-15
20    2.954267e-15
21    2.954267e-15
22    2.954267e-15
23    2.954267e-15
Name: (1, 0, 0), dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">lte_level_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">level_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">(</span><span class="n">lte_level_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_21_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_21_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ion_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">lte_ion_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">(</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">lte_ion_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_22_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_22_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lte_level_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lte_level_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_23_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_23_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lte_ion_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lte_ion_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_24_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_24_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ion_number_density_ctardis</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_25_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_25_1.png" />
</div>
</div>
<section id="Photoionization-coefficients">
<h3>Photoionization coefficients<a class="headerlink" href="#Photoionization-coefficients" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.equilibrium.rates</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnalyticPhotoionizationRateSolver</span>

<span class="n">photoionization_rate_solver</span> <span class="o">=</span> <span class="n">AnalyticPhotoionizationRateSolver</span><span class="p">(</span><span class="n">atom_data</span><span class="o">.</span><span class="n">photoionization_data</span><span class="p">)</span>
<span class="n">corr_photoion_coeff_solver</span> <span class="o">=</span> <span class="n">AnalyticCorrectedPhotoionizationCoeffSolver</span><span class="p">(</span><span class="n">atom_data</span><span class="o">.</span><span class="n">photoionization_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_photoion_coeff</span> <span class="o">=</span> <span class="n">corr_photoion_coeff_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
    <span class="n">rad_field</span><span class="p">,</span>
    <span class="n">electron_dist</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
    <span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">photoionization_coeff_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/home/afullard/tardis-chvogl-configs/rate_coefficients.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">estimated_photoion_coeff_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;estimated_photoion_coeff.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">photoionization_coeff_ctardis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">corr_photoion_coeff</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">estimated_photoion_coeff_ctardis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis analytic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TARDIS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis estimated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Photoionization coefficient&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b2d04a900&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_30_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_30_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">df1</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">df2</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="n">df2</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1">#plt.plot(df3.T, label=&quot;TARDIS&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Photoionization coefficient percent difference&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_2142677/3826348831.py:5: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  plt.legend()
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b24a67c50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_31_2.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_31_2.png" />
</div>
</div>
</section>
<section id="Recombination-rates">
<h3>Recombination rates<a class="headerlink" href="#Recombination-rates" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.equilibrium.rates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpontaneousRecombinationCoeffSolver</span>

<span class="n">recomb_rate_solver</span> <span class="o">=</span> <span class="n">SpontaneousRecombinationCoeffSolver</span><span class="p">(</span><span class="n">atom_data</span><span class="o">.</span><span class="n">photoionization_data</span><span class="p">)</span>

<span class="n">recomb_coeff</span> <span class="o">=</span> <span class="n">recomb_rate_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">electron_dist</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recomb_coeff_ctardis_iter1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;sp_recomb_coeff_iter1.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">recomb_coeff_ctardis_iter2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;sp_recomb_coeff_iter2.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">recomb_coeff_ctardis_iter3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;sp_recomb_coeff_iter3.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">recomb_coeff_comparison</span> <span class="o">=</span> <span class="p">(</span><span class="n">recomb_coeff</span> <span class="o">*</span> <span class="n">level_to_ion_population_factor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recomb_coeff_ctardis_iter1</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_35_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_35_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recomb_coeff_ctardis_iter2</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_36_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_36_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recomb_coeff_ctardis_iter3</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_37_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_37_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">recomb_coeff_ctardis_iter1</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis iter1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">recomb_coeff_ctardis_iter2</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis iter2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">recomb_coeff_ctardis_iter3</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="n">recomb_coeff_comparison</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis iter3&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Recombination coefficient percent difference&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_2142677/2625515403.py:1: RuntimeWarning: invalid value encountered in divide
  plt.plot((recomb_coeff_ctardis_iter1[&#34;0&#34;].values - recomb_coeff_comparison[0].values)/recomb_coeff_comparison[0].values * 100, label=&#34;ctardis iter1&#34;)
/tmp/ipykernel_2142677/2625515403.py:2: RuntimeWarning: invalid value encountered in divide
  plt.plot((recomb_coeff_ctardis_iter2[&#34;0&#34;].values - recomb_coeff_comparison[0].values)/recomb_coeff_comparison[0].values * 100, label=&#34;ctardis iter2&#34;)
/tmp/ipykernel_2142677/2625515403.py:3: RuntimeWarning: invalid value encountered in divide
  plt.plot((recomb_coeff_ctardis_iter3[&#34;0&#34;].values - recomb_coeff_comparison[0].values)/recomb_coeff_comparison[0].values * 100, label=&#34;ctardis iter3&#34;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b2489d090&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_38_2.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_38_2.png" />
</div>
</div>
</section>
<section id="Level-population-fractions">
<h3>Level population fractions<a class="headerlink" href="#Level-population-fractions" title="Link to this heading">¶</a></h3>
<p>Scaling factor to compensate for solving the ion and level populations independently</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level_pop_fraction_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;level_pop_fractions.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">level_pop_fraction_ctardis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">level_pop_fraction_ctardis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">level_pop_fraction_ctardis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">(</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_boltzmann_factor</span> <span class="o">/</span> <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">partition_function</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;atomic_number,ion_number,level_number&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_40_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">number_density</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>14</th>
      <th>15</th>
      <th>16</th>
      <th>17</th>
      <th>18</th>
      <th>19</th>
      <th>20</th>
      <th>21</th>
      <th>22</th>
      <th>23</th>
    </tr>
    <tr>
      <th>atomic_number</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2.206974e+09</td>
      <td>1.625151e+09</td>
      <td>1.226263e+09</td>
      <td>9.439276e+08</td>
      <td>7.385766e+08</td>
      <td>5.875210e+08</td>
      <td>4.729701e+08</td>
      <td>3.821747e+08</td>
      <td>3.087125e+08</td>
      <td>2.492508e+08</td>
      <td>...</td>
      <td>8.544174e+07</td>
      <td>6.897694e+07</td>
      <td>5.568109e+07</td>
      <td>4.495365e+07</td>
      <td>3.628677e+07</td>
      <td>2.929481e+07</td>
      <td>2.364836e+07</td>
      <td>1.909059e+07</td>
      <td>1.541157e+07</td>
      <td>1.244141e+07</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 24 columns</p>
</div></div>
</div>
</section>
</section>
<section id="Effects-of-differing-level-population-fractions-on-the-photoionization-rate">
<h2>Effects of differing level population fractions on the photoionization rate<a class="headerlink" href="#Effects-of-differing-level-population-fractions-on-the-photoionization-rate" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">estimated_photoion_coeff_ctardis</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">level_pop_fraction_ctardis</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cTARDIS Level Population Fraction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">estimated_photoion_coeff_ctardis</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_boltzmann_factor</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TARDIS Level Boltzmann Factor&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Photoionization Coefficient&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b2cb04cd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_43_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_43_1.png" />
</div>
</div>
<section id="Solving-photoionization-and-recombination-rates-using-CTARDIS-input">
<h3>Solving photoionization and recombination rates using CTARDIS input<a class="headerlink" href="#Solving-photoionization-and-recombination-rates-using-CTARDIS-input" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boltzmann_factor_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;level_boltzmann_factor_ctardis.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">boltzmann_factor_ctardis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">boltzmann_factor_ctardis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">photoion_rates</span><span class="p">,</span> <span class="n">recomb_rates</span> <span class="o">=</span> <span class="n">photoionization_rate_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">rad_field</span><span class="p">,</span> <span class="n">electron_dist</span><span class="p">,</span> <span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span>
    <span class="mf">1.0</span><span class="p">,</span> <span class="c1"># Partition function to match ctardis</span>
    <span class="n">boltzmann_factor_ctardis</span><span class="p">,</span>
   <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">photoion_rates_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;photoion_tot.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">photoion_rates_ctardis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">photoion_rates_ctardis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">photoion_rates_ctardis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">photoion_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">photoion_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">photoion_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">photoion_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span>
<span class="n">photoion_rates_ctardis</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;atomic_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_source&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_destination&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">photoion_rates_ctardis</span> <span class="o">=</span> <span class="n">photoion_rates_ctardis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">photoion_rates_ctardis</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis&quot;</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">photoion_rates</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;TARDIS&quot;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_46_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_46_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recomb_rates_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;recomb_tot.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">recomb_rates_ctardis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">recomb_rates_ctardis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">recomb_rates_ctardis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">recomb_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recomb_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span>
<span class="n">recomb_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recomb_rates_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">recomb_rates_ctardis</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;atomic_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_source&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_destination&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">recomb_rates_ctardis</span> <span class="o">=</span> <span class="n">recomb_rates_ctardis</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recomb_rates_ctardis</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recomb_rates</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">number_density</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7b2b2471b750&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_47_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_47_1.png" />
</div>
</div>
</section>
</section>
</section>
<section id="Collisional-rates">
<h1>Collisional rates<a class="headerlink" href="#Collisional-rates" title="Link to this heading">¶</a></h1>
<p>Match both pre- and post- estimator rates from ctardis</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.equilibrium.rate_matrix</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonRateMatrix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.equilibrium.rates</span><span class="w"> </span><span class="kn">import</span> <span class="n">CollisionalIonizationRateSolver</span>

<span class="n">collisional_rate_solver</span> <span class="o">=</span> <span class="n">CollisionalIonizationRateSolver</span><span class="p">(</span><span class="n">atom_data</span><span class="o">.</span><span class="n">photoionization_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coll_ion_rates</span><span class="p">,</span> <span class="n">coll_recomb_rates</span> <span class="o">=</span> <span class="n">collisional_rate_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
    <span class="n">electron_dist</span><span class="p">,</span>
    <span class="n">level_to_ion_population_factor</span><span class="p">,</span>
    <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">boltzmann_factor_ctardis</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis_coll_ion</span> <span class="o">=</span> <span class="n">coll_ion_rates</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="n">coll_ion_coeff_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;coll_ion_total.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">coll_ion_coeff_ctardis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">coll_ion_coeff_ctardis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">coll_ion_coeff_ctardis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">coll_ion_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll_ion_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span>
<span class="n">coll_ion_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll_ion_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">coll_ion_coeff_ctardis</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;atomic_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_source&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_destination&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">ctardis_coll_ion</span> <span class="o">=</span> <span class="p">(</span><span class="n">coll_ion_coeff_ctardis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">number_density</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tardis_coll_ion</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TARDIS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ctardis_coll_ion</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Collisional Ionization Coefficient&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Collisional Ionization Coefficient&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_51_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_51_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tardis_coll_recomb</span> <span class="o">=</span> <span class="n">coll_recomb_rates</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="n">coll_recomb_coeff_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;coll_recomb_coeff_ctardis.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">coll_recomb_coeff_ctardis</span> <span class="o">=</span> <span class="n">coll_recomb_coeff_ctardis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;atomic_number&quot;</span><span class="p">,</span> <span class="s2">&quot;ion_number&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">number_density</span> <span class="o">**</span><span class="mi">2</span>
<span class="n">coll_recomb_coeff_ctardis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">coll_recomb_coeff_ctardis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">coll_recomb_coeff_ctardis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">coll_recomb_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll_recomb_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">coll_recomb_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number_destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll_recomb_coeff_ctardis</span><span class="p">[</span><span class="s2">&quot;ion_number&quot;</span><span class="p">]</span>

<span class="n">coll_recomb_coeff_ctardis</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;atomic_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_source&#39;</span><span class="p">,</span> <span class="s1">&#39;ion_number_destination&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">ctardis_coll_recomb</span> <span class="o">=</span> <span class="n">coll_recomb_coeff_ctardis</span><span class="o">.</span><span class="n">T</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tardis_coll_recomb</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TARDIS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ctardis_coll_recomb</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ctardis&quot;</span><span class="p">,</span>  <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Collisional Recombination Coefficient&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Collisional Recombination Coefficient&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_52_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_52_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">dummyphotoionratesolver</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dummy solver to hold ctardis data&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctardis_photoion_rates</span><span class="p">,</span> <span class="n">ctardis_recomb_rates</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">photoion_rates</span> <span class="o">=</span> <span class="n">ctardis_photoion_rates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recomb_rates</span> <span class="o">=</span> <span class="n">ctardis_recomb_rates</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rad_field</span><span class="p">,</span> <span class="n">electron_dist</span><span class="p">,</span> <span class="n">level_population</span><span class="p">,</span> <span class="n">lte_level_population</span><span class="p">,</span> <span class="n">lte_ion_number_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ion_number_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">photoion_rates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recomb_rates</span>

<span class="n">dummy_rate_solver</span> <span class="o">=</span> <span class="n">dummyphotoionratesolver</span><span class="p">(</span><span class="n">photoion_rates_ctardis</span><span class="p">,</span> <span class="n">recomb_rates_ctardis</span> <span class="o">*</span> <span class="n">electron_dist</span><span class="o">.</span><span class="n">number_density</span><span class="p">)</span>
<span class="n">dummy_col_rate_solver</span> <span class="o">=</span> <span class="n">dummyphotoionratesolver</span><span class="p">(</span><span class="n">coll_ion_rates</span><span class="p">,</span> <span class="n">coll_recomb_coeff_ctardis</span><span class="p">)</span>

<span class="n">ion_rate_matrix_solver</span> <span class="o">=</span> <span class="n">IonRateMatrix</span><span class="p">(</span><span class="n">dummy_rate_solver</span><span class="p">,</span> <span class="n">collisional_rate_solver</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Ion-rate-matrix">
<h1>Ion rate matrix<a class="headerlink" href="#Ion-rate-matrix" title="Link to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ion_rate_matrix</span> <span class="o">=</span> <span class="n">ion_rate_matrix_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">rad_field</span><span class="p">,</span> <span class="n">electron_dist</span><span class="p">,</span> <span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;ion_number&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span>
    <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">boltzmann_factor_ctardis</span><span class="p">,</span>
    <span class="n">charge_conservation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tardis.plasma.equilibrium.ion_populations</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonPopulationSolver</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">IonPopulationSolver</span><span class="p">(</span><span class="n">ion_rate_matrix_solver</span><span class="p">)</span>

<span class="n">ion_pops</span><span class="p">,</span> <span class="n">electron_densities</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
    <span class="n">rad_field</span><span class="p">,</span>
    <span class="n">electron_dist</span><span class="p">,</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">number_density</span><span class="p">,</span>
    <span class="n">lte_level_number_density</span><span class="p">,</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">level_number_density</span><span class="p">,</span>
    <span class="n">lte_ion_number_density</span><span class="p">,</span>
    <span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="p">,</span>
    <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">boltzmann_factor_ctardis</span><span class="p">,</span>
    <span class="n">charge_conservation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lte_ion_number_density</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (LTE)&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lte_ion_number_density_ctardis</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (LTE ctardis)&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmfgen_plasma</span><span class="o">.</span><span class="n">ion_number_density</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (Nebular)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ion_number_density_ctardis</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (Nebular ctardis)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ion_pops</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (NLTE)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;H I Ion Number Density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b24295e50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_57_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_57_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ion_number_density_ctardis_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;ion_number_densities_ctardis_result.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ion_number_density_ctardis_final</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (ctardis)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ion_pops</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H I (NLTE)&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;H I Ion Number Density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b238eccd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_58_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_58_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ion_number_density_ctardis_final</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H II (ctardis third iter)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ion_pops</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H II (NLTE)&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;H II Ion Number Density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7b2b23695810&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_59_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_59_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuals</span> <span class="o">=</span> <span class="p">((</span><span class="n">ion_pops</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">ion_number_density_ctardis_final</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">ion_number_density_ctardis_final</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Percentage Residuals (H I NLTE - H I CTARDIS)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage Residuals (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage Residuals of H I NLTE vs H I CTARDIS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Percentage Residuals of H I NLTE vs H I CTARDIS&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_60_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_60_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuals_hii</span> <span class="o">=</span> <span class="p">((</span><span class="n">ion_pops</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">ion_number_density_ctardis_final</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">ion_number_density_ctardis_final</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_hii</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Percentage Residuals (H II NLTE - H II CTARDIS)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage Residuals (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage Residuals of H II NLTE vs H II CTARDIS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Percentage Residuals of H II NLTE vs H II CTARDIS&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_61_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_61_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">electron_densities_ctardis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctardis_path</span><span class="o">+</span><span class="s2">&quot;electron_densities_ctardis_result.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">residuals_electron</span><span class="o">=</span> <span class="p">((</span><span class="n">electron_densities</span> <span class="o">-</span> <span class="n">electron_densities_ctardis</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">electron_densities_ctardis</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_electron</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Percentage Residuals (e NLTE - e ctardis)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage Residuals (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage Residuals of e NLTE vs e ctardis&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Percentage Residuals of e NLTE vs e ctardis&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_62_1.png" src="../../../_images/physics_plasma_equilibrium_ionization_solution_comparison_62_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 02 Sep 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>